\begin{code}\>\<%
\\
\>\AgdaKeyword{module} \AgdaModule{SubstitutionLemmas} \AgdaKeyword{where}\<%
\\
%
\\
\>\AgdaKeyword{open} \AgdaKeyword{import} \AgdaModule{Chi}\<%
\\
\>\AgdaKeyword{open} \AgdaKeyword{import} \AgdaModule{Term}\<%
\\
\>\AgdaKeyword{open} \AgdaKeyword{import} \AgdaModule{Substitution}\<%
\\
\>\AgdaKeyword{open} \AgdaKeyword{import} \AgdaModule{Alpha}\<%
\\
\>\AgdaKeyword{open} \AgdaKeyword{import} \AgdaModule{NaturalProp}\<%
\\
\>\AgdaKeyword{open} \AgdaKeyword{import} \AgdaModule{ListProperties}\<%
\\
%
\\
\>\AgdaKeyword{open} \AgdaKeyword{import} \AgdaModule{Data.Empty}\<%
\\
\>\AgdaKeyword{open} \AgdaKeyword{import} \AgdaModule{Data.Nat} \AgdaKeyword{hiding} \AgdaSymbol{(}\_*\_\AgdaSymbol{)}\<%
\\
\>\AgdaKeyword{open} \AgdaKeyword{import} \AgdaModule{Relation.Nullary}\<%
\\
\>\AgdaKeyword{open} \AgdaKeyword{import} \AgdaModule{Relation.Binary}\<%
\\
\>\AgdaKeyword{open} \AgdaKeyword{import} \AgdaModule{Function} \AgdaKeyword{hiding} \AgdaSymbol{(}\_∘\_\AgdaSymbol{)}\<%
\\
\>\AgdaKeyword{open} \AgdaKeyword{import} \AgdaModule{Data.Product} \AgdaKeyword{renaming} \AgdaSymbol{(}Σ \AgdaSymbol{to} Σₓ\AgdaSymbol{)}\<%
\\
\>\AgdaKeyword{open} \AgdaKeyword{import} \AgdaModule{Relation.Binary.PropositionalEquality} \AgdaSymbol{as} \AgdaModule{PropEq}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaKeyword{using} \AgdaSymbol{(}\_≡\_\AgdaSymbol{;} \_≢\_\AgdaSymbol{;} refl\AgdaSymbol{;} sym\AgdaSymbol{;} cong\AgdaSymbol{;} cong₂\AgdaSymbol{;} trans\AgdaSymbol{;} setoid\AgdaSymbol{)}\<%
\\
\>\AgdaKeyword{open} \AgdaModule{PropEq.}\AgdaModule{≡-Reasoning} \AgdaKeyword{renaming} \AgdaSymbol{(}begin\_ \AgdaSymbol{to} begin≡\_\AgdaSymbol{;}\_∎ \AgdaSymbol{to} \_◻\AgdaSymbol{)}\<%
\\
\>\AgdaKeyword{open} \AgdaKeyword{import} \AgdaModule{Data.List} \AgdaKeyword{hiding} \AgdaSymbol{(}any\AgdaSymbol{)} \AgdaKeyword{renaming} \AgdaSymbol{(}length \AgdaSymbol{to} length'\AgdaSymbol{)} \<[64]%
\>[64]\<%
\\
\>\AgdaKeyword{open} \AgdaKeyword{import} \AgdaModule{Data.List.Properties}\<%
\\
\>\AgdaKeyword{open} \AgdaKeyword{import} \AgdaModule{Data.List.Any} \AgdaSymbol{as} \AgdaModule{Any} \AgdaKeyword{hiding} \AgdaSymbol{(}map\AgdaSymbol{)}\<%
\\
\>\AgdaKeyword{open} \AgdaKeyword{import} \AgdaModule{Data.List.Any.Membership}\<%
\\
\>\AgdaKeyword{open} \AgdaModule{Any.}\AgdaModule{Membership-≡} \<[22]%
\>[22]\<%
\\
%
\\
\>\AgdaKeyword{infix} \<[7]%
\>[7]\AgdaNumber{6} \_▹\_ \<%
\\
\>\AgdaKeyword{infixl} \AgdaNumber{7} \_∘\_\<%
\\
\>\<\end{code}

\begin{code}\>\<%
\\
\>\AgdaFunction{\_∘\_} \AgdaSymbol{:} \AgdaFunction{Σ} \AgdaSymbol{→} \AgdaFunction{Σ} \AgdaSymbol{→} \AgdaFunction{Σ}\<%
\\
\>\AgdaSymbol{(}\AgdaBound{σ} \AgdaFunction{∘} \AgdaBound{σ'}\AgdaSymbol{)} \AgdaBound{x} \AgdaSymbol{=} \AgdaSymbol{(}\AgdaBound{σ'} \AgdaBound{x}\AgdaSymbol{)} \AgdaFunction{∙} \AgdaBound{σ}\<%
\\
\>\<\end{code}

Lemma 3.1 (v) Stougthton

\begin{code}\>\<%
\\
\>\AgdaFunction{lemmaσ≡σ'→Mσ≡Mσ'} \AgdaSymbol{:} \AgdaSymbol{\{}\AgdaBound{M} \AgdaSymbol{:} \AgdaDatatype{Λ}\AgdaSymbol{\}\{}\AgdaBound{σ} \AgdaBound{σ'} \AgdaSymbol{:} \AgdaFunction{Σ}\AgdaSymbol{\}} \AgdaSymbol{→} \<[39]%
\>[39]\<%
\\
\>[2]\AgdaIndent{19}{}\<[19]%
\>[19]\AgdaSymbol{((}\AgdaBound{x} \AgdaSymbol{:} \AgdaFunction{V}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaBound{x} \AgdaDatatype{*} \AgdaBound{M} \AgdaSymbol{→} \AgdaBound{σ} \AgdaBound{x} \AgdaDatatype{≡} \AgdaBound{σ'} \AgdaBound{x}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaBound{M} \AgdaFunction{∙} \AgdaBound{σ} \AgdaDatatype{≡} \AgdaBound{M} \AgdaFunction{∙} \AgdaBound{σ'}\<%
\\
\>\AgdaFunction{lemmaσ≡σ'→Mσ≡Mσ'} \AgdaSymbol{\{}\AgdaInductiveConstructor{v} \AgdaBound{x}\AgdaSymbol{\}} \<[25]%
\>[25]\AgdaSymbol{\{}\AgdaBound{σ}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{σ'}\AgdaSymbol{\}} \AgdaBound{f} \<[36]%
\>[36]\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaSymbol{=} \AgdaBound{f} \AgdaBound{x} \AgdaInductiveConstructor{*v}\<%
\\
\>\AgdaFunction{lemmaσ≡σ'→Mσ≡Mσ'} \AgdaSymbol{\{}\AgdaBound{M} \AgdaInductiveConstructor{·} \AgdaBound{N}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{σ}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{σ'}\AgdaSymbol{\}} \AgdaBound{f} \<[36]%
\>[36]\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaSymbol{=} \AgdaFunction{cong₂} \AgdaInductiveConstructor{\_·\_}\<%
\\
\>[2]\AgdaIndent{10}{}\<[10]%
\>[10]\AgdaSymbol{(}\AgdaFunction{lemmaσ≡σ'→Mσ≡Mσ'} \AgdaSymbol{\{}\AgdaBound{M}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{σ}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{σ'}\AgdaSymbol{\}} \AgdaSymbol{(λ} \AgdaBound{x} \AgdaBound{xfreeM} \AgdaSymbol{→} \AgdaBound{f} \AgdaBound{x} \AgdaSymbol{(}\AgdaInductiveConstructor{*·l} \AgdaBound{xfreeM}\AgdaSymbol{)))} \<[74]%
\>[74]\<%
\\
\>[2]\AgdaIndent{10}{}\<[10]%
\>[10]\AgdaSymbol{(}\AgdaFunction{lemmaσ≡σ'→Mσ≡Mσ'} \AgdaSymbol{\{}\AgdaBound{N}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{σ}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{σ'}\AgdaSymbol{\}} \AgdaSymbol{(λ} \AgdaBound{x} \AgdaBound{xfreeN} \AgdaSymbol{→} \AgdaBound{f} \AgdaBound{x} \AgdaSymbol{(}\AgdaInductiveConstructor{*·r} \AgdaBound{xfreeN}\AgdaSymbol{)))}\<%
\\
\>\AgdaFunction{lemmaσ≡σ'→Mσ≡Mσ'} \AgdaSymbol{\{}\AgdaInductiveConstructor{ƛ} \AgdaBound{x} \AgdaBound{M}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{σ}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{σ'}\AgdaSymbol{\}} \AgdaBound{f} \<[36]%
\>[36]\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaKeyword{with} \AgdaFunction{χ} \AgdaSymbol{(}\AgdaBound{σ} \AgdaInductiveConstructor{,} \AgdaInductiveConstructor{ƛ} \AgdaBound{x} \AgdaBound{M}\AgdaSymbol{)} \AgdaSymbol{|} \AgdaFunction{χ} \AgdaSymbol{(}\AgdaBound{σ'} \AgdaInductiveConstructor{,} \AgdaInductiveConstructor{ƛ} \AgdaBound{x} \AgdaBound{M}\AgdaSymbol{)} \AgdaSymbol{|} \<[40]%
\>[40]\<%
\\
\>[0]\AgdaIndent{7}{}\<[7]%
\>[7]\AgdaFunction{χ-lemma3} \AgdaBound{σ} \AgdaBound{σ'} \AgdaSymbol{(}\AgdaInductiveConstructor{ƛ} \AgdaBound{x} \AgdaBound{M}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaInductiveConstructor{ƛ} \AgdaBound{x} \AgdaBound{M}\AgdaSymbol{)} \AgdaSymbol{(λ} \AgdaBound{x} \AgdaBound{x*M} \AgdaSymbol{→} \AgdaSymbol{((}\AgdaFunction{lemma} \AgdaBound{σ} \AgdaBound{σ'} \AgdaBound{f} \AgdaBound{x} \AgdaBound{x*M}\AgdaSymbol{)} \AgdaInductiveConstructor{,} \AgdaSymbol{(}\AgdaFunction{lemma} \AgdaBound{σ'} \AgdaBound{σ} \AgdaFunction{f2} \AgdaBound{x} \AgdaBound{x*M}\AgdaSymbol{)))} \AgdaSymbol{((λ} \AgdaBound{\_} \AgdaSymbol{→} \AgdaFunction{id}\AgdaSymbol{)}\AgdaInductiveConstructor{,}\AgdaSymbol{(λ} \AgdaBound{\_} \AgdaSymbol{→} \AgdaFunction{id}\AgdaSymbol{))} \<[120]%
\>[120]\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaKeyword{where}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{lemma} \AgdaSymbol{:} \AgdaSymbol{(}\AgdaBound{σ} \AgdaBound{σ'} \AgdaSymbol{:} \AgdaFunction{Σ}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaSymbol{((}\AgdaBound{y} \AgdaSymbol{:} \AgdaFunction{V}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaBound{y} \AgdaDatatype{*} \AgdaSymbol{(}\AgdaInductiveConstructor{ƛ} \AgdaBound{x} \AgdaBound{M}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaBound{σ} \AgdaBound{y} \AgdaDatatype{≡} \AgdaBound{σ'} \AgdaBound{y}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{z} \AgdaSymbol{:} \AgdaFunction{V}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaBound{z} \AgdaDatatype{*} \AgdaInductiveConstructor{ƛ} \AgdaBound{x} \AgdaBound{M} \AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{y} \AgdaSymbol{:} \AgdaFunction{V}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaBound{y} \AgdaDatatype{*} \AgdaBound{σ} \AgdaBound{z} \AgdaSymbol{→} \AgdaBound{y} \AgdaDatatype{*} \AgdaBound{σ'} \AgdaBound{z}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{lemma} \AgdaBound{σ} \AgdaBound{σ'} \AgdaBound{f} \AgdaBound{z} \AgdaBound{zfreeλxM} \AgdaBound{y} \AgdaBound{yfreeσz} \AgdaKeyword{rewrite} \AgdaBound{f} \AgdaBound{z} \AgdaBound{zfreeλxM} \AgdaSymbol{=} \AgdaBound{yfreeσz}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{f2} \AgdaSymbol{:} \AgdaSymbol{(}\AgdaBound{y} \AgdaSymbol{:} \AgdaFunction{V}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaBound{y} \AgdaDatatype{*} \AgdaSymbol{(}\AgdaInductiveConstructor{ƛ} \AgdaBound{x} \AgdaBound{M}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaBound{σ'} \AgdaBound{y} \AgdaDatatype{≡} \AgdaBound{σ} \AgdaBound{y}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{f2} \AgdaBound{y} \AgdaBound{yfreeλxM} \AgdaSymbol{=} \AgdaFunction{sym} \AgdaSymbol{(}\AgdaBound{f} \AgdaBound{y} \AgdaBound{yfreeλxM}\AgdaSymbol{)}\<%
\\
\>\AgdaSymbol{...} \AgdaSymbol{|} \AgdaBound{y} \AgdaSymbol{|} \AgdaSymbol{.}\AgdaBound{y} \AgdaSymbol{|} \AgdaInductiveConstructor{refl} \<[20]%
\>[20]\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaSymbol{=} \<[5]%
\>[5]\AgdaFunction{cong} \AgdaSymbol{(}\AgdaInductiveConstructor{ƛ} \AgdaBound{y}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaFunction{lemmaσ≡σ'→Mσ≡Mσ'} \AgdaSymbol{\{}\AgdaBound{M}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{σ} \AgdaFunction{<+} \AgdaSymbol{(}\AgdaBound{x} \AgdaInductiveConstructor{,} \AgdaInductiveConstructor{v} \AgdaBound{y}\AgdaSymbol{)\}} \AgdaSymbol{\{}\AgdaBound{σ'} \AgdaFunction{<+} \AgdaSymbol{(}\AgdaBound{x} \AgdaInductiveConstructor{,} \AgdaInductiveConstructor{v} \AgdaBound{y}\AgdaSymbol{)\}} \AgdaFunction{lemma}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaKeyword{where}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{lemma} \AgdaSymbol{:} \AgdaSymbol{(}\AgdaBound{z} \AgdaSymbol{:} \AgdaFunction{V}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaBound{z} \AgdaDatatype{*} \AgdaBound{M} \AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{σ} \AgdaFunction{<+} \AgdaSymbol{(}\AgdaBound{x} \AgdaInductiveConstructor{,} \AgdaInductiveConstructor{v} \AgdaBound{y}\AgdaSymbol{))} \AgdaBound{z} \AgdaDatatype{≡} \AgdaSymbol{(}\AgdaBound{σ'} \AgdaFunction{<+} \AgdaSymbol{(}\AgdaBound{x} \AgdaInductiveConstructor{,} \AgdaInductiveConstructor{v} \AgdaBound{y}\AgdaSymbol{))} \AgdaBound{z}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{lemma} \AgdaBound{z} \AgdaBound{zfreeM} \AgdaKeyword{with} \AgdaBound{x} \AgdaFunction{≟} \AgdaBound{z}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaSymbol{...} \AgdaSymbol{|} \AgdaInductiveConstructor{yes} \AgdaSymbol{\_} \<[16]%
\>[16]\AgdaSymbol{=} \AgdaInductiveConstructor{refl}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaSymbol{...} \AgdaSymbol{|} \AgdaInductiveConstructor{no} \<[12]%
\>[12]\AgdaBound{x≢z} \AgdaSymbol{=} \AgdaBound{f} \AgdaBound{z} \AgdaSymbol{(}\AgdaInductiveConstructor{*ƛ} \AgdaBound{zfreeM} \AgdaBound{x≢z}\AgdaSymbol{)}\<%
\\
\>\<\end{code}


\begin{code}\>\<%
\\
\>\AgdaFunction{lemmaσ∘<+} \AgdaSymbol{:} \AgdaSymbol{(}\AgdaBound{M} \AgdaSymbol{:} \AgdaDatatype{Λ}\AgdaSymbol{)(}\AgdaBound{σ} \AgdaBound{σ'} \AgdaSymbol{:} \AgdaFunction{Σ}\AgdaSymbol{)(}\AgdaBound{x} \AgdaBound{y'} \AgdaSymbol{:} \AgdaFunction{V}\AgdaSymbol{)} \<[40]%
\>[40]\<%
\\
\>[2]\AgdaIndent{7}{}\<[7]%
\>[7]\AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{w} \AgdaSymbol{:} \AgdaFunction{V}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaBound{w} \AgdaDatatype{*} \AgdaBound{M} \<[25]%
\>[25]\<%
\\
\>[2]\AgdaIndent{7}{}\<[7]%
\>[7]\AgdaSymbol{→} \AgdaSymbol{((}\AgdaBound{σ'} \AgdaFunction{<+} \AgdaSymbol{(}\AgdaFunction{χ} \AgdaSymbol{(}\AgdaBound{σ} \AgdaInductiveConstructor{,} \AgdaInductiveConstructor{ƛ} \AgdaBound{x} \AgdaBound{M}\AgdaSymbol{)} \AgdaInductiveConstructor{,} \AgdaInductiveConstructor{v} \AgdaBound{y'}\AgdaSymbol{))} \AgdaFunction{∘} \AgdaSymbol{(}\AgdaBound{σ} \AgdaFunction{<+} \AgdaSymbol{(}\AgdaBound{x} \AgdaInductiveConstructor{,} \AgdaInductiveConstructor{v} \AgdaSymbol{(}\AgdaFunction{χ} \AgdaSymbol{(}\AgdaBound{σ} \AgdaInductiveConstructor{,} \AgdaInductiveConstructor{ƛ} \AgdaBound{x} \AgdaBound{M}\AgdaSymbol{)))))} \AgdaBound{w} \AgdaDatatype{≡} \AgdaSymbol{((}\AgdaBound{σ'} \AgdaFunction{∘} \AgdaBound{σ}\AgdaSymbol{)} \AgdaFunction{<+} \AgdaSymbol{(}\AgdaBound{x} \AgdaInductiveConstructor{,} \AgdaInductiveConstructor{v} \AgdaBound{y'}\AgdaSymbol{))} \AgdaBound{w}\<%
\\
\>\AgdaFunction{lemmaσ∘<+} \AgdaBound{M} \AgdaBound{σ} \AgdaBound{σ'} \AgdaBound{x} \AgdaBound{y'} \AgdaBound{w} \AgdaBound{wfreeM} \AgdaKeyword{with} \AgdaBound{x} \AgdaFunction{≟} \AgdaBound{w}\<%
\\
\>\AgdaSymbol{...} \AgdaSymbol{|} \AgdaInductiveConstructor{no} \<[10]%
\>[10]\AgdaBound{x≢w} \AgdaSymbol{=} \AgdaFunction{begin≡}\<%
\\
\>[7]\AgdaIndent{19}{}\<[19]%
\>[19]\AgdaSymbol{(}\AgdaBound{σ} \AgdaBound{w}\AgdaSymbol{)} \AgdaFunction{∙} \AgdaSymbol{(}\AgdaBound{σ'} \AgdaFunction{<+} \AgdaSymbol{(}\AgdaFunction{y} \AgdaInductiveConstructor{,} \AgdaInductiveConstructor{v} \AgdaBound{y'}\AgdaSymbol{))}\<%
\\
\>[7]\AgdaIndent{19}{}\<[19]%
\>[19]\AgdaFunction{≡⟨} \AgdaFunction{lemmaσ≡σ'→Mσ≡Mσ'} \AgdaSymbol{\{}\AgdaBound{σ} \AgdaBound{w}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{σ'} \AgdaFunction{<+} \AgdaSymbol{(}\AgdaFunction{y} \AgdaInductiveConstructor{,} \AgdaInductiveConstructor{v} \AgdaBound{y'}\AgdaSymbol{)\}} \AgdaSymbol{\{}\AgdaBound{σ'}\AgdaSymbol{\}} \AgdaFunction{lemma} \AgdaFunction{⟩}\<%
\\
\>[7]\AgdaIndent{19}{}\<[19]%
\>[19]\AgdaSymbol{(}\AgdaBound{σ} \AgdaBound{w}\AgdaSymbol{)} \AgdaFunction{∙} \AgdaBound{σ'}\<%
\\
\>[-5]\AgdaIndent{17}{}\<[17]%
\>[17]\AgdaFunction{◻}\<%
\\
\>[0]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaKeyword{where} \<[10]%
\>[10]\<%
\\
\>[0]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaFunction{y} \AgdaSymbol{=} \AgdaFunction{χ} \AgdaSymbol{(}\AgdaBound{σ} \AgdaInductiveConstructor{,} \AgdaInductiveConstructor{ƛ} \AgdaBound{x} \AgdaBound{M}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaFunction{lemma} \AgdaSymbol{:} \AgdaSymbol{(}\AgdaBound{u} \AgdaSymbol{:} \AgdaFunction{V}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaBound{u} \AgdaDatatype{*} \AgdaBound{σ} \AgdaBound{w} \AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{σ'} \AgdaFunction{<+} \AgdaSymbol{(}\AgdaFunction{y} \AgdaInductiveConstructor{,} \AgdaInductiveConstructor{v} \AgdaBound{y'}\AgdaSymbol{))} \AgdaBound{u} \AgdaDatatype{≡} \AgdaBound{σ'} \AgdaBound{u}\<%
\\
\>[0]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaFunction{lemma} \AgdaBound{u} \AgdaBound{ufreeσw} \AgdaKeyword{with} \AgdaSymbol{(}\AgdaFunction{χ-lemma2} \AgdaBound{σ} \AgdaSymbol{(}\AgdaInductiveConstructor{ƛ} \AgdaBound{x} \AgdaBound{M}\AgdaSymbol{))} \AgdaBound{w} \AgdaSymbol{(}\AgdaInductiveConstructor{*ƛ} \AgdaBound{wfreeM} \AgdaBound{x≢w}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaSymbol{...} \AgdaSymbol{|} \AgdaBound{y\#σw} \AgdaKeyword{with} \AgdaFunction{y} \AgdaFunction{≟} \AgdaBound{u}\<%
\\
\>[0]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaSymbol{...} \<[15]%
\>[15]\AgdaSymbol{|} \AgdaInductiveConstructor{no} \<[21]%
\>[21]\AgdaSymbol{\_} \<[26]%
\>[26]\AgdaSymbol{=} \AgdaInductiveConstructor{refl}\<%
\\
\>[0]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaFunction{lemma} \AgdaSymbol{.}\AgdaFunction{y} \AgdaBound{yfreeσw} \AgdaSymbol{|} \AgdaBound{y\#σw}\<%
\\
\>[4]\AgdaIndent{15}{}\<[15]%
\>[15]\AgdaSymbol{|} \AgdaInductiveConstructor{yes} \AgdaInductiveConstructor{refl} \AgdaSymbol{=} \AgdaFunction{⊥-elim} \AgdaSymbol{((}\AgdaFunction{lemma-free→¬\#} \AgdaBound{yfreeσw}\AgdaSymbol{)} \AgdaBound{y\#σw}\AgdaSymbol{)} \<[66]%
\>[66]\<%
\\
\>\AgdaSymbol{...} \AgdaSymbol{|} \AgdaInductiveConstructor{yes} \AgdaBound{x≡w} \AgdaKeyword{with} \AgdaFunction{y} \AgdaFunction{≟} \AgdaFunction{y}\<%
\\
\>[0]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaKeyword{where} \<[10]%
\>[10]\<%
\\
\>[0]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaFunction{y} \AgdaSymbol{=} \AgdaFunction{χ} \AgdaSymbol{(}\AgdaBound{σ} \AgdaInductiveConstructor{,} \AgdaInductiveConstructor{ƛ} \AgdaBound{x} \AgdaBound{M}\AgdaSymbol{)}\<%
\\
\>\AgdaSymbol{...} \<[14]%
\>[14]\AgdaSymbol{|} \AgdaInductiveConstructor{yes} \AgdaBound{y≡y} \AgdaSymbol{=} \AgdaInductiveConstructor{refl} \<[31]%
\>[31]\<%
\\
\>\AgdaSymbol{...} \<[14]%
\>[14]\AgdaSymbol{|} \AgdaInductiveConstructor{no} \<[20]%
\>[20]\AgdaBound{y≢y} \AgdaSymbol{=} \AgdaFunction{⊥-elim} \AgdaSymbol{(}\AgdaBound{y≢y} \AgdaInductiveConstructor{refl}\AgdaSymbol{)} \<[54]%
\>[54]\<%
\\
\>\<\end{code}
      

\begin{code}\>\<%
\\
\>\AgdaFunction{lemma·} \AgdaSymbol{:} \AgdaSymbol{\{}\AgdaBound{M} \AgdaSymbol{:} \AgdaDatatype{Λ}\AgdaSymbol{\}\{}\AgdaBound{σ} \AgdaBound{σ'} \AgdaSymbol{:} \AgdaFunction{Σ}\AgdaSymbol{\}} \AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{M} \AgdaFunction{∙} \AgdaBound{σ}\AgdaSymbol{)} \AgdaFunction{∙} \AgdaBound{σ'} \AgdaDatatype{≡} \AgdaBound{M} \AgdaFunction{∙} \AgdaSymbol{(}\AgdaBound{σ'} \AgdaFunction{∘} \AgdaBound{σ}\AgdaSymbol{)}\<%
\\
\>\AgdaFunction{lemma·} \AgdaSymbol{\{}\AgdaInductiveConstructor{v} \AgdaBound{x}\AgdaSymbol{\}} \<[15]%
\>[15]\AgdaSymbol{\{}\AgdaBound{σ}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{σ'}\AgdaSymbol{\}} \AgdaSymbol{=} \AgdaInductiveConstructor{refl}\<%
\\
\>\AgdaFunction{lemma·} \AgdaSymbol{\{}\AgdaBound{M} \AgdaInductiveConstructor{·} \AgdaBound{N}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{σ}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{σ'}\AgdaSymbol{\}} \AgdaSymbol{=} \AgdaFunction{cong₂} \AgdaInductiveConstructor{\_·\_} \AgdaSymbol{(}\AgdaFunction{lemma·} \AgdaSymbol{\{}\AgdaBound{M}\AgdaSymbol{\})} \AgdaSymbol{(}\AgdaFunction{lemma·} \AgdaSymbol{\{}\AgdaBound{N}\AgdaSymbol{\})} \<[62]%
\>[62]\<%
\\
\>\AgdaFunction{lemma·} \AgdaSymbol{\{}\AgdaInductiveConstructor{ƛ} \AgdaBound{x} \AgdaBound{M}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{σ}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{σ'}\AgdaSymbol{\}} \<[24]%
\>[24]\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaSymbol{=} \AgdaFunction{begin≡}\<%
\\
\>[0]\AgdaIndent{6}{}\<[6]%
\>[6]\AgdaSymbol{((}\AgdaInductiveConstructor{ƛ} \AgdaBound{x} \AgdaBound{M}\AgdaSymbol{)} \AgdaFunction{∙} \AgdaBound{σ}\AgdaSymbol{)} \AgdaFunction{∙} \AgdaBound{σ'}\<%
\\
\>[0]\AgdaIndent{6}{}\<[6]%
\>[6]\AgdaFunction{≡⟨} \AgdaInductiveConstructor{refl} \AgdaFunction{⟩}\<%
\\
\>[0]\AgdaIndent{6}{}\<[6]%
\>[6]\AgdaSymbol{(}\AgdaInductiveConstructor{ƛ} \AgdaFunction{y} \AgdaSymbol{(}\AgdaBound{M} \AgdaFunction{∙} \AgdaSymbol{(}\AgdaBound{σ} \AgdaFunction{<+} \AgdaSymbol{(}\AgdaBound{x} \AgdaInductiveConstructor{,} \AgdaInductiveConstructor{v} \AgdaFunction{y}\AgdaSymbol{))))} \AgdaFunction{∙} \AgdaBound{σ'}\<%
\\
\>[0]\AgdaIndent{6}{}\<[6]%
\>[6]\AgdaFunction{≡⟨} \AgdaInductiveConstructor{refl} \AgdaFunction{⟩}\<%
\\
\>[0]\AgdaIndent{6}{}\<[6]%
\>[6]\AgdaInductiveConstructor{ƛ} \AgdaFunction{y'} \AgdaSymbol{((}\AgdaBound{M} \AgdaFunction{∙} \AgdaSymbol{(}\AgdaBound{σ} \AgdaFunction{<+} \AgdaSymbol{(}\AgdaBound{x} \AgdaInductiveConstructor{,} \AgdaInductiveConstructor{v} \AgdaFunction{y}\AgdaSymbol{)))} \AgdaFunction{∙} \AgdaSymbol{(}\AgdaBound{σ'} \AgdaFunction{<+} \AgdaSymbol{(}\AgdaFunction{y} \AgdaInductiveConstructor{,} \AgdaInductiveConstructor{v} \AgdaFunction{y'}\AgdaSymbol{)))}\<%
\\
\>[0]\AgdaIndent{6}{}\<[6]%
\>[6]\AgdaFunction{≡⟨} \AgdaFunction{cong} \AgdaSymbol{(λ} \AgdaBound{M} \AgdaSymbol{→} \AgdaInductiveConstructor{ƛ} \AgdaFunction{y'} \AgdaBound{M}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaFunction{lemma·} \AgdaSymbol{\{}\AgdaBound{M}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{σ} \AgdaFunction{<+} \AgdaSymbol{(}\AgdaBound{x} \AgdaInductiveConstructor{,} \AgdaInductiveConstructor{v} \AgdaFunction{y}\AgdaSymbol{)\}} \AgdaSymbol{\{}\AgdaBound{σ'} \AgdaFunction{<+} \AgdaSymbol{(}\AgdaFunction{y} \AgdaInductiveConstructor{,} \AgdaInductiveConstructor{v} \AgdaFunction{y'}\AgdaSymbol{)\})} \AgdaFunction{⟩}\<%
\\
\>[0]\AgdaIndent{6}{}\<[6]%
\>[6]\AgdaInductiveConstructor{ƛ} \AgdaFunction{y'} \AgdaSymbol{(}\AgdaBound{M} \AgdaFunction{∙} \AgdaSymbol{((}\AgdaBound{σ'} \AgdaFunction{<+} \AgdaSymbol{(}\AgdaFunction{y} \AgdaInductiveConstructor{,} \AgdaInductiveConstructor{v} \AgdaFunction{y'}\AgdaSymbol{))} \AgdaFunction{∘} \AgdaSymbol{(}\AgdaBound{σ} \AgdaFunction{<+} \AgdaSymbol{(}\AgdaBound{x} \AgdaInductiveConstructor{,} \AgdaInductiveConstructor{v} \AgdaFunction{y}\AgdaSymbol{))))} \<[57]%
\>[57]\<%
\\
\>[0]\AgdaIndent{6}{}\<[6]%
\>[6]\AgdaFunction{≡⟨} \AgdaFunction{cong} \AgdaSymbol{(λ} \AgdaBound{M} \AgdaSymbol{→} \AgdaInductiveConstructor{ƛ} \AgdaFunction{y'} \AgdaBound{M}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaFunction{lemmaσ≡σ'→Mσ≡Mσ'} \AgdaSymbol{\{}\AgdaBound{M}\AgdaSymbol{\}} \AgdaSymbol{\{(}\AgdaBound{σ'} \AgdaFunction{<+} \AgdaSymbol{(}\AgdaFunction{y} \AgdaInductiveConstructor{,} \AgdaInductiveConstructor{v} \AgdaFunction{y'}\AgdaSymbol{))} \AgdaFunction{∘} \AgdaSymbol{(}\AgdaBound{σ} \AgdaFunction{<+} \AgdaSymbol{(}\AgdaBound{x} \AgdaInductiveConstructor{,} \AgdaInductiveConstructor{v} \AgdaFunction{y}\AgdaSymbol{))\}} \AgdaSymbol{\{(}\AgdaBound{σ'} \AgdaFunction{∘} \AgdaBound{σ}\AgdaSymbol{)} \AgdaFunction{<+} \AgdaSymbol{(}\AgdaBound{x} \AgdaInductiveConstructor{,} \AgdaInductiveConstructor{v} \AgdaFunction{y'}\AgdaSymbol{)\}} \AgdaSymbol{(}\AgdaFunction{lemmaσ∘<+} \AgdaBound{M} \AgdaBound{σ} \AgdaBound{σ'} \AgdaBound{x} \AgdaFunction{y'}\AgdaSymbol{))} \AgdaFunction{⟩}\<%
\\
\>[0]\AgdaIndent{6}{}\<[6]%
\>[6]\AgdaInductiveConstructor{ƛ} \AgdaFunction{y'} \AgdaSymbol{(}\AgdaBound{M} \AgdaFunction{∙} \AgdaSymbol{((}\AgdaBound{σ'} \AgdaFunction{∘} \AgdaBound{σ}\AgdaSymbol{)} \AgdaFunction{<+} \AgdaSymbol{(}\AgdaBound{x} \AgdaInductiveConstructor{,} \AgdaInductiveConstructor{v} \AgdaFunction{y'}\AgdaSymbol{)))}\<%
\\
\>[0]\AgdaIndent{6}{}\<[6]%
\>[6]\AgdaFunction{≡⟨} \AgdaFunction{cong} \AgdaSymbol{(λ} \AgdaBound{z} \AgdaSymbol{→} \AgdaInductiveConstructor{ƛ} \AgdaBound{z} \AgdaSymbol{(}\AgdaBound{M} \AgdaFunction{∙} \AgdaSymbol{((}\AgdaBound{σ'} \AgdaFunction{∘} \AgdaBound{σ}\AgdaSymbol{)} \AgdaFunction{<+} \AgdaSymbol{(}\AgdaBound{x} \AgdaInductiveConstructor{,} \AgdaInductiveConstructor{v} \AgdaBound{z}\AgdaSymbol{))))} \AgdaFunction{lemma} \AgdaFunction{⟩}\<%
\\
\>[0]\AgdaIndent{6}{}\<[6]%
\>[6]\AgdaInductiveConstructor{ƛ} \AgdaFunction{z} \AgdaSymbol{(}\AgdaBound{M} \AgdaFunction{∙} \AgdaSymbol{((}\AgdaBound{σ'} \AgdaFunction{∘} \AgdaBound{σ}\AgdaSymbol{)} \AgdaFunction{<+} \AgdaSymbol{(}\AgdaBound{x} \AgdaInductiveConstructor{,} \AgdaInductiveConstructor{v} \AgdaFunction{z}\AgdaSymbol{)))}\<%
\\
\>[0]\AgdaIndent{6}{}\<[6]%
\>[6]\AgdaFunction{≡⟨} \AgdaInductiveConstructor{refl} \AgdaFunction{⟩}\<%
\\
\>[0]\AgdaIndent{6}{}\<[6]%
\>[6]\AgdaSymbol{(}\AgdaInductiveConstructor{ƛ} \AgdaBound{x} \AgdaBound{M}\AgdaSymbol{)} \AgdaFunction{∙} \AgdaSymbol{(}\AgdaBound{σ'} \AgdaFunction{∘} \AgdaBound{σ}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaIndent{3}{}\<[3]%
\>[3]\AgdaFunction{◻}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaKeyword{where} \<[8]%
\>[8]\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{y} \AgdaSymbol{=} \AgdaFunction{χ} \AgdaSymbol{(}\AgdaBound{σ} \AgdaInductiveConstructor{,} \AgdaInductiveConstructor{ƛ} \AgdaBound{x} \AgdaBound{M}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{y'} \AgdaSymbol{=} \AgdaFunction{χ} \AgdaSymbol{(}\AgdaBound{σ'} \AgdaInductiveConstructor{,} \AgdaInductiveConstructor{ƛ} \AgdaFunction{y} \AgdaSymbol{(}\AgdaBound{M} \AgdaFunction{∙} \AgdaSymbol{(}\AgdaBound{σ} \AgdaFunction{<+} \AgdaSymbol{(}\AgdaBound{x} \AgdaInductiveConstructor{,} \AgdaInductiveConstructor{v} \AgdaFunction{y}\AgdaSymbol{))))}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{z} \AgdaSymbol{=} \AgdaFunction{χ} \AgdaSymbol{(}\AgdaBound{σ'} \AgdaFunction{∘} \AgdaBound{σ} \AgdaInductiveConstructor{,} \AgdaInductiveConstructor{ƛ} \AgdaBound{x} \AgdaBound{M}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaComment{-- lemma 3.1 (viii) Stoughton}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{lemma3→} \AgdaSymbol{:} \<[13]%
\>[13]\AgdaSymbol{(}\AgdaBound{y'} \AgdaSymbol{:} \AgdaFunction{V}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaFunction{∃} \AgdaSymbol{(λ} \AgdaBound{x'} \AgdaSymbol{→} \<[35]%
\>[35]\AgdaBound{x'} \AgdaDatatype{*} \AgdaInductiveConstructor{ƛ} \AgdaFunction{y} \AgdaSymbol{(}\AgdaBound{M} \AgdaFunction{∙} \AgdaSymbol{(}\AgdaBound{σ} \AgdaFunction{<+} \AgdaSymbol{(}\AgdaBound{x} \AgdaInductiveConstructor{,} \AgdaInductiveConstructor{v} \AgdaFunction{y}\AgdaSymbol{)))} \AgdaFunction{×} \AgdaBound{y'} \AgdaDatatype{*} \AgdaBound{σ'} \AgdaBound{x'}\AgdaSymbol{)} \AgdaSymbol{→} \<[83]%
\>[83]\<%
\\
\>[2]\AgdaIndent{13}{}\<[13]%
\>[13]\AgdaFunction{∃} \AgdaSymbol{(λ} \AgdaBound{u} \AgdaSymbol{→} \AgdaBound{u} \AgdaDatatype{*} \AgdaInductiveConstructor{ƛ} \AgdaBound{x} \AgdaBound{M} \AgdaFunction{×} \AgdaBound{y'} \AgdaDatatype{*} \AgdaSymbol{(}\AgdaBound{σ'} \AgdaFunction{∘} \AgdaBound{σ}\AgdaSymbol{)} \AgdaBound{u}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{lemma3→} \AgdaBound{y'} \AgdaSymbol{(}\AgdaBound{x'} \AgdaInductiveConstructor{,} \AgdaSymbol{(}\AgdaInductiveConstructor{*ƛ} \AgdaBound{x'freeMσ<+xy} \AgdaBound{y≢x'}\AgdaSymbol{)} \AgdaInductiveConstructor{,} \AgdaBound{y'freeσ'x'}\AgdaSymbol{)} \AgdaKeyword{with} \AgdaFunction{lemmafreeσ→} \AgdaSymbol{\{}\AgdaBound{x'}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{M}\AgdaSymbol{\}} \AgdaBound{x'freeMσ<+xy} \<[95]%
\>[95]\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaSymbol{...} \AgdaSymbol{|} \AgdaBound{u} \AgdaInductiveConstructor{,} \AgdaBound{ufreeM} \AgdaInductiveConstructor{,} \AgdaBound{x'freeσ<+xyu} \AgdaKeyword{with} \AgdaBound{x} \AgdaFunction{≟} \AgdaBound{u}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaSymbol{...} \AgdaSymbol{|} \AgdaInductiveConstructor{no} \<[12]%
\>[12]\AgdaBound{x≢u} \AgdaSymbol{=} \<[19]%
\>[19]\AgdaBound{u} \AgdaInductiveConstructor{,} \AgdaInductiveConstructor{*ƛ} \AgdaBound{ufreeM} \AgdaBound{x≢u} \AgdaInductiveConstructor{,} \<[40]%
\>[40]\AgdaFunction{lemmafreeσ←} \AgdaSymbol{\{}\AgdaBound{y'}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{σ} \AgdaBound{u}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{σ'}\AgdaSymbol{\}} \AgdaSymbol{(}\AgdaBound{x'} \AgdaInductiveConstructor{,} \AgdaBound{x'freeσ<+xyu} \AgdaInductiveConstructor{,} \AgdaBound{y'freeσ'x'}\AgdaSymbol{)} \<[101]%
\>[101]\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{lemma3→} \AgdaBound{y'} \AgdaSymbol{(}\AgdaSymbol{.}\AgdaFunction{y} \AgdaInductiveConstructor{,} \AgdaSymbol{(}\AgdaInductiveConstructor{*ƛ} \AgdaBound{yfreeMσ<+xy} \AgdaBound{y≢y}\AgdaSymbol{)} \AgdaInductiveConstructor{,} \AgdaBound{y'freeσ'y} \AgdaSymbol{)}\<%
\\
\>[2]\AgdaIndent{6}{}\<[6]%
\>[6]\AgdaSymbol{|} \AgdaSymbol{.}\AgdaBound{x} \AgdaInductiveConstructor{,} \AgdaBound{xfreeM} \AgdaInductiveConstructor{,} \AgdaInductiveConstructor{*v}\<%
\\
\>[2]\AgdaIndent{6}{}\<[6]%
\>[6]\AgdaSymbol{|} \AgdaInductiveConstructor{yes} \AgdaInductiveConstructor{refl} \AgdaSymbol{=} \AgdaFunction{⊥-elim} \AgdaSymbol{(}\AgdaBound{y≢y} \AgdaInductiveConstructor{refl}\AgdaSymbol{)} \<[38]%
\>[38]\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{lemma3←} \AgdaSymbol{:} \<[13]%
\>[13]\AgdaSymbol{(}\AgdaBound{y'} \AgdaSymbol{:} \AgdaFunction{V}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaFunction{∃} \AgdaSymbol{(λ} \AgdaBound{x'} \AgdaSymbol{→} \AgdaBound{x'} \AgdaDatatype{*} \AgdaInductiveConstructor{ƛ} \AgdaBound{x} \AgdaBound{M} \AgdaFunction{×} \AgdaBound{y'} \AgdaDatatype{*} \AgdaSymbol{(}\AgdaBound{σ'} \AgdaFunction{∘} \AgdaBound{σ}\AgdaSymbol{)} \AgdaBound{x'}\AgdaSymbol{)} \AgdaSymbol{→}\<%
\\
\>[0]\AgdaIndent{13}{}\<[13]%
\>[13]\AgdaFunction{∃} \AgdaSymbol{(λ} \AgdaBound{u} \AgdaSymbol{→} \AgdaBound{u} \AgdaDatatype{*} \AgdaInductiveConstructor{ƛ} \AgdaFunction{y} \AgdaSymbol{(}\AgdaBound{M} \AgdaFunction{∙} \AgdaSymbol{(}\AgdaBound{σ} \AgdaFunction{<+} \AgdaSymbol{(}\AgdaBound{x} \AgdaInductiveConstructor{,} \AgdaInductiveConstructor{v} \AgdaFunction{y}\AgdaSymbol{)))} \AgdaFunction{×} \AgdaBound{y'} \AgdaDatatype{*} \AgdaBound{σ'} \AgdaBound{u}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{lemma3←} \AgdaBound{y'} \AgdaSymbol{(}\AgdaBound{x'} \AgdaInductiveConstructor{,} \AgdaSymbol{(}\AgdaInductiveConstructor{*ƛ} \AgdaBound{x'freeM} \AgdaBound{x≢x'}\AgdaSymbol{)} \AgdaInductiveConstructor{,} \AgdaBound{y'freeσσ'x'}\AgdaSymbol{)} \AgdaKeyword{with} \AgdaFunction{lemmafreeσ→} \AgdaSymbol{\{}\AgdaBound{y'}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{σ} \AgdaBound{x'}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{σ'}\AgdaSymbol{\}} \AgdaBound{y'freeσσ'x'} \<[98]%
\>[98]\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaSymbol{...} \AgdaSymbol{|} \AgdaBound{u} \AgdaInductiveConstructor{,} \AgdaBound{ufreeσx'} \AgdaInductiveConstructor{,} \AgdaBound{y'freeσ'u} \AgdaKeyword{with} \AgdaFunction{lemmafreeσ←} \AgdaSymbol{\{}\AgdaBound{u}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{M}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{σ} \AgdaFunction{<+} \AgdaSymbol{(}\AgdaBound{x} \AgdaInductiveConstructor{,} \AgdaInductiveConstructor{v} \AgdaFunction{y}\AgdaSymbol{)\}} \AgdaSymbol{(}\AgdaBound{x'} \AgdaInductiveConstructor{,} \AgdaBound{x'freeM} \<[90]%
\>[90]\AgdaInductiveConstructor{,} \AgdaFunction{lemma}\AgdaSymbol{)}\<%
\\
\>[2]\AgdaIndent{5}{}\<[5]%
\>[5]\AgdaKeyword{where} \AgdaFunction{lemma} \AgdaSymbol{:} \AgdaBound{u} \AgdaDatatype{*} \AgdaSymbol{((}\AgdaBound{σ} \AgdaFunction{<+} \AgdaSymbol{(}\AgdaBound{x} \AgdaInductiveConstructor{,} \AgdaInductiveConstructor{v} \AgdaFunction{y}\AgdaSymbol{))} \AgdaBound{x'}\AgdaSymbol{)}\<%
\\
\>[5]\AgdaIndent{11}{}\<[11]%
\>[11]\AgdaFunction{lemma} \AgdaKeyword{with} \AgdaBound{x} \AgdaFunction{≟} \AgdaBound{x'} \<[29]%
\>[29]\<%
\\
\>[5]\AgdaIndent{11}{}\<[11]%
\>[11]\AgdaSymbol{...} \AgdaSymbol{|} \AgdaInductiveConstructor{yes} \AgdaBound{x≡x'} \AgdaSymbol{=} \AgdaFunction{⊥-elim} \AgdaSymbol{(}\AgdaBound{x≢x'} \AgdaBound{x≡x'}\AgdaSymbol{)}\<%
\\
\>[5]\AgdaIndent{11}{}\<[11]%
\>[11]\AgdaSymbol{...} \AgdaSymbol{|} \AgdaInductiveConstructor{no} \<[21]%
\>[21]\AgdaSymbol{\_} \<[26]%
\>[26]\AgdaSymbol{=} \AgdaBound{ufreeσx'} \<[37]%
\>[37]\<%
\\
\>[4]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaSymbol{...} \AgdaSymbol{|} \AgdaBound{ufreeMσ<+xy} \AgdaSymbol{=} \AgdaBound{u} \AgdaInductiveConstructor{,} \AgdaInductiveConstructor{*ƛ} \AgdaBound{ufreeMσ<+xy} \AgdaSymbol{(}\AgdaFunction{y≢u} \AgdaBound{ufreeσx'}\AgdaSymbol{)} \AgdaInductiveConstructor{,} \AgdaBound{y'freeσ'u}\<%
\\
\>[0]\AgdaIndent{5}{}\<[5]%
\>[5]\AgdaKeyword{where} \AgdaFunction{y≢u} \AgdaSymbol{:} \AgdaSymbol{\{}\AgdaBound{u} \AgdaSymbol{:} \AgdaFunction{V}\AgdaSymbol{\}} \AgdaSymbol{→} \AgdaBound{u} \AgdaDatatype{*} \AgdaSymbol{(}\AgdaBound{σ} \AgdaBound{x'}\AgdaSymbol{)} \AgdaSymbol{→} \<[41]%
\>[41]\AgdaFunction{y} \AgdaFunction{≢} \AgdaBound{u}\<%
\\
\>[5]\AgdaIndent{11}{}\<[11]%
\>[11]\AgdaFunction{y≢u} \AgdaSymbol{\{}\AgdaBound{u}\AgdaSymbol{\}} \AgdaBound{ufreeσx'} \AgdaKeyword{with} \AgdaBound{u} \AgdaSymbol{|} \AgdaBound{ufreeσx'} \AgdaSymbol{|} \AgdaFunction{y} \AgdaFunction{≟} \AgdaBound{u} \<[54]%
\>[54]\<%
\\
\>[5]\AgdaIndent{11}{}\<[11]%
\>[11]\AgdaSymbol{...} \AgdaSymbol{|} \AgdaSymbol{.}\AgdaFunction{y} \AgdaSymbol{|} \AgdaBound{yfreeσx'} \AgdaSymbol{|} \AgdaInductiveConstructor{yes} \AgdaInductiveConstructor{refl} \<[42]%
\>[42]\<%
\\
\>[11]\AgdaIndent{13}{}\<[13]%
\>[13]\AgdaSymbol{=} \AgdaFunction{⊥-elim} \AgdaSymbol{((}\AgdaFunction{lemma-free→¬\#} \AgdaBound{yfreeσx'}\AgdaSymbol{)} \AgdaSymbol{((}\AgdaFunction{χ-lemma2} \AgdaBound{σ} \AgdaSymbol{(}\AgdaInductiveConstructor{ƛ} \AgdaBound{x} \AgdaBound{M}\AgdaSymbol{))} \AgdaBound{x'} \AgdaSymbol{(}\AgdaInductiveConstructor{*ƛ} \AgdaBound{x'freeM} \AgdaBound{x≢x'}\AgdaSymbol{)))} \<[94]%
\>[94]\<%
\\
\>[0]\AgdaIndent{11}{}\<[11]%
\>[11]\AgdaSymbol{...} \AgdaSymbol{|} \AgdaSymbol{\_} \<[20]%
\>[20]\AgdaSymbol{|} \AgdaSymbol{\_} \<[31]%
\>[31]\AgdaSymbol{|} \AgdaInductiveConstructor{no} \AgdaBound{y≢up} \<[42]%
\>[42]\AgdaSymbol{=} \<[45]%
\>[45]\AgdaBound{y≢up}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{lemma} \AgdaSymbol{:} \AgdaFunction{y'} \AgdaDatatype{≡} \AgdaFunction{z} \<[17]%
\>[17]\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{lemma} \AgdaSymbol{=} \<[11]%
\>[11]\AgdaFunction{χ-lemma4} \AgdaBound{σ'} \AgdaSymbol{(}\AgdaBound{σ'} \AgdaFunction{∘} \AgdaBound{σ}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaInductiveConstructor{ƛ} \AgdaFunction{y} \AgdaSymbol{(}\AgdaBound{M} \AgdaFunction{∙} \AgdaSymbol{(}\AgdaBound{σ} \AgdaFunction{<+} \AgdaSymbol{(}\AgdaBound{x} \AgdaInductiveConstructor{,} \AgdaInductiveConstructor{v} \AgdaFunction{y}\AgdaSymbol{))))} \AgdaSymbol{(}\AgdaInductiveConstructor{ƛ} \AgdaBound{x} \AgdaBound{M}\AgdaSymbol{)} \<[69]%
\>[69]\<%
\\
\>[2]\AgdaIndent{20}{}\<[20]%
\>[20]\AgdaSymbol{(}\AgdaFunction{lemma3→} \AgdaInductiveConstructor{,} \AgdaFunction{lemma3←}\AgdaSymbol{)}\<%
\\
\>\<\end{code}

\begin{code}\>\<%
\\
\>\AgdaFunction{lemma<+} \AgdaSymbol{:} \AgdaSymbol{\{}\AgdaBound{x} \AgdaBound{y} \AgdaBound{z} \AgdaSymbol{:} \AgdaFunction{V}\AgdaSymbol{\}\{}\AgdaBound{M} \AgdaSymbol{:} \AgdaDatatype{Λ}\AgdaSymbol{\}\{}\AgdaBound{σ} \AgdaSymbol{:} \AgdaFunction{Σ}\AgdaSymbol{\}} \AgdaSymbol{→} \AgdaBound{z} \AgdaDatatype{\#} \AgdaSymbol{(}\AgdaInductiveConstructor{ƛ} \AgdaBound{x} \AgdaBound{M}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaBound{M} \AgdaFunction{∙} \AgdaSymbol{(}\AgdaBound{σ} \AgdaFunction{<+} \AgdaSymbol{(}\AgdaBound{x} \AgdaInductiveConstructor{,} \AgdaInductiveConstructor{v} \AgdaBound{y}\AgdaSymbol{))} \AgdaDatatype{≡} \AgdaSymbol{(}\AgdaBound{M} \AgdaFunction{∙} \AgdaSymbol{(}\AgdaFunction{ι} \AgdaFunction{<+} \AgdaSymbol{(}\AgdaBound{x} \AgdaInductiveConstructor{,} \AgdaInductiveConstructor{v} \AgdaBound{z}\AgdaSymbol{)))} \AgdaFunction{∙} \AgdaSymbol{(}\AgdaBound{σ} \AgdaFunction{<+} \AgdaSymbol{(}\AgdaBound{z} \AgdaInductiveConstructor{,} \AgdaInductiveConstructor{v} \AgdaBound{y}\AgdaSymbol{))}\<%
\\
\>\AgdaFunction{lemma<+} \AgdaSymbol{\{}\AgdaBound{x}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{y}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{z}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{M}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{σ}\AgdaSymbol{\}} \AgdaBound{z\#λxM} \AgdaKeyword{rewrite} \AgdaFunction{lemma·} \AgdaSymbol{\{}\AgdaBound{M}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaFunction{ι} \AgdaFunction{<+} \AgdaSymbol{(}\AgdaBound{x} \AgdaInductiveConstructor{,} \AgdaInductiveConstructor{v} \AgdaBound{z}\AgdaSymbol{)\}} \AgdaSymbol{\{}\AgdaBound{σ} \AgdaFunction{<+} \AgdaSymbol{(}\AgdaBound{z} \AgdaInductiveConstructor{,} \AgdaInductiveConstructor{v} \AgdaBound{y}\AgdaSymbol{)\}} \<[87]%
\>[87]\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaSymbol{=} \AgdaFunction{lemmaσ≡σ'→Mσ≡Mσ'} \AgdaSymbol{\{}\AgdaBound{M}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{σ} \AgdaFunction{<+} \AgdaSymbol{(}\AgdaBound{x} \AgdaInductiveConstructor{,} \AgdaInductiveConstructor{v} \AgdaBound{y}\AgdaSymbol{)\}} \AgdaSymbol{\{(}\AgdaBound{σ} \AgdaFunction{<+} \AgdaSymbol{(}\AgdaBound{z} \AgdaInductiveConstructor{,} \AgdaInductiveConstructor{v} \AgdaBound{y}\AgdaSymbol{))} \AgdaFunction{∘} \AgdaSymbol{(}\AgdaFunction{ι} \AgdaFunction{<+} \AgdaSymbol{(}\AgdaBound{x} \AgdaInductiveConstructor{,} \AgdaInductiveConstructor{v} \AgdaBound{z}\AgdaSymbol{))\}} \AgdaFunction{lemma}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaKeyword{where}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{lemma} \AgdaSymbol{:} \AgdaSymbol{(}\AgdaBound{w} \AgdaSymbol{:} \AgdaFunction{V}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaBound{w} \AgdaDatatype{*} \AgdaBound{M} \AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{σ} \AgdaFunction{<+} \AgdaSymbol{(}\AgdaBound{x} \AgdaInductiveConstructor{,} \AgdaInductiveConstructor{v} \AgdaBound{y}\AgdaSymbol{))} \AgdaBound{w} \AgdaDatatype{≡} \AgdaSymbol{(((}\AgdaBound{σ} \AgdaFunction{<+} \AgdaSymbol{(}\AgdaBound{z} \AgdaInductiveConstructor{,} \AgdaInductiveConstructor{v} \AgdaBound{y}\AgdaSymbol{))} \AgdaFunction{∘} \AgdaSymbol{(}\AgdaFunction{ι} \AgdaFunction{<+} \AgdaSymbol{(}\AgdaBound{x} \AgdaInductiveConstructor{,} \AgdaInductiveConstructor{v} \AgdaBound{z}\AgdaSymbol{)))} \AgdaBound{w}\AgdaSymbol{)} \AgdaComment{-- este me sirve ???}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{lemma} \AgdaBound{w} \AgdaBound{wfreeM} \AgdaKeyword{with} \AgdaBound{x} \AgdaFunction{≟} \AgdaBound{w}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaSymbol{...} \AgdaSymbol{|} \AgdaInductiveConstructor{no} \AgdaBound{x≢w} \<[16]%
\>[16]\AgdaKeyword{with} \AgdaBound{z} \AgdaFunction{≟} \AgdaBound{w}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaSymbol{...} \AgdaSymbol{|} \AgdaInductiveConstructor{no} \AgdaSymbol{\_} \<[16]%
\>[16]\AgdaSymbol{=} \AgdaInductiveConstructor{refl}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaSymbol{...} \AgdaSymbol{|} \AgdaInductiveConstructor{yes} \AgdaBound{z≡w} \AgdaSymbol{=} \AgdaFunction{⊥-elim} \AgdaSymbol{((}\AgdaFunction{z≢w} \AgdaBound{x} \AgdaBound{y} \AgdaBound{z} \AgdaBound{w} \AgdaBound{M} \AgdaBound{z\#λxM} \AgdaBound{wfreeM} \AgdaBound{x≢w}\AgdaSymbol{)} \AgdaBound{z≡w}\AgdaSymbol{)}\<%
\\
\>[2]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaKeyword{where}\<%
\\
\>[2]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaFunction{z≢w} \AgdaSymbol{:} \AgdaSymbol{(}\AgdaBound{x} \AgdaBound{y} \AgdaBound{z} \AgdaBound{w} \AgdaSymbol{:} \AgdaFunction{V}\AgdaSymbol{)(}\AgdaBound{M} \AgdaSymbol{:} \AgdaDatatype{Λ}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaBound{z} \AgdaDatatype{\#} \AgdaSymbol{(}\AgdaInductiveConstructor{ƛ} \AgdaBound{x} \AgdaBound{M}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaBound{w} \AgdaDatatype{*} \AgdaBound{M} \AgdaSymbol{→} \AgdaBound{x} \AgdaFunction{≢} \AgdaBound{w} \<[62]%
\>[62]\AgdaSymbol{→} \AgdaBound{z} \AgdaFunction{≢} \AgdaBound{w}\<%
\\
\>[2]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaFunction{z≢w} \AgdaBound{x} \AgdaBound{y} \AgdaSymbol{.}\AgdaBound{x} \AgdaBound{w} \AgdaBound{M} \AgdaInductiveConstructor{\#ƛ≡} \AgdaBound{wfreeM} \AgdaBound{x≢w} \AgdaSymbol{=} \AgdaBound{x≢w}\<%
\\
\>[2]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaFunction{z≢w} \AgdaBound{x} \AgdaBound{y} \AgdaBound{z} \AgdaBound{w} \AgdaBound{M} \AgdaSymbol{(}\AgdaInductiveConstructor{\#ƛ} \<[23]%
\>[23]\AgdaBound{z\#M}\AgdaSymbol{)} \AgdaBound{wfreeM} \AgdaBound{x≢w} \AgdaKeyword{with} \AgdaBound{z} \AgdaFunction{≟} \AgdaBound{w}\<%
\\
\>[2]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaSymbol{...} \AgdaSymbol{|} \AgdaInductiveConstructor{no} \AgdaBound{z≢w} \AgdaSymbol{=} \AgdaBound{z≢w}\<%
\\
\>[2]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaFunction{z≢w} \AgdaBound{x} \AgdaBound{y} \AgdaBound{z} \AgdaSymbol{.}\AgdaBound{z} \AgdaBound{M} \AgdaSymbol{(}\AgdaInductiveConstructor{\#ƛ} \<[24]%
\>[24]\AgdaBound{z\#M}\AgdaSymbol{)} \AgdaBound{zfreeM} \AgdaBound{x≢w}\<%
\\
\>[4]\AgdaIndent{8}{}\<[8]%
\>[8]\AgdaSymbol{|} \AgdaInductiveConstructor{yes} \AgdaInductiveConstructor{refl} \AgdaSymbol{=} \AgdaFunction{⊥-elim} \AgdaSymbol{((}\AgdaFunction{lemma-free→¬\#} \AgdaBound{zfreeM}\AgdaSymbol{)} \AgdaBound{z\#M}\AgdaSymbol{)}\<%
\\
\>[2]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{lemma} \AgdaBound{w} \AgdaBound{wfreeM}\<%
\\
\>[0]\AgdaIndent{6}{}\<[6]%
\>[6]\AgdaSymbol{|} \AgdaInductiveConstructor{yes} \AgdaSymbol{\_} \AgdaKeyword{with} \AgdaBound{z} \AgdaFunction{≟} \AgdaBound{z} \<[25]%
\>[25]\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaSymbol{...} \AgdaSymbol{|} \AgdaInductiveConstructor{yes} \AgdaSymbol{\_} \<[16]%
\>[16]\AgdaSymbol{=} \AgdaInductiveConstructor{refl}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaSymbol{...} \AgdaSymbol{|} \AgdaInductiveConstructor{no} \AgdaBound{z≢z} \<[16]%
\>[16]\AgdaSymbol{=} \AgdaFunction{⊥-elim} \AgdaSymbol{(}\AgdaBound{z≢z} \AgdaInductiveConstructor{refl}\AgdaSymbol{)}\<%
\\
\>\<\end{code}

\begin{code}\>\<%
\\
\>\AgdaFunction{lemmaM∼M'→Mσ≡M'σ} \AgdaSymbol{:} \AgdaSymbol{\{}\AgdaBound{M} \AgdaBound{M'} \AgdaSymbol{:} \AgdaDatatype{Λ}\AgdaSymbol{\}\{}\AgdaBound{σ} \AgdaSymbol{:} \AgdaFunction{Σ}\AgdaSymbol{\}} \<[37]%
\>[37]\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaSymbol{→} \AgdaBound{M} \AgdaDatatype{∼α} \AgdaBound{M'} \AgdaSymbol{→} \AgdaBound{M} \AgdaFunction{∙} \AgdaBound{σ} \AgdaDatatype{≡} \AgdaBound{M'} \AgdaFunction{∙} \AgdaBound{σ}\<%
\\
\>\AgdaFunction{lemmaM∼M'→Mσ≡M'σ} \AgdaInductiveConstructor{∼v} \<[33]%
\>[33]\AgdaSymbol{=} \AgdaInductiveConstructor{refl}\<%
\\
\>\AgdaFunction{lemmaM∼M'→Mσ≡M'σ} \AgdaSymbol{(}\AgdaInductiveConstructor{∼·} \AgdaBound{M∼M'} \AgdaBound{N∼N'}\AgdaSymbol{)} \AgdaSymbol{=} \AgdaFunction{cong₂} \AgdaInductiveConstructor{\_·\_} \AgdaSymbol{(}\AgdaFunction{lemmaM∼M'→Mσ≡M'σ} \AgdaBound{M∼M'}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaFunction{lemmaM∼M'→Mσ≡M'σ} \AgdaBound{N∼N'}\AgdaSymbol{)}\<%
\\
\>\AgdaFunction{lemmaM∼M'→Mσ≡M'σ} \AgdaSymbol{\{}\AgdaInductiveConstructor{ƛ} \AgdaBound{x} \AgdaBound{M}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaInductiveConstructor{ƛ} \AgdaBound{x'} \AgdaBound{M'}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{σ}\AgdaSymbol{\}} \<[39]%
\>[39]\<%
\\
\>[2]\AgdaIndent{17}{}\<[17]%
\>[17]\AgdaSymbol{(}\AgdaInductiveConstructor{∼ƛ} \AgdaSymbol{.\{}\AgdaBound{M}\AgdaSymbol{\}} \AgdaSymbol{.\{}\AgdaBound{M'}\AgdaSymbol{\}} \AgdaSymbol{.\{}\AgdaBound{x}\AgdaSymbol{\}} \AgdaSymbol{.\{}\AgdaBound{x'}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{z}\AgdaSymbol{\}} \AgdaBound{z\#λxM} \AgdaBound{z\#λx'M'} \AgdaBound{Mι<+xz∼M'ι<+x'z}\AgdaSymbol{)} \<[78]%
\>[78]\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaKeyword{with} \AgdaFunction{χ} \AgdaSymbol{(}\AgdaBound{σ} \AgdaInductiveConstructor{,} \AgdaInductiveConstructor{ƛ} \AgdaBound{x} \AgdaBound{M}\AgdaSymbol{)} \AgdaSymbol{|} \AgdaFunction{χ} \AgdaSymbol{(}\AgdaBound{σ} \AgdaInductiveConstructor{,} \AgdaInductiveConstructor{ƛ} \AgdaBound{x'} \AgdaBound{M'}\AgdaSymbol{)} \<[39]%
\>[39]\<%
\\
\>[0]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaSymbol{|} \AgdaFunction{χ-lemma3} \AgdaBound{σ} \AgdaBound{σ} \AgdaSymbol{(}\AgdaInductiveConstructor{ƛ} \AgdaBound{x} \AgdaBound{M}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaInductiveConstructor{ƛ} \AgdaBound{x'} \AgdaBound{M'}\AgdaSymbol{)} \<[37]%
\>[37]\<%
\\
\>[4]\AgdaIndent{9}{}\<[9]%
\>[9]\AgdaSymbol{(λ} \AgdaBound{\_} \AgdaBound{\_} \AgdaSymbol{→} \AgdaSymbol{(λ} \AgdaBound{\_} \AgdaBound{yfreeσx} \AgdaSymbol{→} \AgdaBound{yfreeσx}\AgdaSymbol{)} \AgdaInductiveConstructor{,} \AgdaSymbol{(λ} \AgdaBound{\_} \AgdaBound{yfreeσx} \AgdaSymbol{→} \AgdaBound{yfreeσx}\AgdaSymbol{))}\<%
\\
\>[4]\AgdaIndent{9}{}\<[9]%
\>[9]\AgdaSymbol{(} \AgdaSymbol{(}\AgdaFunction{lemmaM∼M'→free→} \AgdaSymbol{\{}\AgdaInductiveConstructor{ƛ} \AgdaBound{x} \AgdaBound{M}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaInductiveConstructor{ƛ} \AgdaBound{x'} \AgdaBound{M'}\AgdaSymbol{\}} \AgdaSymbol{(}\AgdaInductiveConstructor{∼ƛ} \AgdaSymbol{\{}\AgdaBound{M}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{M'}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{x}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{x'}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{z}\AgdaSymbol{\}} \AgdaBound{z\#λxM} \AgdaBound{z\#λx'M'} \AgdaBound{Mι<+xz∼M'ι<+x'z}\AgdaSymbol{))} \AgdaInductiveConstructor{,}\<%
\\
\>[9]\AgdaIndent{11}{}\<[11]%
\>[11]\AgdaSymbol{(}\AgdaFunction{lemmaM∼M'→free←} \AgdaSymbol{\{}\AgdaInductiveConstructor{ƛ} \AgdaBound{x} \AgdaBound{M}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaInductiveConstructor{ƛ} \AgdaBound{x'} \AgdaBound{M'}\AgdaSymbol{\}} \AgdaSymbol{(}\AgdaInductiveConstructor{∼ƛ} \AgdaSymbol{\{}\AgdaBound{M}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{M'}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{x}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{x'}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{z}\AgdaSymbol{\}} \AgdaBound{z\#λxM} \AgdaBound{z\#λx'M'} \AgdaBound{Mι<+xz∼M'ι<+x'z}\AgdaSymbol{)))}\<%
\\
\>\AgdaSymbol{...} \AgdaSymbol{|} \AgdaBound{y} \AgdaSymbol{|} \AgdaSymbol{.}\AgdaBound{y} \AgdaSymbol{|} \AgdaInductiveConstructor{refl} \<[20]%
\>[20]\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaSymbol{=} \AgdaFunction{cong} \AgdaSymbol{(λ} \AgdaBound{M} \AgdaSymbol{→} \AgdaInductiveConstructor{ƛ} \AgdaBound{y} \AgdaBound{M}\AgdaSymbol{)} \<[23]%
\>[23]\<%
\\
\>[0]\AgdaIndent{9}{}\<[9]%
\>[9]\AgdaSymbol{(}\AgdaFunction{begin≡}\<%
\\
\>[9]\AgdaIndent{11}{}\<[11]%
\>[11]\AgdaBound{M} \AgdaFunction{∙} \AgdaSymbol{(}\AgdaBound{σ} \AgdaFunction{<+} \AgdaSymbol{(}\AgdaBound{x} \AgdaInductiveConstructor{,} \AgdaInductiveConstructor{v} \AgdaBound{y}\AgdaSymbol{))}\<%
\\
\>[9]\AgdaIndent{11}{}\<[11]%
\>[11]\AgdaFunction{≡⟨} \AgdaFunction{lemma<+} \AgdaBound{z\#λxM} \AgdaFunction{⟩}\<%
\\
\>[9]\AgdaIndent{11}{}\<[11]%
\>[11]\AgdaSymbol{(}\AgdaBound{M} \AgdaFunction{∙} \AgdaSymbol{(}\AgdaFunction{ι} \AgdaFunction{<+} \AgdaSymbol{(}\AgdaBound{x} \AgdaInductiveConstructor{,} \AgdaInductiveConstructor{v} \AgdaBound{z}\AgdaSymbol{)))} \AgdaFunction{∙} \AgdaSymbol{(}\AgdaBound{σ} \AgdaFunction{<+} \AgdaSymbol{(}\AgdaBound{z} \AgdaInductiveConstructor{,} \AgdaInductiveConstructor{v} \AgdaBound{y}\AgdaSymbol{))}\<%
\\
\>[9]\AgdaIndent{11}{}\<[11]%
\>[11]\AgdaFunction{≡⟨} \AgdaFunction{lemmaM∼M'→Mσ≡M'σ} \AgdaSymbol{\{}\AgdaBound{M} \AgdaFunction{∙} \AgdaSymbol{(}\AgdaFunction{ι} \AgdaFunction{<+} \AgdaSymbol{(}\AgdaBound{x} \AgdaInductiveConstructor{,} \AgdaInductiveConstructor{v} \AgdaBound{z}\AgdaSymbol{))\}} \AgdaSymbol{\{}\AgdaBound{M'} \AgdaFunction{∙} \AgdaSymbol{(}\AgdaFunction{ι} \AgdaFunction{<+} \AgdaSymbol{(}\AgdaBound{x'} \AgdaInductiveConstructor{,} \AgdaInductiveConstructor{v} \AgdaBound{z}\AgdaSymbol{))\}} \AgdaSymbol{\{}\AgdaBound{σ} \AgdaFunction{<+} \AgdaSymbol{(}\AgdaBound{z} \AgdaInductiveConstructor{,} \AgdaInductiveConstructor{v} \AgdaBound{y}\AgdaSymbol{)\}} \AgdaBound{Mι<+xz∼M'ι<+x'z} \AgdaFunction{⟩}\<%
\\
\>[9]\AgdaIndent{11}{}\<[11]%
\>[11]\AgdaSymbol{(}\AgdaBound{M'} \AgdaFunction{∙} \AgdaSymbol{(}\AgdaFunction{ι} \AgdaFunction{<+} \AgdaSymbol{(}\AgdaBound{x'} \AgdaInductiveConstructor{,} \AgdaInductiveConstructor{v} \AgdaBound{z}\AgdaSymbol{)))} \AgdaFunction{∙} \AgdaSymbol{(}\AgdaBound{σ} \AgdaFunction{<+} \AgdaSymbol{(}\AgdaBound{z} \AgdaInductiveConstructor{,} \AgdaInductiveConstructor{v} \AgdaBound{y}\AgdaSymbol{))}\<%
\\
\>[9]\AgdaIndent{11}{}\<[11]%
\>[11]\AgdaFunction{≡⟨} \AgdaFunction{sym} \AgdaSymbol{(}\AgdaFunction{lemma<+} \AgdaBound{z\#λx'M'}\AgdaSymbol{)} \AgdaFunction{⟩}\<%
\\
\>[9]\AgdaIndent{11}{}\<[11]%
\>[11]\AgdaBound{M'} \AgdaFunction{∙} \AgdaSymbol{(}\AgdaBound{σ} \AgdaFunction{<+} \AgdaSymbol{(}\AgdaBound{x'} \AgdaInductiveConstructor{,} \AgdaInductiveConstructor{v} \AgdaBound{y}\AgdaSymbol{))}\<%
\\
\>[-8]\AgdaIndent{10}{}\<[10]%
\>[10]\AgdaFunction{◻}\AgdaSymbol{)}\<%
\\
\>\<\end{code}

\begin{code}\>\<%
\\
\>\AgdaKeyword{open} \AgdaKeyword{import} \AgdaModule{Induction.Nat}\<%
\\
%
\\
\>\AgdaFunction{lemma-χι} \AgdaSymbol{:} \AgdaSymbol{(}\AgdaBound{M} \AgdaSymbol{:} \AgdaDatatype{Λ}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaFunction{χ} \AgdaSymbol{(}\AgdaFunction{ι} \AgdaInductiveConstructor{,} \AgdaBound{M}\AgdaSymbol{)} \AgdaDatatype{\#} \AgdaBound{M}\<%
\\
\>\AgdaFunction{lemma-χι} \AgdaBound{M} \AgdaSymbol{=} \AgdaFunction{lemmafree\#y→\#} \AgdaSymbol{(}\AgdaFunction{χ-lemma2} \AgdaFunction{ι} \AgdaBound{M}\AgdaSymbol{)}\<%
\\
%
\\
\>\AgdaFunction{lemmaMι≡M'ι→M∼M'-aux} \AgdaSymbol{:} \AgdaSymbol{(}\AgdaBound{n} \AgdaSymbol{:} \AgdaDatatype{ℕ}\AgdaSymbol{)} \AgdaSymbol{→}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaSymbol{((}\AgdaBound{y} \AgdaSymbol{:} \AgdaDatatype{ℕ}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaInductiveConstructor{suc} \AgdaBound{y} \AgdaDatatype{≤′} \AgdaBound{n} \AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{M} \AgdaBound{M'} \AgdaSymbol{:} \AgdaDatatype{Λ}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaBound{y} \AgdaDatatype{≡} \AgdaFunction{length} \AgdaBound{M} \AgdaSymbol{→} \AgdaBound{M} \AgdaFunction{∙} \AgdaFunction{ι} \AgdaDatatype{≡} \AgdaBound{M'} \AgdaFunction{∙} \AgdaFunction{ι} \AgdaSymbol{→} \AgdaBound{M} \AgdaDatatype{∼α} \AgdaBound{M'}\AgdaSymbol{)} \AgdaSymbol{→} \<[102]%
\>[102]\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaSymbol{(}\AgdaBound{M} \AgdaBound{M'} \AgdaSymbol{:} \AgdaDatatype{Λ}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaBound{n} \AgdaDatatype{≡} \AgdaFunction{length} \AgdaBound{M} \AgdaSymbol{→} \AgdaBound{M} \AgdaFunction{∙} \AgdaFunction{ι} \AgdaDatatype{≡} \AgdaBound{M'} \AgdaFunction{∙} \AgdaFunction{ι} \AgdaSymbol{→} \AgdaBound{M} \AgdaDatatype{∼α} \AgdaBound{M'} \<[56]%
\>[56]\<%
\\
\>\AgdaFunction{lemmaMι≡M'ι→M∼M'-aux} \AgdaSymbol{.(}\AgdaInductiveConstructor{suc} \AgdaInductiveConstructor{zero}\AgdaSymbol{)} \AgdaBound{rec} \AgdaSymbol{(}\AgdaInductiveConstructor{v} \AgdaBound{x}\AgdaSymbol{)} \<[45]%
\>[45]\AgdaSymbol{(}\AgdaInductiveConstructor{v} \AgdaSymbol{.}\AgdaBound{x}\AgdaSymbol{)} \<[55]%
\>[55]\AgdaInductiveConstructor{refl} \AgdaInductiveConstructor{refl} \AgdaSymbol{=} \AgdaInductiveConstructor{∼v}\<%
\\
\>\AgdaFunction{lemmaMι≡M'ι→M∼M'-aux} \AgdaSymbol{.(}\AgdaInductiveConstructor{suc} \AgdaInductiveConstructor{zero}\AgdaSymbol{)} \AgdaBound{rec} \AgdaSymbol{(}\AgdaInductiveConstructor{v} \AgdaBound{x}\AgdaSymbol{)} \<[45]%
\>[45]\AgdaSymbol{(}\AgdaBound{M} \AgdaInductiveConstructor{·} \AgdaBound{N}\AgdaSymbol{)} \<[55]%
\>[55]\AgdaInductiveConstructor{refl} \AgdaSymbol{()} \<[63]%
\>[63]\<%
\\
\>\AgdaFunction{lemmaMι≡M'ι→M∼M'-aux} \AgdaSymbol{.(}\AgdaInductiveConstructor{suc} \AgdaInductiveConstructor{zero}\AgdaSymbol{)} \AgdaBound{rec} \AgdaSymbol{(}\AgdaInductiveConstructor{v} \AgdaBound{x}\AgdaSymbol{)} \<[45]%
\>[45]\AgdaSymbol{(}\AgdaInductiveConstructor{ƛ} \AgdaBound{y} \AgdaBound{M}\AgdaSymbol{)} \<[55]%
\>[55]\AgdaInductiveConstructor{refl} \AgdaSymbol{()} \<[63]%
\>[63]\<%
\\
\>\AgdaFunction{lemmaMι≡M'ι→M∼M'-aux} \AgdaBound{n} \<[33]%
\>[33]\AgdaBound{rec} \AgdaSymbol{(}\AgdaBound{M} \AgdaInductiveConstructor{·} \AgdaBound{N}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaInductiveConstructor{v} \AgdaBound{x}\AgdaSymbol{)} \<[55]%
\>[55]\AgdaSymbol{\_} \<[60]%
\>[60]\AgdaSymbol{()}\<%
\\
\>\AgdaFunction{lemmaMι≡M'ι→M∼M'-aux} \AgdaSymbol{.(}\AgdaFunction{length} \AgdaBound{M} \AgdaPrimitive{+} \AgdaFunction{length} \AgdaBound{N}\AgdaSymbol{)} \AgdaBound{rec} \AgdaSymbol{(}\AgdaBound{M} \AgdaInductiveConstructor{·} \AgdaBound{N}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaBound{M'} \AgdaInductiveConstructor{·} \AgdaBound{N'}\AgdaSymbol{)} \AgdaInductiveConstructor{refl} \AgdaBound{MNι≡M'N'ι}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaSymbol{=} \AgdaInductiveConstructor{∼·} \<[8]%
\>[8]\AgdaSymbol{(}\AgdaBound{rec} \AgdaSymbol{(}\AgdaFunction{length} \AgdaBound{M}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaFunction{lemmam>0→m+1≤m+n} \AgdaSymbol{(}\AgdaFunction{length>0} \AgdaSymbol{\{}\AgdaBound{N}\AgdaSymbol{\}))} \AgdaBound{M} \AgdaBound{M'} \AgdaInductiveConstructor{refl} \AgdaSymbol{(}\AgdaFunction{proj₁} \AgdaSymbol{(}\AgdaFunction{lemmaMι≡M'ι} \AgdaBound{MNι≡M'N'ι}\AgdaSymbol{)))}\<%
\\
\>[2]\AgdaIndent{8}{}\<[8]%
\>[8]\AgdaSymbol{(}\AgdaBound{rec} \AgdaSymbol{(}\AgdaFunction{length} \AgdaBound{N}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaFunction{lemman>0→n+1≤m+n} \AgdaSymbol{(}\AgdaFunction{length>0} \AgdaSymbol{\{}\AgdaBound{M}\AgdaSymbol{\}))} \AgdaBound{N} \AgdaBound{N'} \AgdaInductiveConstructor{refl} \AgdaSymbol{(}\AgdaFunction{proj₂} \AgdaSymbol{(}\AgdaFunction{lemmaMι≡M'ι} \AgdaBound{MNι≡M'N'ι}\AgdaSymbol{))} \AgdaSymbol{)}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaKeyword{where} \<[8]%
\>[8]\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{lemmaMι≡M'ι} \AgdaSymbol{:} \AgdaSymbol{(}\AgdaBound{M} \AgdaInductiveConstructor{·} \AgdaBound{N}\AgdaSymbol{)} \AgdaFunction{∙} \AgdaFunction{ι} \AgdaDatatype{≡} \AgdaSymbol{(}\AgdaBound{M'} \AgdaInductiveConstructor{·} \AgdaBound{N'}\AgdaSymbol{)} \AgdaFunction{∙} \AgdaFunction{ι} \AgdaSymbol{→} \AgdaBound{M} \AgdaFunction{∙} \AgdaFunction{ι} \AgdaDatatype{≡} \AgdaBound{M'} \AgdaFunction{∙} \AgdaFunction{ι} \AgdaFunction{×} \AgdaBound{N} \AgdaFunction{∙} \AgdaFunction{ι} \AgdaDatatype{≡} \AgdaBound{N'} \AgdaFunction{∙} \AgdaFunction{ι}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{lemmaMι≡M'ι} \AgdaBound{MNι≡M'N'ι} \AgdaKeyword{with} \AgdaBound{M'} \AgdaFunction{∙} \AgdaFunction{ι} \AgdaSymbol{|} \AgdaBound{N'} \AgdaFunction{∙} \AgdaFunction{ι} \AgdaSymbol{|} \AgdaBound{MNι≡M'N'ι}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaSymbol{...} \AgdaSymbol{|} \AgdaSymbol{.(}\AgdaBound{M} \AgdaFunction{∙} \AgdaFunction{ι}\AgdaSymbol{)} \AgdaSymbol{|} \AgdaSymbol{.(}\AgdaBound{N} \AgdaFunction{∙} \AgdaFunction{ι}\AgdaSymbol{)} \AgdaSymbol{|} \AgdaInductiveConstructor{refl} \AgdaSymbol{=} \AgdaInductiveConstructor{refl} \AgdaInductiveConstructor{,} \AgdaInductiveConstructor{refl}\<%
\\
\>\AgdaFunction{lemmaMι≡M'ι→M∼M'-aux} \AgdaBound{n} \<[33]%
\>[33]\AgdaBound{rec} \AgdaSymbol{(}\AgdaBound{M} \AgdaInductiveConstructor{·} \AgdaBound{N}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaInductiveConstructor{ƛ} \AgdaBound{x} \AgdaBound{M'}\AgdaSymbol{)} \<[55]%
\>[55]\AgdaSymbol{\_} \<[60]%
\>[60]\AgdaSymbol{()} \<[63]%
\>[63]\<%
\\
\>\AgdaFunction{lemmaMι≡M'ι→M∼M'-aux} \AgdaBound{n} \<[33]%
\>[33]\AgdaBound{rec} \AgdaSymbol{(}\AgdaInductiveConstructor{ƛ} \AgdaBound{x} \AgdaBound{M}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaInductiveConstructor{v} \AgdaBound{y}\AgdaSymbol{)} \<[55]%
\>[55]\AgdaSymbol{\_} \<[60]%
\>[60]\AgdaSymbol{()} \<[63]%
\>[63]\<%
\\
\>\AgdaFunction{lemmaMι≡M'ι→M∼M'-aux} \AgdaBound{n} \<[33]%
\>[33]\AgdaBound{rec} \AgdaSymbol{(}\AgdaInductiveConstructor{ƛ} \AgdaBound{x} \AgdaBound{M}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaBound{M'} \AgdaInductiveConstructor{·} \AgdaBound{N'}\AgdaSymbol{)} \AgdaSymbol{\_} \<[60]%
\>[60]\AgdaSymbol{()}\<%
\\
\>\AgdaFunction{lemmaMι≡M'ι→M∼M'-aux} \AgdaSymbol{.(}\AgdaInductiveConstructor{suc} \AgdaSymbol{(}\AgdaFunction{length} \AgdaBound{M}\AgdaSymbol{))} \AgdaBound{rec} \AgdaSymbol{(}\AgdaInductiveConstructor{ƛ} \AgdaBound{x} \AgdaBound{M}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaInductiveConstructor{ƛ} \AgdaBound{x'} \AgdaBound{M'}\AgdaSymbol{)} \AgdaInductiveConstructor{refl} \AgdaBound{λxMι≡λx'M'} \<[77]%
\>[77]\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaKeyword{with} \AgdaFunction{lemmaλxMι≡λx'M'ι} \AgdaBound{λxMι≡λx'M'} \<[35]%
\>[35]\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaKeyword{where}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{lemmaλxMι≡λx'M'ι} \AgdaSymbol{:} \AgdaSymbol{(}\AgdaInductiveConstructor{ƛ} \AgdaBound{x} \AgdaBound{M}\AgdaSymbol{)} \AgdaFunction{∙} \AgdaFunction{ι} \AgdaDatatype{≡} \AgdaSymbol{(}\AgdaInductiveConstructor{ƛ} \AgdaBound{x'} \AgdaBound{M'}\AgdaSymbol{)} \AgdaFunction{∙} \AgdaFunction{ι} \AgdaSymbol{→} \<[51]%
\>[51]\<%
\\
\>[2]\AgdaIndent{21}{}\<[21]%
\>[21]\AgdaFunction{χ} \AgdaSymbol{(}\AgdaFunction{ι} \AgdaInductiveConstructor{,} \AgdaInductiveConstructor{ƛ} \AgdaBound{x} \AgdaBound{M}\AgdaSymbol{)} \AgdaDatatype{≡} \AgdaFunction{χ} \AgdaSymbol{(}\AgdaFunction{ι} \AgdaInductiveConstructor{,} \AgdaInductiveConstructor{ƛ} \AgdaBound{x'} \AgdaBound{M'}\AgdaSymbol{)} \AgdaFunction{×} \<[55]%
\>[55]\<%
\\
\>[2]\AgdaIndent{21}{}\<[21]%
\>[21]\AgdaBound{M} \AgdaFunction{∙} \AgdaSymbol{(}\AgdaFunction{ι} \AgdaFunction{<+} \AgdaSymbol{(}\AgdaBound{x} \AgdaInductiveConstructor{,} \AgdaInductiveConstructor{v} \AgdaSymbol{(}\AgdaFunction{χ} \AgdaSymbol{(}\AgdaFunction{ι} \AgdaInductiveConstructor{,} \AgdaInductiveConstructor{ƛ} \AgdaBound{x} \AgdaBound{M}\AgdaSymbol{))))} \AgdaDatatype{≡} \AgdaBound{M'} \AgdaFunction{∙} \AgdaSymbol{(}\AgdaFunction{ι} \AgdaFunction{<+} \AgdaSymbol{(}\AgdaBound{x'} \AgdaInductiveConstructor{,} \AgdaInductiveConstructor{v} \AgdaSymbol{(}\AgdaFunction{χ} \AgdaSymbol{(}\AgdaFunction{ι} \AgdaInductiveConstructor{,} \AgdaInductiveConstructor{ƛ} \AgdaBound{x'} \AgdaBound{M'}\AgdaSymbol{))))} \<[97]%
\>[97]\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{lemmaλxMι≡λx'M'ι} \AgdaBound{λxMι\#λx'M'ι} \AgdaKeyword{with} \AgdaFunction{χ} \AgdaSymbol{(}\AgdaFunction{ι} \AgdaInductiveConstructor{,} \AgdaInductiveConstructor{ƛ} \AgdaBound{x} \AgdaBound{M}\AgdaSymbol{)} \<[53]%
\>[53]\AgdaSymbol{|} \<[57]%
\>[57]\AgdaBound{M} \AgdaFunction{∙} \AgdaSymbol{(}\AgdaFunction{ι} \AgdaFunction{<+} \AgdaSymbol{(}\AgdaBound{x} \AgdaInductiveConstructor{,} \AgdaInductiveConstructor{v} \AgdaSymbol{(}\AgdaFunction{χ} \AgdaSymbol{(}\AgdaFunction{ι} \AgdaInductiveConstructor{,} \AgdaInductiveConstructor{ƛ} \AgdaBound{x} \AgdaBound{M}\AgdaSymbol{))))} \AgdaSymbol{|} \AgdaBound{λxMι\#λx'M'ι} \<[106]%
\>[106]\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaSymbol{...} \AgdaSymbol{|} \AgdaSymbol{.(}\AgdaFunction{χ} \AgdaSymbol{(}\AgdaFunction{ι} \AgdaInductiveConstructor{,} \AgdaInductiveConstructor{ƛ} \AgdaBound{x'} \AgdaBound{M'}\AgdaSymbol{))} \AgdaSymbol{|} \AgdaSymbol{.(}\AgdaBound{M'} \AgdaFunction{∙} \AgdaSymbol{(}\AgdaFunction{ι} \AgdaFunction{<+} \AgdaSymbol{(}\AgdaBound{x'} \AgdaInductiveConstructor{,} \AgdaInductiveConstructor{v} \AgdaSymbol{(}\AgdaFunction{χ} \AgdaSymbol{(}\AgdaFunction{ι} \AgdaInductiveConstructor{,} \AgdaInductiveConstructor{ƛ} \AgdaBound{x'} \AgdaBound{M'}\AgdaSymbol{)))))} \AgdaSymbol{|} \AgdaInductiveConstructor{refl} \AgdaSymbol{=} \AgdaInductiveConstructor{refl} \AgdaInductiveConstructor{,} \AgdaInductiveConstructor{refl}\<%
\\
\>\AgdaSymbol{...} \AgdaSymbol{|} \AgdaBound{y≡y'} \AgdaInductiveConstructor{,} \AgdaBound{Mι<+xy≡M'ι<+xy'} \<[29]%
\>[29]\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaKeyword{with} \AgdaFunction{χ} \AgdaSymbol{(}\AgdaFunction{ι} \AgdaInductiveConstructor{,} \AgdaInductiveConstructor{ƛ} \AgdaBound{x} \AgdaBound{M}\AgdaSymbol{)} \AgdaSymbol{|} \AgdaFunction{χ} \AgdaSymbol{(}\AgdaFunction{ι} \AgdaInductiveConstructor{,} \AgdaInductiveConstructor{ƛ} \AgdaBound{x'} \AgdaBound{M'}\AgdaSymbol{)} \AgdaSymbol{|} \AgdaFunction{lemma-χι} \AgdaSymbol{(}\AgdaInductiveConstructor{ƛ} \AgdaBound{x} \AgdaBound{M}\AgdaSymbol{)} \AgdaSymbol{|} \AgdaFunction{lemma-χι} \AgdaSymbol{(}\AgdaInductiveConstructor{ƛ} \AgdaBound{x'} \AgdaBound{M'}\AgdaSymbol{)} \AgdaSymbol{|} \AgdaBound{y≡y'} \<[86]%
\>[86]\<%
\\
\>\AgdaSymbol{...} \AgdaSymbol{|} \AgdaBound{y} \AgdaSymbol{|} \AgdaSymbol{.}\AgdaBound{y} \AgdaSymbol{|} \AgdaBound{y\#λxM} \AgdaSymbol{|} \AgdaBound{y\#λx'M'} \AgdaSymbol{|} \AgdaInductiveConstructor{refl} \<[38]%
\>[38]\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaSymbol{=} \AgdaInductiveConstructor{∼ƛ} \<[8]%
\>[8]\AgdaSymbol{\{}\AgdaBound{M}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{M'}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{x}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{x'}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{y}\AgdaSymbol{\}} \AgdaBound{y\#λxM} \AgdaBound{y\#λx'M'} \<[44]%
\>[44]\<%
\\
\>[2]\AgdaIndent{8}{}\<[8]%
\>[8]\AgdaSymbol{(}\AgdaBound{rec} \AgdaSymbol{(}\AgdaFunction{length} \AgdaSymbol{(}\AgdaBound{M} \AgdaFunction{∙} \AgdaSymbol{(}\AgdaFunction{ι} \AgdaFunction{<+} \AgdaSymbol{(}\AgdaBound{x} \AgdaInductiveConstructor{,} \AgdaInductiveConstructor{v} \AgdaBound{y}\AgdaSymbol{))))} \<[45]%
\>[45]\<%
\\
\>[8]\AgdaIndent{13}{}\<[13]%
\>[13]\AgdaSymbol{(}\AgdaFunction{lemmam≡n→m+1≤n+1} \AgdaSymbol{(}\AgdaFunction{lemma-length-corolary} \AgdaSymbol{\{}\AgdaBound{x}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{y}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{M}\AgdaSymbol{\}))} \<[68]%
\>[68]\<%
\\
\>[8]\AgdaIndent{13}{}\<[13]%
\>[13]\AgdaSymbol{(}\AgdaBound{M} \AgdaFunction{∙} \AgdaSymbol{(}\AgdaFunction{ι} \AgdaFunction{<+} \AgdaSymbol{(}\AgdaBound{x} \AgdaInductiveConstructor{,} \AgdaInductiveConstructor{v} \AgdaBound{y}\AgdaSymbol{)))} \<[36]%
\>[36]\<%
\\
\>[8]\AgdaIndent{13}{}\<[13]%
\>[13]\AgdaSymbol{(}\AgdaBound{M'} \AgdaFunction{∙} \AgdaSymbol{(}\AgdaFunction{ι} \AgdaFunction{<+} \AgdaSymbol{(}\AgdaBound{x'} \AgdaInductiveConstructor{,} \AgdaInductiveConstructor{v} \AgdaBound{y}\AgdaSymbol{)))} \<[38]%
\>[38]\<%
\\
\>[8]\AgdaIndent{13}{}\<[13]%
\>[13]\AgdaInductiveConstructor{refl} \<[18]%
\>[18]\<%
\\
\>[8]\AgdaIndent{13}{}\<[13]%
\>[13]\AgdaSymbol{(}\AgdaFunction{cong} \AgdaSymbol{(λ} \AgdaBound{M} \AgdaSymbol{→} \AgdaBound{M} \AgdaFunction{∙} \AgdaFunction{ι}\AgdaSymbol{)} \AgdaBound{Mι<+xy≡M'ι<+xy'}\AgdaSymbol{))}\<%
\\
%
\\
\>\AgdaFunction{lemmaMι≡M'ι→M∼M'} \AgdaSymbol{:} \AgdaSymbol{\{}\AgdaBound{M} \AgdaBound{M'} \AgdaSymbol{:} \AgdaDatatype{Λ}\AgdaSymbol{\}} \AgdaSymbol{→} \AgdaBound{M} \AgdaFunction{∙} \AgdaFunction{ι} \AgdaDatatype{≡} \AgdaBound{M'} \AgdaFunction{∙} \AgdaFunction{ι} \AgdaSymbol{→} \AgdaBound{M} \AgdaDatatype{∼α} \AgdaBound{M'} \<[57]%
\>[57]\<%
\\
\>\AgdaFunction{lemmaMι≡M'ι→M∼M'} \AgdaSymbol{\{}\AgdaBound{M}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{M'}\AgdaSymbol{\}} \AgdaSymbol{=} \AgdaSymbol{(}\AgdaFunction{<-rec} \AgdaSymbol{\_} \AgdaFunction{lemmaMι≡M'ι→M∼M'-aux}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaFunction{length} \AgdaBound{M}\AgdaSymbol{)} \AgdaBound{M} \AgdaBound{M'} \AgdaInductiveConstructor{refl}\<%
\\
\>\<\end{code}

\begin{code}\>\<%
\\
\>\AgdaFunction{ρ} \AgdaSymbol{:} \AgdaFunction{Reflexive} \AgdaDatatype{\_∼α\_}\<%
\\
\>\AgdaFunction{ρ} \AgdaSymbol{\{}\AgdaBound{M}\AgdaSymbol{\}} \AgdaSymbol{=} \AgdaFunction{lemmaMι≡M'ι→M∼M'} \AgdaInductiveConstructor{refl}\<%
\\
\>\<\end{code}
\begin{code}\>\<%
\\
\>\AgdaFunction{σ} \AgdaSymbol{:} \AgdaFunction{Symmetric} \AgdaDatatype{\_∼α\_}\<%
\\
\>\AgdaFunction{σ} \AgdaSymbol{\{}\AgdaBound{M}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{N}\AgdaSymbol{\}} \AgdaBound{M∼N} \<[14]%
\>[14]\<%
\\
\>[3]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaSymbol{=} \AgdaFunction{lemmaMι≡M'ι→M∼M'} \<[21]%
\>[21]\<%
\\
\>[0]\AgdaIndent{10}{}\<[10]%
\>[10]\AgdaSymbol{(}\AgdaFunction{sym} \AgdaSymbol{(}\AgdaFunction{lemmaM∼M'→Mσ≡M'σ} \AgdaBound{M∼N}\AgdaSymbol{))}\<%
\\
\>\<\end{code}
\begin{code}\>\<%
\\
\>\AgdaFunction{τ} \AgdaSymbol{:} \AgdaFunction{Transitive} \AgdaDatatype{\_∼α\_}\<%
\\
\>\AgdaFunction{τ} \AgdaSymbol{\{}\AgdaBound{M}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{N}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{P}\AgdaSymbol{\}} \AgdaBound{M∼N} \AgdaBound{N∼P} \<[22]%
\>[22]\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaSymbol{=} \AgdaFunction{lemmaMι≡M'ι→M∼M'} \<[21]%
\>[21]\<%
\\
\>[0]\AgdaIndent{9}{}\<[9]%
\>[9]\AgdaSymbol{(}\AgdaFunction{trans} \AgdaSymbol{(}\AgdaFunction{lemmaM∼M'→Mσ≡M'σ} \AgdaBound{M∼N}\AgdaSymbol{)} \<[39]%
\>[39]\<%
\\
\>[9]\AgdaIndent{16}{}\<[16]%
\>[16]\AgdaSymbol{(}\AgdaFunction{lemmaM∼M'→Mσ≡M'σ} \AgdaBound{N∼P}\AgdaSymbol{))}\<%
\\
\>\<\end{code}

\begin{code}\>\<%
\\
\>\AgdaFunction{≈-preorder} \AgdaSymbol{:} \AgdaRecord{Preorder} \AgdaSymbol{\_} \AgdaSymbol{\_} \AgdaSymbol{\_}\<%
\\
\>\AgdaFunction{≈-preorder} \AgdaSymbol{=} \<[14]%
\>[14]\<%
\\
\>[3]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaKeyword{record} \AgdaSymbol{\{} \<[13]%
\>[13]\<%
\\
\>[0]\AgdaIndent{6}{}\<[6]%
\>[6]\AgdaField{Carrier} \AgdaSymbol{=} \AgdaDatatype{Λ}\AgdaSymbol{;}\<%
\\
\>[0]\AgdaIndent{6}{}\<[6]%
\>[6]\AgdaField{\_≈\_} \AgdaSymbol{=} \AgdaDatatype{\_≡\_}\AgdaSymbol{;}\<%
\\
\>[0]\AgdaIndent{6}{}\<[6]%
\>[6]\AgdaField{\_∼\_} \AgdaSymbol{=} \AgdaDatatype{\_∼α\_}\AgdaSymbol{;}\<%
\\
\>[0]\AgdaIndent{6}{}\<[6]%
\>[6]\AgdaField{isPreorder} \AgdaSymbol{=} \<[20]%
\>[20]\AgdaKeyword{record} \AgdaSymbol{\{}\<%
\\
\>[6]\AgdaIndent{8}{}\<[8]%
\>[8]\AgdaField{isEquivalence} \AgdaSymbol{=} \AgdaFunction{Relation.Binary.Setoid.isEquivalence} \AgdaSymbol{(}\AgdaFunction{setoid} \AgdaDatatype{Λ}\AgdaSymbol{)} \AgdaSymbol{;}\<%
\\
\>[6]\AgdaIndent{8}{}\<[8]%
\>[8]\AgdaField{reflexive} \AgdaSymbol{=} \AgdaSymbol{λ} \AgdaSymbol{\{} \AgdaSymbol{\{}\AgdaBound{M}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaSymbol{.}\AgdaBound{M}\AgdaSymbol{\}} \AgdaInductiveConstructor{refl} \AgdaSymbol{→} \AgdaFunction{ρ}\AgdaSymbol{\};}\<%
\\
\>[6]\AgdaIndent{8}{}\<[8]%
\>[8]\AgdaField{trans} \AgdaSymbol{=} \AgdaFunction{τ} \AgdaSymbol{\}} \AgdaSymbol{\}}\<%
\\
%
\\
\>\AgdaKeyword{import} \AgdaModule{Relation.Binary.PreorderReasoning} \AgdaSymbol{as} \AgdaModule{PreR}\<%
\\
\>\AgdaKeyword{open} \AgdaModule{PreR} \AgdaFunction{≈-preorder}\<%
\\
%
\\
\>\AgdaFunction{lemma-σ⇂} \AgdaSymbol{:} \AgdaSymbol{\{}\AgdaBound{M} \AgdaSymbol{:} \AgdaDatatype{Λ}\AgdaSymbol{\}\{}\AgdaBound{σ} \AgdaBound{σ'} \AgdaSymbol{:} \AgdaFunction{Σ}\AgdaSymbol{\}} \AgdaSymbol{→} \AgdaBound{σ} \AgdaFunction{∼α} \AgdaBound{σ'} \AgdaFunction{⇂} \AgdaBound{M} \AgdaSymbol{→} \AgdaSymbol{((}\AgdaFunction{ι} \AgdaFunction{∘} \AgdaBound{σ}\AgdaSymbol{)} \AgdaInductiveConstructor{,} \AgdaBound{M}\AgdaSymbol{)} \AgdaFunction{≡'} \AgdaSymbol{((}\AgdaFunction{ι} \AgdaFunction{∘} \AgdaBound{σ'}\AgdaSymbol{)} \AgdaInductiveConstructor{,} \AgdaBound{M}\AgdaSymbol{)}\<%
\\
\>\AgdaFunction{lemma-σ⇂} \AgdaBound{σ∼σ'⇂M} \<[17]%
\>[17]\AgdaSymbol{=} \AgdaSymbol{((λ} \AgdaBound{\_} \AgdaBound{x} \AgdaSymbol{→} \AgdaBound{x}\AgdaSymbol{)} \AgdaInductiveConstructor{,} \AgdaSymbol{(λ} \AgdaBound{\_} \AgdaBound{x} \AgdaSymbol{→} \AgdaBound{x}\AgdaSymbol{))} \AgdaInductiveConstructor{,} \AgdaSymbol{(λ} \AgdaBound{x} \AgdaBound{xfreeM} \AgdaSymbol{→} \<[64]%
\>[64]\AgdaFunction{lemmaM∼M'→Mσ≡M'σ} \AgdaSymbol{(}\AgdaBound{σ∼σ'⇂M} \<[90]%
\>[90]\AgdaBound{x} \AgdaBound{xfreeM}\AgdaSymbol{))}\<%
\\
\>\AgdaComment{--}\<%
\\
\>\AgdaFunction{lemma-subst-σ∼} \AgdaSymbol{:} \AgdaSymbol{\{}\AgdaBound{M} \AgdaSymbol{:} \AgdaDatatype{Λ}\AgdaSymbol{\}\{}\AgdaBound{σ} \AgdaBound{σ'} \AgdaSymbol{:} \AgdaFunction{Σ}\AgdaSymbol{\}} \AgdaSymbol{→} \AgdaBound{σ} \AgdaFunction{∼α} \AgdaBound{σ'} \AgdaFunction{⇂} \AgdaBound{M} \AgdaSymbol{→} \AgdaBound{M} \AgdaFunction{∙} \AgdaBound{σ} \AgdaDatatype{∼α} \AgdaBound{M} \AgdaFunction{∙} \AgdaBound{σ'}\<%
\\
\>\AgdaFunction{lemma-subst-σ∼} \AgdaSymbol{\{}\AgdaBound{M}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{σ}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{σ'}\AgdaSymbol{\}} \AgdaBound{σ∼ασ'⇂M} \<[36]%
\>[36]\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaSymbol{=} \AgdaFunction{lemmaMι≡M'ι→M∼M'} \AgdaSymbol{(}\AgdaFunction{begin≡}\<%
\\
\>[0]\AgdaIndent{24}{}\<[24]%
\>[24]\AgdaSymbol{(}\AgdaBound{M} \AgdaFunction{∙} \AgdaBound{σ}\AgdaSymbol{)} \AgdaFunction{∙} \AgdaFunction{ι}\<%
\\
\>[0]\AgdaIndent{24}{}\<[24]%
\>[24]\AgdaFunction{≡⟨} \AgdaFunction{lemma·} \AgdaSymbol{\{}\AgdaBound{M}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{σ}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaFunction{ι}\AgdaSymbol{\}} \AgdaFunction{⟩}\<%
\\
\>[0]\AgdaIndent{24}{}\<[24]%
\>[24]\AgdaBound{M} \AgdaFunction{∙} \AgdaSymbol{(}\AgdaFunction{ι} \AgdaFunction{∘} \AgdaBound{σ}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaIndent{24}{}\<[24]%
\>[24]\AgdaFunction{≡⟨} \<[28]%
\>[28]\AgdaFunction{lemma-subst-σ≡} \AgdaSymbol{\{}\AgdaBound{M}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaFunction{ι} \AgdaFunction{∘} \AgdaBound{σ}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaFunction{ι} \AgdaFunction{∘} \AgdaBound{σ'}\AgdaSymbol{\}} \AgdaSymbol{(}\AgdaFunction{lemma-σ⇂} \AgdaBound{σ∼ασ'⇂M}\AgdaSymbol{)} \AgdaFunction{⟩}\<%
\\
\>[0]\AgdaIndent{24}{}\<[24]%
\>[24]\AgdaBound{M} \AgdaFunction{∙} \AgdaSymbol{(}\AgdaFunction{ι} \AgdaFunction{∘} \AgdaBound{σ'}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaIndent{24}{}\<[24]%
\>[24]\AgdaFunction{≡⟨} \AgdaFunction{sym} \AgdaSymbol{(}\AgdaFunction{lemma·} \AgdaSymbol{\{}\AgdaBound{M}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{σ'}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaFunction{ι}\AgdaSymbol{\})} \AgdaFunction{⟩}\<%
\\
\>[0]\AgdaIndent{24}{}\<[24]%
\>[24]\AgdaSymbol{(}\AgdaBound{M} \AgdaFunction{∙} \AgdaBound{σ'}\AgdaSymbol{)} \AgdaFunction{∙} \AgdaFunction{ι}\<%
\\
\>[0]\AgdaIndent{22}{}\<[22]%
\>[22]\AgdaFunction{◻}\AgdaSymbol{)}\<%
\\
\>\<\end{code}

\begin{code}\>\<%
\\
\>\AgdaFunction{lemma-subst} \AgdaSymbol{:} \AgdaSymbol{\{}\AgdaBound{M} \AgdaBound{M'} \AgdaSymbol{:} \AgdaDatatype{Λ}\AgdaSymbol{\}\{}\AgdaBound{σ} \AgdaBound{σ'} \AgdaSymbol{:} \AgdaFunction{Σ}\AgdaSymbol{\}} \AgdaSymbol{→} \<[37]%
\>[37]\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaBound{M} \AgdaDatatype{∼α} \AgdaBound{M'} \AgdaSymbol{→} \AgdaBound{σ} \AgdaFunction{∼α} \AgdaBound{σ'} \AgdaFunction{⇂} \AgdaBound{M} \AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{M} \AgdaFunction{∙} \AgdaBound{σ}\AgdaSymbol{)} \AgdaDatatype{∼α} \AgdaSymbol{(}\AgdaBound{M'} \AgdaFunction{∙} \AgdaBound{σ'}\AgdaSymbol{)}\<%
\\
\>\AgdaFunction{lemma-subst} \AgdaSymbol{\{}\AgdaBound{M}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{M'}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{σ}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{σ'}\AgdaSymbol{\}} \AgdaBound{M∼M'} \AgdaBound{σ∼σ'⇂M} \<[42]%
\>[42]\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaSymbol{=} \<[5]%
\>[5]\AgdaFunction{begin}\<%
\\
\>[2]\AgdaIndent{7}{}\<[7]%
\>[7]\AgdaBound{M} \AgdaFunction{∙} \AgdaBound{σ}\<%
\\
\>[2]\AgdaIndent{7}{}\<[7]%
\>[7]\AgdaFunction{∼⟨} \AgdaFunction{lemma-subst-σ∼} \AgdaBound{σ∼σ'⇂M} \AgdaFunction{⟩}\<%
\\
\>[2]\AgdaIndent{7}{}\<[7]%
\>[7]\AgdaBound{M} \AgdaFunction{∙} \AgdaBound{σ'}\<%
\\
\>[2]\AgdaIndent{7}{}\<[7]%
\>[7]\AgdaFunction{≈⟨} \AgdaFunction{lemmaM∼M'→Mσ≡M'σ} \AgdaBound{M∼M'} \<[33]%
\>[33]\AgdaFunction{⟩}\<%
\\
\>[2]\AgdaIndent{7}{}\<[7]%
\>[7]\AgdaBound{M'} \AgdaFunction{∙} \AgdaBound{σ'}\<%
\\
\>[0]\AgdaIndent{5}{}\<[5]%
\>[5]\AgdaFunction{∎}\<%
\\
\>\<\end{code}

Beta contraction

%<*betacontraction>
\begin{code}\>\<%
\\
\>\AgdaKeyword{data} \AgdaDatatype{\_▹\_} \AgdaSymbol{:} \AgdaDatatype{Λ} \AgdaSymbol{→} \AgdaDatatype{Λ} \AgdaSymbol{→} \AgdaPrimitiveType{Set} \AgdaKeyword{where}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaInductiveConstructor{▹β} \<[6]%
\>[6]\AgdaSymbol{:} \<[9]%
\>[9]\AgdaSymbol{\{}\AgdaBound{M} \AgdaBound{N} \AgdaSymbol{:} \AgdaDatatype{Λ}\AgdaSymbol{\}\{}\AgdaBound{x} \AgdaSymbol{:} \AgdaFunction{V}\AgdaSymbol{\}} \<[26]%
\>[26]\<%
\\
\>[2]\AgdaIndent{6}{}\<[6]%
\>[6]\AgdaSymbol{→} \<[9]%
\>[9]\AgdaInductiveConstructor{ƛ} \AgdaBound{x} \AgdaBound{M} \AgdaInductiveConstructor{·} \AgdaBound{N} \AgdaDatatype{▹} \AgdaBound{M} \AgdaFunction{∙} \AgdaFunction{ι} \AgdaFunction{<+} \AgdaSymbol{(}\AgdaBound{x} \AgdaInductiveConstructor{,} \AgdaBound{N}\AgdaSymbol{)}\<%
\\
\>\<\end{code}
%</betacontraction>

Beta contraction preserves typing judge.

%<*typebeta>
\begin{code}\>\<%
\\
\>\AgdaFunction{lemma⊢▹} \<[9]%
\>[9]\AgdaSymbol{:} \<[12]%
\>[12]\AgdaSymbol{\{}\AgdaBound{Γ} \AgdaSymbol{:} \AgdaFunction{Cxt}\AgdaSymbol{\}\{}\AgdaBound{M} \AgdaBound{N} \AgdaSymbol{:} \AgdaDatatype{Λ}\AgdaSymbol{\}} \<[31]%
\>[31]\<%
\\
\>[6]\AgdaIndent{9}{}\<[9]%
\>[9]\AgdaSymbol{→} \<[12]%
\>[12]\AgdaBound{Γ} \AgdaDatatype{⊢} \AgdaBound{M} \AgdaSymbol{→} \AgdaBound{M} \AgdaDatatype{▹} \AgdaBound{N} \AgdaSymbol{→} \AgdaBound{Γ} \AgdaDatatype{⊢} \AgdaBound{N}\<%
\\
\>\<\end{code}
%</typebeta>

%<*typebetaproof>
\begin{code}\>\<%
\\
\>\AgdaFunction{lemma⊢▹} \AgdaSymbol{\{}\AgdaBound{Γ}\AgdaSymbol{\}} \AgdaSymbol{(}\AgdaInductiveConstructor{⊢·} \AgdaSymbol{.\{}\AgdaInductiveConstructor{ƛ} \AgdaBound{x} \AgdaBound{M}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{N}\AgdaSymbol{\}} \AgdaSymbol{(}\AgdaInductiveConstructor{⊢ƛ} \AgdaSymbol{\{}\AgdaBound{x}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{M}\AgdaSymbol{\}} \AgdaBound{Γ,x⊢M}\AgdaSymbol{)} \AgdaBound{Γ⊢N}\AgdaSymbol{)} \AgdaInductiveConstructor{▹β} \<[56]%
\>[56]\<%
\\
\>[1]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaSymbol{=} \AgdaFunction{lemma⊢σM} \<[14]%
\>[14]\AgdaSymbol{\{}\AgdaFunction{ι} \AgdaFunction{<+} \AgdaSymbol{(}\AgdaBound{x} \AgdaInductiveConstructor{,} \AgdaBound{N}\AgdaSymbol{)\}} \AgdaSymbol{\{}\AgdaBound{Γ} \AgdaFunction{‚} \AgdaBound{x}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{Γ}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{M}\AgdaSymbol{\}} \<[45]%
\>[45]\<%
\\
\>[0]\AgdaIndent{14}{}\<[14]%
\>[14]\AgdaBound{Γ,x⊢M} \<[20]%
\>[20]\<%
\\
\>[0]\AgdaIndent{14}{}\<[14]%
\>[14]\AgdaSymbol{(}\AgdaInductiveConstructor{∶⇀<+} \AgdaBound{x} \AgdaSymbol{(}\AgdaInductiveConstructor{∶⇀ι} \AgdaSymbol{\{}\AgdaBound{Γ}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{Γ}\AgdaSymbol{\}} \AgdaFunction{id}\AgdaSymbol{)} \AgdaBound{Γ⊢N}\AgdaSymbol{)}\<%
\\
\>\<\end{code}
%</typebetaproof>

%<*typeiota>
\begin{code}\>\<%
\\
\>\AgdaFunction{lemma⊢ι} \<[9]%
\>[9]\AgdaSymbol{:} \<[12]%
\>[12]\AgdaSymbol{\{}\AgdaBound{Γ} \AgdaSymbol{:} \AgdaFunction{Cxt}\AgdaSymbol{\}\{}\AgdaBound{M} \AgdaSymbol{:} \AgdaDatatype{Λ}\AgdaSymbol{\}} \<[29]%
\>[29]\<%
\\
\>[0]\AgdaIndent{9}{}\<[9]%
\>[9]\AgdaSymbol{→} \<[12]%
\>[12]\AgdaBound{Γ} \AgdaDatatype{⊢} \AgdaBound{M} \AgdaFunction{∙} \AgdaFunction{ι} \AgdaSymbol{→} \AgdaBound{Γ} \AgdaDatatype{⊢} \AgdaBound{M}\<%
\\
\>\<\end{code}
%</typeiota>

%<*typeiotaproof>
\begin{code}\>\<%
\\
\>\AgdaFunction{lemma⊢ι} \AgdaBound{Γ⊢M∙ι} \<[14]%
\>[14]\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaSymbol{=} \AgdaFunction{lemmaWeakening⊢++} \AgdaSymbol{(}\AgdaFunction{lemma⊢σ++} \AgdaBound{Γ⊢M∙ι} \AgdaSymbol{(}\AgdaInductiveConstructor{∶⇀ι} \AgdaFunction{id}\AgdaSymbol{))}\<%
\\
\>\<\end{code}
%</typeiotaproof>

%<*typealpha>
\begin{code}\>\<%
\\
\>\AgdaFunction{lemma⊢α} \<[9]%
\>[9]\AgdaSymbol{:} \<[12]%
\>[12]\AgdaSymbol{\{}\AgdaBound{Γ} \AgdaSymbol{:} \AgdaFunction{Cxt}\AgdaSymbol{\}\{}\AgdaBound{M} \AgdaBound{N} \AgdaSymbol{:} \AgdaDatatype{Λ}\AgdaSymbol{\}} \<[31]%
\>[31]\<%
\\
\>[2]\AgdaIndent{9}{}\<[9]%
\>[9]\AgdaSymbol{→} \<[12]%
\>[12]\AgdaBound{M} \AgdaDatatype{∼α} \AgdaBound{N} \AgdaSymbol{→} \AgdaBound{Γ} \AgdaDatatype{⊢} \AgdaBound{M} \AgdaSymbol{→} \AgdaBound{Γ} \AgdaDatatype{⊢} \AgdaBound{N}\<%
\\
\>\<\end{code}
%</typealpha>

%<*typealphaproof>
\begin{code}\>\<%
\\
\>\AgdaFunction{lemma⊢α} \AgdaSymbol{\{}M \AgdaSymbol{=} \AgdaBound{M}\AgdaSymbol{\}} \AgdaSymbol{\{}N \AgdaSymbol{=} \AgdaBound{N}\AgdaSymbol{\}} \AgdaBound{M∼N} \AgdaBound{Γ⊢M} \<[32]%
\>[32]\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaKeyword{with} \AgdaBound{M} \AgdaFunction{∙} \AgdaFunction{ι} \<[16]%
\>[16]\AgdaSymbol{|} \AgdaFunction{lemma⊢σM} \AgdaBound{Γ⊢M} \AgdaSymbol{(}\AgdaInductiveConstructor{∶⇀ι} \AgdaFunction{id}\AgdaSymbol{)} \<[41]%
\>[41]\AgdaSymbol{|} \AgdaFunction{lemmaM∼M'→Mσ≡M'σ} \AgdaSymbol{\{}σ \AgdaSymbol{=} \AgdaFunction{ι}\AgdaSymbol{\}} \AgdaBound{M∼N} \<[72]%
\>[72]\<%
\\
\>\AgdaSymbol{...} \AgdaSymbol{|} \AgdaSymbol{.(}\AgdaBound{N} \AgdaFunction{∙} \AgdaFunction{ι}\AgdaSymbol{)} \<[16]%
\>[16]\AgdaSymbol{|} \AgdaBound{Γ⊢N∙ι} \<[41]%
\>[41]\AgdaSymbol{|} \AgdaInductiveConstructor{refl} \<[48]%
\>[48]\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaSymbol{=} \AgdaFunction{lemma⊢ι} \AgdaBound{Γ⊢N∙ι}\<%
\\
\>\<\end{code}
%</typealphaproof>

-- \begin{code}\>\>\<%
\\
\>\AgdaComment{-- lemma<+swap : \{x y u w : V\}\{P : Λ\} }\<%
\\
\>\AgdaComment{--             → x ∉ y ∷ fv P}\<%
\\
\>\AgdaComment{-- --            → w ∉ fv P }\<%
\\
\>\AgdaComment{--             → (ι <+ (y , P) <+ (x , v w)) u ≡ (ι <+ (x , v w) ∘ ι <+ (y , P)) u}\<%
\\
\>\AgdaComment{-- lemma<+swap = \{!!\}}\<%
\\
\>\AgdaComment{-- }\<\end{code}

-- %<*naivesubstitution>
-- \begin{code}\>\>\<%
\\
\>\AgdaComment{-- lemmaƛ∼[] : ∀ \{x y : V\}\{P : Λ\} → (M : Λ) → x ∉ y ∷ fv P }\<%
\\
\>\AgdaComment{--   → ƛ x M ∙ ι <+ (y , P) ∼α  ƛ x (M ∙ ι <+ (y , P))}\<%
\\
\>\AgdaComment{-- }\<\end{code}
-- %</naivesubstitution>

-- \begin{code}\>\>\<%
\\
\>\AgdaComment{-- lemmaƛ∼[] \{x\} \{y\} \{P\} M x∉y∷fvP}\<%
\\
\>\AgdaComment{--   = begin}\<%
\\
\>\AgdaComment{--        ƛ x M ∙ ι <+ ( y , P )}\<%
\\
\>\AgdaComment{--     ≈⟨ refl ⟩  }\<%
\\
\>\AgdaComment{--        ƛ z (M ∙ ι <+ ( y , P ) <+ (x , v z))}\<%
\\
\>\AgdaComment{--     ∼⟨ ∼ƛ \{y = w\} w\#1 w\#2 }\<%
\\
\>\AgdaComment{--           (begin}\<%
\\
\>\AgdaComment{--              (M ∙ ι <+ (y , P) <+ (x , v z)) ∙ ι <+ (z , v w) }\<%
\\
\>\AgdaComment{--            ≈⟨ lemma· \{M\} \{ι <+ (y , P) <+ (x , v z)\} \{ι <+ (z , v w)\} ⟩}\<%
\\
\>\AgdaComment{--              M ∙ ( ι <+ (z , v w) ∘ ι <+ (y , P) <+ (x , v z) )}\<%
\\
\>\AgdaComment{--            ≈⟨ lemmaσ≡σ'→Mσ≡Mσ'  \{M\} }\<%
\\
\>\AgdaComment{--                                 \{ι <+ (z , v w) ∘ ι <+ (y , P) <+ (x , v z)\}}\<%
\\
\>\AgdaComment{--                                 \{ι <+ (x , v w) ∘ ι <+ (y , P)\} }\<%
\\
\>\AgdaComment{--                                 (λ u u*M →}\<%
\\
\>\AgdaComment{--                                    begin≡}\<%
\\
\>\AgdaComment{--                                      (ι <+ (z , v w) ∘ ι <+ (y , P) <+ (x , v z)) u}\<%
\\
\>\AgdaComment{--                                    ≡⟨ lemmaσ∘<+ M (ι <+ (y , P)) ι x w u u*M ⟩}\<%
\\
\>\AgdaComment{--                                      ((ι ∘ (ι <+ (y , P))) <+ (x , v w)) u }\<%
\\
\>\AgdaComment{--                                    ≡⟨ \{! !\} ⟩}\<%
\\
\>\AgdaComment{--                                      (ι <+ (y , P) <+ (x , v w)) u              }\<%
\\
\>\AgdaComment{--                                    ≡⟨ lemma<+swap x∉y∷fvP ⟩}\<%
\\
\>\AgdaComment{--                                      (ι <+ (x , v w) ∘ ι <+ (y , P)) u}\<%
\\
\>\AgdaComment{--                                    ◻) ⟩  }\<%
\\
\>\AgdaComment{--              M ∙ (ι <+ (x , v w) ∘ ι <+ (y , P))}\<%
\\
\>\AgdaComment{--            ≈⟨ sym (lemma· \{M\} \{ι <+ (y , P)\} \{ι <+ (x , v w)\}) ⟩}\<%
\\
\>\AgdaComment{--              (M ∙ ι <+ (y , P)) ∙ ι <+ (x , v w)}\<%
\\
\>\AgdaComment{--            ∎)⟩ }\<%
\\
\>\AgdaComment{--        ƛ x (M ∙ ι <+ ( y , P ))}\<%
\\
\>\AgdaComment{--     ∎}\<%
\\
\>\AgdaComment{--   where}\<%
\\
\>\AgdaComment{--   z = χ (ι <+ ( y , P ) , ƛ x M)}\<%
\\
\>\AgdaComment{--   w = χ' (fv (ƛ z (M ∙ ι <+ ( y , P ) <+ (x , v z))) ++ fv (ƛ x (M ∙ ι <+ ( y , P ))))}\<%
\\
\>\AgdaComment{--   w∉fv : w ∉ (fv (ƛ z (M ∙ ι <+ ( y , P ) <+ (x , v z))) ++ fv (ƛ x (M ∙ ι <+ ( y , P ))))}\<%
\\
\>\AgdaComment{--   w∉fv = lemmaχ∉ (fv (ƛ z (M ∙ ι <+ ( y , P ) <+ (x , v z))) ++ fv (ƛ x (M ∙ ι <+ ( y , P ))))}\<%
\\
\>\AgdaComment{--   w\#1 : w \# ƛ z (M ∙ ι <+ ( y , P ) <+ (x , v z))}\<%
\\
\>\AgdaComment{--   w\#1 = lemma∉fv→\# (c∉xs++ys→c∉xs w∉fv)}\<%
\\
\>\AgdaComment{--   w\#2 : w \# ƛ x (M ∙ ι <+ ( y , P ))}\<%
\\
\>\AgdaComment{--   w\#2 = lemma∉fv→\# (c∉xs++ys→c∉ys \{xs = fv (ƛ z (M ∙ ι <+ ( y , P ) <+ (x , v z)))\} w∉fv)}\<%
\\
%
\\
\>\AgdaComment{-- --  w = z ??}\<%
\\
\>\AgdaComment{--   -- where }\<%
\\
\>\AgdaComment{--   -- a≢b : a ≢ b}\<%
\\
\>\AgdaComment{--   -- a≢b = sym≢ (b∉a∷xs→b≢a b∉a∷fvP)}\<%
\\
\>\AgdaComment{--   -- a≢d : ∀ \{d\} → d ∉ (a ∷ fv P ++ fv M) → a ≢ d}\<%
\\
\>\AgdaComment{--   -- a≢d d∉ = sym≢ (b∉a∷xs→b≢a d∉)}\<%
\\
\>\AgdaComment{--   -- d\#M : ∀ \{d\} → d ∉ (a ∷ fv P ++ fv M) → d \# M}\<%
\\
\>\AgdaComment{--   -- d\#M d∉ = lemma∉fv→\# (c∉xs++ys→c∉ys \{xs = fv P\} (b∉a∷xs→b∉xs d∉))}\<%
\\
\>\AgdaComment{--   -- d\#P : ∀ \{d\} → d ∉ (a ∷ fv P ++ fv M) → d \# P}\<%
\\
\>\AgdaComment{--   -- d\#P d∉ = lemma∉fv→\# (c∉xs++ys→c∉xs (b∉a∷xs→b∉xs d∉))}\<%
\\
\>\AgdaComment{--   -- c = χ (a ∷ fv P) (ƛ b M)}\<%
\\
\>\AgdaComment{--   -- c\#ƛbM = χ\# (a ∷ fv P) (ƛ b M)}\<%
\\
\>\AgdaComment{--   -- c∉a∷fvP = χ∉ (a ∷ fv P) (ƛ b M)}\<%
\\
\>\AgdaComment{--   -- c\#P : c \# P}\<%
\\
\>\AgdaComment{--   -- c\#P = lemma∉fv→\# (b∉a∷xs→b∉xs c∉a∷fvP)}\<%
\\
\>\AgdaComment{--   -- b\#P : b \# P}\<%
\\
\>\AgdaComment{--   -- b\#P = lemma∉fv→\# (b∉a∷xs→b∉xs b∉a∷fvP)}\<%
\\
\>\AgdaComment{--   -- a≢c : a ≢ c}\<%
\\
\>\AgdaComment{--   -- a≢c = sym≢ (b∉a∷xs→b≢a c∉a∷fvP)}\<%
\\
\>\AgdaComment{-- }\<\end{code}


