\begin{code}%
\>\AgdaKeyword{module} \AgdaModule{Substitution} \AgdaKeyword{where}\<%
\\
%
\\
\>\AgdaKeyword{open} \AgdaKeyword{import} \AgdaModule{Chi}\<%
\\
\>\AgdaKeyword{open} \AgdaKeyword{import} \AgdaModule{Term} \AgdaKeyword{renaming} \AgdaSymbol{(}\_⊆\_ \AgdaSymbol{to} \_⊆c\_ \AgdaSymbol{;} \_∈\_ \AgdaSymbol{to} \_∈c\_\AgdaSymbol{)}\<%
\\
\>\AgdaKeyword{open} \AgdaKeyword{import} \AgdaModule{ListProperties}\<%
\\
%
\\
\>\AgdaKeyword{open} \AgdaKeyword{import} \AgdaModule{Function} \AgdaKeyword{renaming} \AgdaSymbol{(}\_∘\_ \AgdaSymbol{to} \_∘f\_\AgdaSymbol{)}\<%
\\
\>\AgdaKeyword{open} \AgdaKeyword{import} \AgdaModule{Function.Inverse} \AgdaKeyword{hiding} \AgdaSymbol{(}sym\AgdaSymbol{;}\_∘\_\AgdaSymbol{;}map\AgdaSymbol{;}id\AgdaSymbol{)}\<%
\\
\>\AgdaKeyword{open} \AgdaModule{Inverse}\<%
\\
\>\AgdaKeyword{import} \AgdaModule{Function.Equality} \AgdaSymbol{as} \AgdaModule{FE}\<%
\\
\>\AgdaKeyword{open} \AgdaKeyword{import} \AgdaModule{Data.List} \AgdaKeyword{hiding} \AgdaSymbol{(}any\AgdaSymbol{)} \AgdaKeyword{renaming} \AgdaSymbol{(}length \AgdaSymbol{to} length'\AgdaSymbol{)} \<[64]%
\>[64]\<%
\\
\>\AgdaKeyword{open} \AgdaKeyword{import} \AgdaModule{Data.List.Any} \AgdaSymbol{as} \AgdaModule{Any} \AgdaKeyword{hiding} \AgdaSymbol{(}map\AgdaSymbol{)}\<%
\\
\>\AgdaKeyword{open} \AgdaKeyword{import} \AgdaModule{Data.List.Any.Membership}\<%
\\
\>\AgdaKeyword{open} \AgdaKeyword{import} \AgdaModule{Data.List.Any.Properties}\<%
\\
\>\AgdaKeyword{open} \AgdaModule{Any.}\AgdaModule{Membership-≡} \<[22]%
\>[22]\<%
\\
\>\AgdaKeyword{open} \AgdaKeyword{import} \AgdaModule{Data.Bool} \AgdaKeyword{hiding} \AgdaSymbol{(}\_≟\_\AgdaSymbol{;}\_∨\_\AgdaSymbol{)}\<%
\\
\>\AgdaKeyword{open} \AgdaKeyword{import} \AgdaModule{Data.Nat} \AgdaSymbol{as} \AgdaModule{Nat} \AgdaKeyword{hiding} \AgdaSymbol{(}\_*\_\AgdaSymbol{)}\<%
\\
\>\AgdaKeyword{open} \AgdaKeyword{import} \AgdaModule{Data.Sum} \AgdaKeyword{hiding} \AgdaSymbol{(}map\AgdaSymbol{)} \AgdaKeyword{renaming} \AgdaSymbol{(}\_⊎\_ \AgdaSymbol{to} \_∨\_\AgdaSymbol{)}\<%
\\
\>\AgdaKeyword{open} \AgdaKeyword{import} \AgdaModule{Data.Empty}\<%
\\
\>\AgdaKeyword{open} \AgdaKeyword{import} \AgdaModule{Data.Product} \AgdaKeyword{renaming} \AgdaSymbol{(}Σ \AgdaSymbol{to} Σₓ\AgdaSymbol{;}map \AgdaSymbol{to} mapₓ\AgdaSymbol{)} \<[56]%
\>[56]\<%
\\
\>\AgdaKeyword{open} \AgdaKeyword{import} \AgdaModule{Relation.Binary}\<%
\\
\>\AgdaKeyword{open} \AgdaKeyword{import} \AgdaModule{Relation.Binary.PropositionalEquality} \AgdaSymbol{as} \AgdaModule{PropEq} \AgdaKeyword{renaming} \AgdaSymbol{(}[\_] \AgdaSymbol{to} [\_]ᵢ\AgdaSymbol{)} \<[83]%
\>[83]\<%
\\
\>\AgdaKeyword{open} \AgdaKeyword{import} \AgdaModule{Relation.Nullary}\<%
\\
\>\AgdaKeyword{open} \AgdaKeyword{import} \AgdaModule{Relation.Nullary.Decidable} \AgdaKeyword{hiding} \AgdaSymbol{(}map\AgdaSymbol{)}\<%
\\
\>\AgdaKeyword{open} \AgdaKeyword{import} \AgdaModule{Algebra.Structures}\<%
\\
\>\AgdaKeyword{open} \AgdaModule{DecTotalOrder} \AgdaFunction{Nat.decTotalOrder} \AgdaKeyword{using} \AgdaSymbol{()} \AgdaKeyword{renaming} \AgdaSymbol{(}refl \AgdaSymbol{to} ≤-refl\AgdaSymbol{)}\<%
\\
\>\AgdaComment{-- open ≤-Reasoning}\<%
\\
\>\AgdaComment{--   renaming (begin\_ to start\_; \_∎ to \_◽; \_≡⟨\_⟩\_ to \_≤⟨\_⟩'\_)}\<%
\\
%
\\
\>\AgdaKeyword{infixl} \AgdaNumber{8} \_≺+\_\<%
\\
\>\AgdaKeyword{infix} \<[7]%
\>[7]\AgdaNumber{5} \_∙\_ \<%
\\
\>\AgdaComment{--infix 1 \_≅\_}\<%
\end{code}

Substitutions are functions from variables to terms.

\begin{code}%
\>\AgdaFunction{Σ} \AgdaSymbol{=} \AgdaFunction{V} \AgdaSymbol{→} \AgdaDatatype{Λ}\<%
\end{code}

\begin{code}%
\>\AgdaFunction{ι} \AgdaSymbol{:} \AgdaFunction{Σ} \<[6]%
\>[6]\<%
\\
\>\AgdaFunction{ι} \AgdaSymbol{=} \AgdaFunction{id} \AgdaFunction{∘f} \AgdaInductiveConstructor{v}\<%
\end{code}

\begin{code}%
\>\AgdaFunction{\_≺+\_} \AgdaSymbol{:} \AgdaFunction{Σ} \AgdaSymbol{→} \AgdaFunction{V} \AgdaFunction{×} \AgdaDatatype{Λ} \AgdaSymbol{→} \AgdaFunction{Σ}\<%
\\
\>\AgdaSymbol{(}\AgdaBound{σ} \AgdaFunction{≺+} \AgdaSymbol{(}\AgdaBound{x} \AgdaInductiveConstructor{,} \AgdaBound{M}\AgdaSymbol{))} \AgdaBound{y} \AgdaKeyword{with} \AgdaBound{x} \AgdaFunction{≟} \AgdaBound{y}\<%
\\
\>\AgdaSymbol{...} \AgdaSymbol{|} \AgdaInductiveConstructor{yes} \AgdaSymbol{\_} \AgdaSymbol{=} \AgdaBound{M}\<%
\\
\>\AgdaSymbol{...} \AgdaSymbol{|} \AgdaInductiveConstructor{no} \<[10]%
\>[10]\AgdaSymbol{\_} \AgdaSymbol{=} \AgdaBound{σ} \AgdaBound{y}\<%
\end{code}

\begin{code}%
\>\AgdaFunction{x≢y→x[y/M]≡x} \AgdaSymbol{:} \AgdaSymbol{\{}\AgdaBound{x} \AgdaBound{y} \AgdaSymbol{:} \AgdaFunction{V}\AgdaSymbol{\}\{}\AgdaBound{M} \AgdaSymbol{:} \AgdaDatatype{Λ}\AgdaSymbol{\}} \AgdaSymbol{→} \AgdaBound{x} \AgdaFunction{≢} \AgdaBound{y} \AgdaSymbol{→} \AgdaSymbol{(}\AgdaFunction{ι} \AgdaFunction{≺+} \AgdaSymbol{(}\AgdaBound{x} \AgdaInductiveConstructor{,} \AgdaBound{M}\AgdaSymbol{))} \AgdaBound{y} \AgdaDatatype{≡} \AgdaInductiveConstructor{v} \AgdaBound{y}\<%
\\
\>\AgdaFunction{x≢y→x[y/M]≡x} \AgdaSymbol{\{}\AgdaBound{x}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{y}\AgdaSymbol{\}} \AgdaBound{x≢y} \AgdaKeyword{with} \AgdaBound{x} \AgdaFunction{≟} \AgdaBound{y}\<%
\\
\>\AgdaSymbol{...} \AgdaSymbol{|} \AgdaInductiveConstructor{yes} \AgdaBound{x≡y} \AgdaSymbol{=} \AgdaFunction{⊥-elim} \AgdaSymbol{(}\AgdaBound{x≢y} \AgdaBound{x≡y}\AgdaSymbol{)}\<%
\\
\>\AgdaSymbol{...} \AgdaSymbol{|} \AgdaInductiveConstructor{no} \<[10]%
\>[10]\AgdaSymbol{\_} \<[14]%
\>[14]\AgdaSymbol{=} \AgdaInductiveConstructor{refl}\<%
\end{code}


-- %<*sigmatype>
-- \begin{code}%
\>\<%
\\
\>\AgdaComment{-- data \_∶\_⇀\_ : Σ → List V → List V → Set where}\<%
\\
\>\AgdaComment{--   ∶⇀ι   :  \{Γ Δ : List V\} }\<%
\\
\>\AgdaComment{--         →  Γ ⊆ Δ → ι ∶ Γ ⇀ Δ}\<%
\\
\>\AgdaComment{--   ∶⇀<+  :  \{Γ Δ : List V\}\{M : Λ\}\{σ : Σ\}(x : V) }\<%
\\
\>\AgdaComment{--         →  σ ∶ Γ ⇀ Δ }\<%
\\
\>\AgdaComment{--         →  Δ ⊢ M}\<%
\\
\>\AgdaComment{--         →  σ <+ (x , M) ∶ Γ ‚ x ⇀ Δ}\<%
\\
\>\AgdaComment{-- }\<%
\end{code}
-- %</sigmatype>

%<*sigmatype>
\begin{code}%
\>\AgdaKeyword{infix} \AgdaNumber{1} \_∶\_⇀\_⇂\_\<%
\\
\>\AgdaFunction{\_∶\_⇀\_⇂\_} \AgdaSymbol{:} \AgdaFunction{Σ} \AgdaSymbol{→} \AgdaFunction{Cxt} \AgdaSymbol{→} \AgdaFunction{Cxt} \AgdaSymbol{→} \AgdaDatatype{Λ} \AgdaSymbol{→} \AgdaPrimitiveType{Set}\<%
\\
\>\AgdaBound{σ} \AgdaFunction{∶} \AgdaBound{Γ} \AgdaFunction{⇀} \AgdaBound{Δ} \AgdaFunction{⇂} \AgdaBound{M} \AgdaSymbol{=} \AgdaSymbol{\{}\AgdaBound{z} \AgdaSymbol{:} \AgdaFunction{V}\AgdaSymbol{\}} \AgdaSymbol{→} \AgdaBound{z} \AgdaDatatype{*} \AgdaBound{M} \AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{p} \AgdaSymbol{:} \AgdaBound{z} \AgdaFunction{∈c} \AgdaBound{Γ}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaBound{Δ} \AgdaDatatype{⊢} \AgdaBound{σ} \AgdaBound{z} \AgdaDatatype{∶} \AgdaBound{Γ} \AgdaFunction{⟨} \AgdaBound{p} \AgdaFunction{⟩}\<%
\\
%
\\
\>\AgdaKeyword{infix} \AgdaNumber{1} \_∶\_⇀\_\<%
\\
\>\AgdaFunction{\_∶\_⇀\_} \AgdaSymbol{:} \AgdaFunction{Σ} \AgdaSymbol{→} \AgdaFunction{Cxt} \AgdaSymbol{→} \AgdaFunction{Cxt} \AgdaSymbol{→} \AgdaPrimitiveType{Set}\<%
\\
\>\AgdaBound{σ} \AgdaFunction{∶} \AgdaBound{Γ} \AgdaFunction{⇀} \AgdaBound{Δ} \AgdaSymbol{=} \AgdaSymbol{\{}\AgdaBound{z} \AgdaSymbol{:} \AgdaFunction{V}\AgdaSymbol{\}(}\AgdaBound{p} \AgdaSymbol{:} \AgdaBound{z} \AgdaFunction{∈c} \AgdaBound{Γ}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaBound{Δ} \AgdaDatatype{⊢} \AgdaBound{σ} \AgdaBound{z} \AgdaDatatype{∶} \AgdaBound{Γ} \AgdaFunction{⟨} \AgdaBound{p} \AgdaFunction{⟩}\<%
\\
%
\\
\>\AgdaFunction{lemma⇀} \AgdaSymbol{:} \AgdaSymbol{\{}\AgdaBound{σ} \AgdaSymbol{:} \AgdaFunction{Σ}\AgdaSymbol{\}\{}\AgdaBound{Γ} \AgdaBound{Δ} \AgdaSymbol{:} \AgdaFunction{Cxt}\AgdaSymbol{\}\{}\AgdaBound{M} \AgdaSymbol{:} \AgdaDatatype{Λ}\AgdaSymbol{\}} \AgdaSymbol{→} \AgdaBound{σ} \AgdaFunction{∶} \AgdaBound{Γ} \AgdaFunction{⇀} \AgdaBound{Δ} \AgdaSymbol{→} \AgdaBound{σ} \AgdaFunction{∶} \AgdaBound{Γ} \AgdaFunction{⇀} \AgdaBound{Δ} \AgdaFunction{⇂} \AgdaBound{M} \<[63]%
\>[63]\<%
\\
\>\AgdaFunction{lemma⇀} \AgdaBound{σ:Γ⇀Δ} \AgdaSymbol{\{}\AgdaBound{z}\AgdaSymbol{\}} \AgdaSymbol{\_} \AgdaBound{z∈Γ} \AgdaSymbol{=} \AgdaBound{σ:Γ⇀Δ} \AgdaBound{z∈Γ}\<%
\end{code}
%</sigmatype>

\begin{code}%
\>\AgdaFunction{lemmaι⇀} \AgdaSymbol{:} \AgdaSymbol{\{}\AgdaBound{Γ} \AgdaSymbol{:} \AgdaFunction{Cxt}\AgdaSymbol{\}} \AgdaSymbol{→} \AgdaFunction{ι} \AgdaFunction{∶} \AgdaBound{Γ} \AgdaFunction{⇀} \AgdaBound{Γ}\<%
\\
\>\AgdaFunction{lemmaι⇀} \AgdaBound{z∈Γ} \AgdaSymbol{=} \AgdaInductiveConstructor{⊢v} \AgdaBound{z∈Γ}\<%
\end{code}

\begin{code}%
\>\AgdaFunction{lemmaι≺+⇀} \AgdaSymbol{:} \AgdaSymbol{\{}\AgdaBound{Γ} \AgdaSymbol{:} \AgdaFunction{Cxt}\AgdaSymbol{\}\{}\AgdaBound{α} \AgdaSymbol{:} \AgdaDatatype{Type}\AgdaSymbol{\}\{}\AgdaBound{x} \AgdaSymbol{:} \AgdaFunction{V}\AgdaSymbol{\}\{}\AgdaBound{N} \AgdaSymbol{:} \AgdaDatatype{Λ}\AgdaSymbol{\}} \AgdaSymbol{→} \<[49]%
\>[49]\AgdaBound{Γ} \AgdaDatatype{⊢} \AgdaBound{N} \AgdaDatatype{∶} \AgdaBound{α} \AgdaSymbol{→} \AgdaSymbol{(}\AgdaFunction{ι} \AgdaFunction{≺+} \AgdaSymbol{(}\AgdaBound{x} \AgdaInductiveConstructor{,} \AgdaBound{N}\AgdaSymbol{))} \AgdaFunction{∶} \AgdaSymbol{(}\AgdaBound{Γ} \AgdaFunction{‚} \AgdaBound{x} \AgdaInductiveConstructor{∶} \AgdaBound{α}\AgdaSymbol{)} \AgdaFunction{⇀} \AgdaBound{Γ}\<%
\\
\>\AgdaFunction{lemmaι≺+⇀} \AgdaBound{Γ⊢N:α} \AgdaSymbol{.\{}\AgdaBound{x}\AgdaSymbol{\}} \<[22]%
\>[22]\AgdaSymbol{(}\AgdaInductiveConstructor{here} \AgdaSymbol{\{}\AgdaBound{x} \AgdaInductiveConstructor{,} \AgdaBound{α}\AgdaSymbol{\}} \AgdaInductiveConstructor{refl}\AgdaSymbol{)} \<[42]%
\>[42]\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaKeyword{with} \AgdaBound{x} \AgdaFunction{≟} \AgdaBound{x}\<%
\\
\>\AgdaSymbol{...} \AgdaSymbol{|} \AgdaInductiveConstructor{yes} \AgdaSymbol{\_} \<[14]%
\>[14]\AgdaSymbol{=} \AgdaBound{Γ⊢N:α}\<%
\\
\>\AgdaSymbol{...} \AgdaSymbol{|} \AgdaInductiveConstructor{no} \AgdaBound{x≢x} \<[14]%
\>[14]\AgdaSymbol{=} \AgdaFunction{⊥-elim} \AgdaSymbol{(}\AgdaBound{x≢x} \AgdaInductiveConstructor{refl}\AgdaSymbol{)}\<%
\\
\>\AgdaFunction{lemmaι≺+⇀} \AgdaBound{Γ⊢N:α} \AgdaSymbol{\{}\AgdaBound{y}\AgdaSymbol{\}} \<[22]%
\>[22]\AgdaSymbol{(}\AgdaInductiveConstructor{there} \AgdaSymbol{\{}\AgdaBound{x} \AgdaInductiveConstructor{∶} \AgdaBound{α}\AgdaSymbol{\}} \AgdaBound{y≢x} \AgdaBound{y∈Γ}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaKeyword{with} \AgdaBound{x} \AgdaFunction{≟} \AgdaBound{y} \<[13]%
\>[13]\<%
\\
\>\AgdaSymbol{...} \AgdaSymbol{|} \AgdaInductiveConstructor{yes} \AgdaBound{x≡y} \AgdaSymbol{=} \AgdaFunction{⊥-elim} \AgdaSymbol{(}\AgdaBound{y≢x} \AgdaSymbol{(}\AgdaFunction{sym} \AgdaBound{x≡y}\AgdaSymbol{))}\<%
\\
\>\AgdaSymbol{...} \AgdaSymbol{|} \AgdaInductiveConstructor{no} \<[10]%
\>[10]\AgdaSymbol{\_} \<[14]%
\>[14]\AgdaSymbol{=} \AgdaInductiveConstructor{⊢v} \AgdaBound{y∈Γ}\<%
\end{code}



-- \begin{code}%
\>\<%
\\
\>\AgdaComment{-- lemmaWeakening:⇀ x (∶⇀ι Γ⊆Δ) = ∶⇀ι (there ∘ Γ⊆Δ) }\<%
\\
\>\AgdaComment{-- lemmaWeakening:⇀ x (∶⇀<+ y σ:Γ⇀Δ Δ⊢M) }\<%
\\
\>\AgdaComment{--   = ∶⇀<+ y (lemmaWeakening:⇀ x σ:Γ⇀Δ) (lemmaWeakening⊢ lemmaΓ⊆Γ,x Δ⊢M) }\<%
\\
\>\AgdaComment{-- }\<%
\end{code}

Restriction of a substitution to a term.

\begin{code}%
\>\AgdaFunction{R} \AgdaSymbol{=} \AgdaFunction{Σ} \AgdaFunction{×} \AgdaDatatype{Λ}\<%
\end{code}

Freshness in a restriction is defined as follows:

\begin{code}%
\>\AgdaFunction{\_\#⇂\_} \AgdaSymbol{:} \AgdaFunction{V} \AgdaSymbol{→} \AgdaFunction{R} \AgdaSymbol{→} \AgdaPrimitiveType{Set}\<%
\\
\>\AgdaBound{x} \AgdaFunction{\#⇂} \AgdaSymbol{(}\AgdaBound{σ} \AgdaInductiveConstructor{,} \AgdaBound{M}\AgdaSymbol{)} \AgdaSymbol{=} \AgdaSymbol{(}\AgdaBound{y} \AgdaSymbol{:} \AgdaFunction{V}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaBound{y} \AgdaDatatype{*} \AgdaBound{M} \AgdaSymbol{→} \AgdaBound{x} \AgdaDatatype{\#} \AgdaSymbol{(}\AgdaBound{σ} \AgdaBound{y}\AgdaSymbol{)}\<%
\end{code}


\begin{code}%
\>\AgdaFunction{lemma\#→ι\#⇂} \AgdaSymbol{:} \AgdaSymbol{\{}\AgdaBound{x} \AgdaBound{y} \AgdaSymbol{:} \AgdaFunction{V}\AgdaSymbol{\}\{}\AgdaBound{M} \AgdaSymbol{:} \AgdaDatatype{Λ}\AgdaSymbol{\}} \AgdaSymbol{→} \AgdaBound{x} \AgdaDatatype{\#} \AgdaInductiveConstructor{ƛ} \AgdaBound{y} \AgdaBound{M} \AgdaSymbol{→} \AgdaBound{x} \AgdaFunction{\#⇂} \AgdaSymbol{(}\AgdaFunction{ι} \AgdaInductiveConstructor{,} \AgdaInductiveConstructor{ƛ} \AgdaBound{y} \AgdaBound{M}\AgdaSymbol{)}\<%
\\
\>\AgdaFunction{lemma\#→ι\#⇂} \AgdaSymbol{\{}\AgdaBound{x}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{y}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{M}\AgdaSymbol{\}} \AgdaBound{x\#ƛyM} \AgdaBound{z} \AgdaBound{z*ƛyM} \AgdaKeyword{with} \AgdaBound{z} \AgdaFunction{≟} \AgdaBound{x}\<%
\\
\>\AgdaSymbol{...} \AgdaSymbol{|} \AgdaInductiveConstructor{no} \<[10]%
\>[10]\AgdaBound{z≢x} \<[15]%
\>[15]\AgdaSymbol{=} \AgdaInductiveConstructor{\#v} \AgdaBound{z≢x}\<%
\\
\>\AgdaFunction{lemma\#→ι\#⇂} \AgdaSymbol{\{}\AgdaBound{x}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{y}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{M}\AgdaSymbol{\}} \AgdaBound{x\#ƛyM} \AgdaSymbol{.}\AgdaBound{x} \AgdaBound{x*ƛyM} \<[38]%
\>[38]\<%
\\
\>[2]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaSymbol{|} \AgdaInductiveConstructor{yes} \AgdaInductiveConstructor{refl} \AgdaSymbol{=} \AgdaFunction{⊥-elim} \AgdaSymbol{(}\AgdaFunction{lemma\#→¬free} \AgdaBound{x\#ƛyM} \AgdaBound{x*ƛyM}\AgdaSymbol{)}\<%
\end{code}

Free

\begin{code}%
\>\AgdaFunction{\_*⇂\_} \AgdaSymbol{:} \AgdaFunction{V} \AgdaSymbol{→} \AgdaFunction{R} \AgdaSymbol{→} \AgdaPrimitiveType{Set}\<%
\\
\>\AgdaBound{x} \AgdaFunction{*⇂} \AgdaSymbol{(}\AgdaBound{σ} \AgdaInductiveConstructor{,} \AgdaBound{M}\AgdaSymbol{)} \AgdaSymbol{=} \AgdaFunction{∃} \AgdaSymbol{(λ} \AgdaBound{y} \<[23]%
\>[23]\AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{y} \AgdaDatatype{*} \AgdaBound{M}\AgdaSymbol{)} \AgdaFunction{×} \AgdaSymbol{(}\AgdaBound{x} \AgdaDatatype{*} \AgdaBound{σ} \AgdaBound{y}\AgdaSymbol{))}\<%
\end{code}

The right notion of identity of substitutions has to be formulated for restrictions:

\begin{code}%
\>\AgdaKeyword{infix} \AgdaNumber{1} \_≅σ\_\<%
\\
\>\AgdaFunction{\_≅σ\_} \AgdaSymbol{:} \AgdaFunction{Σ} \AgdaSymbol{→} \AgdaFunction{Σ} \AgdaSymbol{→} \AgdaPrimitiveType{Set}\<%
\\
\>\AgdaBound{σ} \AgdaFunction{≅σ} \AgdaBound{σ'} \AgdaSymbol{=} \AgdaSymbol{(}\AgdaBound{x} \AgdaSymbol{:} \AgdaFunction{V}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaBound{σ} \AgdaBound{x} \AgdaDatatype{≡} \AgdaBound{σ'} \AgdaBound{x}\<%
\\
%
\\
\>\AgdaFunction{lemmaσ≺+x,x≅σ} \AgdaSymbol{:} \AgdaSymbol{\{}\AgdaBound{x} \AgdaSymbol{:} \AgdaFunction{V}\AgdaSymbol{\}} \AgdaSymbol{→} \AgdaFunction{ι} \AgdaFunction{≺+} \AgdaSymbol{(}\AgdaBound{x} \AgdaInductiveConstructor{,} \AgdaInductiveConstructor{v} \AgdaBound{x}\AgdaSymbol{)} \AgdaFunction{≅σ} \AgdaFunction{ι}\<%
\\
\>\AgdaFunction{lemmaσ≺+x,x≅σ} \AgdaSymbol{\{}\AgdaBound{x}\AgdaSymbol{\}} \AgdaBound{y} \AgdaKeyword{with} \AgdaBound{x} \AgdaFunction{≟} \AgdaBound{y}\<%
\\
\>\AgdaSymbol{...} \AgdaSymbol{|} \AgdaInductiveConstructor{no} \<[11]%
\>[11]\AgdaSymbol{\_} \<[17]%
\>[17]\AgdaSymbol{=} \AgdaInductiveConstructor{refl}\<%
\\
\>\AgdaFunction{lemmaσ≺+x,x≅σ} \AgdaSymbol{\{}\AgdaBound{x}\AgdaSymbol{\}} \AgdaSymbol{.}\AgdaBound{x}\<%
\\
\>[2]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaSymbol{|} \AgdaInductiveConstructor{yes} \<[11]%
\>[11]\AgdaInductiveConstructor{refl} \<[17]%
\>[17]\AgdaSymbol{=} \AgdaInductiveConstructor{refl}\<%
\\
%
\\
\>\AgdaFunction{\_≅⇂\_} \AgdaSymbol{:} \AgdaFunction{R} \AgdaSymbol{→} \AgdaFunction{R} \AgdaSymbol{→} \AgdaPrimitiveType{Set}\<%
\\
\>\AgdaSymbol{(}\AgdaBound{σ} \AgdaInductiveConstructor{,} \AgdaBound{M}\AgdaSymbol{)} \AgdaFunction{≅⇂} \AgdaSymbol{(}\AgdaBound{σ'} \AgdaInductiveConstructor{,} \AgdaBound{M'}\AgdaSymbol{)} \AgdaSymbol{=} \AgdaSymbol{(}\AgdaBound{M} \AgdaFunction{∼*} \AgdaBound{M'}\AgdaSymbol{)} \AgdaFunction{×} \AgdaSymbol{((}\AgdaBound{x} \AgdaSymbol{:} \AgdaFunction{V}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaBound{x} \AgdaDatatype{*} \AgdaBound{M} \AgdaSymbol{→} \AgdaBound{σ} \AgdaBound{x} \AgdaDatatype{≡} \AgdaBound{σ'} \AgdaBound{x}\AgdaSymbol{)}\<%
\\
%
\\
\>\AgdaFunction{\_≅\_⇂\_} \AgdaSymbol{:} \AgdaFunction{Σ} \AgdaSymbol{→} \AgdaFunction{Σ} \AgdaSymbol{→} \AgdaDatatype{Λ} \AgdaSymbol{→} \AgdaPrimitiveType{Set}\<%
\\
\>\AgdaBound{σ} \AgdaFunction{≅} \AgdaBound{σ'} \AgdaFunction{⇂} \AgdaBound{M} \AgdaSymbol{=} \AgdaSymbol{(}\AgdaBound{σ} \AgdaInductiveConstructor{,} \AgdaBound{M}\AgdaSymbol{)} \AgdaFunction{≅⇂} \AgdaSymbol{(}\AgdaBound{σ'} \AgdaInductiveConstructor{,} \AgdaBound{M}\AgdaSymbol{)}\<%
\\
%
\\
\>\AgdaFunction{lemma≅≺+} \AgdaSymbol{:} \AgdaSymbol{\{}\AgdaBound{x} \AgdaSymbol{:} \AgdaFunction{V}\AgdaSymbol{\}\{}\AgdaBound{N} \AgdaSymbol{:} \AgdaDatatype{Λ}\AgdaSymbol{\}\{}\AgdaBound{σ} \AgdaBound{σ'} \AgdaSymbol{:} \AgdaFunction{Σ}\AgdaSymbol{\}} \AgdaSymbol{→} \AgdaBound{σ} \AgdaFunction{≅σ} \AgdaBound{σ'} \AgdaSymbol{→} \AgdaBound{σ} \AgdaFunction{≺+} \AgdaSymbol{(}\AgdaBound{x} \AgdaInductiveConstructor{,} \AgdaBound{N}\AgdaSymbol{)} \AgdaFunction{≅σ} \AgdaBound{σ'} \AgdaFunction{≺+} \AgdaSymbol{(}\AgdaBound{x} \AgdaInductiveConstructor{,} \AgdaBound{N}\AgdaSymbol{)}\<%
\\
\>\AgdaFunction{lemma≅≺+} \AgdaSymbol{\{}\AgdaBound{x}\AgdaSymbol{\}} \AgdaBound{σ≌σ'} \AgdaBound{y} \AgdaKeyword{with} \AgdaBound{x} \AgdaFunction{≟} \AgdaBound{y}\<%
\\
\>\AgdaSymbol{...} \AgdaSymbol{|} \AgdaInductiveConstructor{yes} \<[11]%
\>[11]\AgdaSymbol{\_} \AgdaSymbol{=} \AgdaInductiveConstructor{refl} \<[20]%
\>[20]\<%
\\
\>\AgdaSymbol{...} \AgdaSymbol{|} \AgdaInductiveConstructor{no} \<[11]%
\>[11]\AgdaSymbol{\_} \AgdaSymbol{=} \AgdaBound{σ≌σ'} \AgdaBound{y}\<%
\\
%
\\
\>\AgdaFunction{prop6} \AgdaSymbol{:} \AgdaSymbol{\{}\AgdaBound{σ} \AgdaBound{σ'} \AgdaSymbol{:} \AgdaFunction{Σ}\AgdaSymbol{\}\{}\AgdaBound{M} \AgdaSymbol{:} \AgdaDatatype{Λ}\AgdaSymbol{\}} \AgdaSymbol{→} \AgdaBound{σ} \AgdaFunction{≅σ} \AgdaBound{σ'} \AgdaSymbol{→} \AgdaBound{σ} \AgdaFunction{≅} \AgdaBound{σ'} \AgdaFunction{⇂} \AgdaBound{M}\<%
\\
\>\AgdaFunction{prop6} \AgdaBound{σ≅σ'} \AgdaSymbol{=} \AgdaSymbol{((λ} \AgdaBound{\_} \AgdaSymbol{→} \AgdaFunction{id}\AgdaSymbol{)} \AgdaInductiveConstructor{,} \AgdaSymbol{(λ} \AgdaBound{\_} \AgdaSymbol{→} \AgdaFunction{id}\AgdaSymbol{))} \AgdaInductiveConstructor{,} \AgdaSymbol{λ} \AgdaBound{x} \AgdaBound{\_} \AgdaSymbol{→} \AgdaBound{σ≅σ'} \AgdaBound{x}\<%
\end{code}

\begin{code}%
\>\AgdaFunction{\_∼*⇂\_} \AgdaSymbol{:} \AgdaFunction{R} \AgdaSymbol{→} \AgdaFunction{R} \AgdaSymbol{→} \AgdaPrimitiveType{Set}\<%
\\
\>\AgdaSymbol{(}\AgdaBound{σ} \AgdaInductiveConstructor{,} \AgdaBound{M}\AgdaSymbol{)} \AgdaFunction{∼*⇂} \AgdaSymbol{(}\AgdaBound{σ'} \AgdaInductiveConstructor{,} \AgdaBound{M'}\AgdaSymbol{)} \AgdaSymbol{=} \<[25]%
\>[25]\AgdaSymbol{((}\AgdaBound{x} \AgdaSymbol{:} \AgdaFunction{V}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaBound{x} \AgdaFunction{*⇂} \AgdaSymbol{(}\AgdaBound{σ} \AgdaInductiveConstructor{,} \AgdaBound{M}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaBound{x} \AgdaFunction{*⇂} \AgdaSymbol{(}\AgdaBound{σ'} \AgdaInductiveConstructor{,} \AgdaBound{M'}\AgdaSymbol{))} \AgdaFunction{×} \<[69]%
\>[69]\<%
\\
\>[4]\AgdaIndent{25}{}\<[25]%
\>[25]\AgdaSymbol{((}\AgdaBound{x} \AgdaSymbol{:} \AgdaFunction{V}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaBound{x} \AgdaFunction{*⇂} \AgdaSymbol{(}\AgdaBound{σ'} \AgdaInductiveConstructor{,} \AgdaBound{M'}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaBound{x} \AgdaFunction{*⇂} \AgdaSymbol{(}\AgdaBound{σ} \AgdaInductiveConstructor{,} \AgdaBound{M}\AgdaSymbol{))} \<%
\end{code}

\begin{code}%
\>\AgdaFunction{fv} \AgdaSymbol{:} \AgdaDatatype{Λ} \AgdaSymbol{→} \AgdaDatatype{List} \AgdaFunction{V}\<%
\\
\>\AgdaFunction{fv} \AgdaSymbol{(}\AgdaInductiveConstructor{v} \AgdaBound{a}\AgdaSymbol{)} \<[13]%
\>[13]\AgdaSymbol{=} \AgdaFunction{[} \AgdaBound{a} \AgdaFunction{]}\<%
\\
\>\AgdaFunction{fv} \AgdaSymbol{(}\AgdaBound{M} \AgdaInductiveConstructor{·} \AgdaBound{N}\AgdaSymbol{)} \<[13]%
\>[13]\AgdaSymbol{=} \AgdaFunction{fv} \AgdaBound{M} \AgdaFunction{++} \AgdaFunction{fv} \AgdaBound{N}\<%
\\
\>\AgdaFunction{fv} \AgdaSymbol{(}\AgdaInductiveConstructor{ƛ} \AgdaBound{a} \AgdaBound{M}\AgdaSymbol{)} \<[13]%
\>[13]\AgdaSymbol{=} \AgdaFunction{fv} \AgdaBound{M} \AgdaFunction{-} \AgdaBound{a}\<%
\\
\>\AgdaComment{--}\<%
\\
\>\AgdaFunction{lemmafvfree→} \AgdaSymbol{:} \AgdaSymbol{(}\AgdaBound{x} \AgdaSymbol{:} \AgdaFunction{V}\AgdaSymbol{)(}\AgdaBound{M} \AgdaSymbol{:} \AgdaDatatype{Λ}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaBound{x} \AgdaFunction{∈} \AgdaFunction{fv} \AgdaBound{M} \AgdaSymbol{→} \AgdaBound{x} \AgdaDatatype{*} \AgdaBound{M}\<%
\\
\>\AgdaFunction{lemmafvfree→} \AgdaBound{x} \AgdaSymbol{(}\AgdaInductiveConstructor{v} \AgdaBound{y}\AgdaSymbol{)} \<[24]%
\>[24]\AgdaSymbol{(}\AgdaInductiveConstructor{here} \AgdaBound{x≡y}\AgdaSymbol{)} \AgdaKeyword{with} \AgdaBound{y} \AgdaFunction{≟} \AgdaBound{x} \<[46]%
\>[46]\<%
\\
\>\AgdaSymbol{...} \AgdaSymbol{|} \AgdaInductiveConstructor{no} \<[11]%
\>[11]\AgdaBound{y≢x} \AgdaSymbol{=} \AgdaFunction{⊥-elim} \AgdaSymbol{(}\AgdaBound{y≢x} \AgdaSymbol{(}\AgdaFunction{sym} \AgdaBound{x≡y}\AgdaSymbol{))} \<[40]%
\>[40]\<%
\\
\>\AgdaFunction{lemmafvfree→} \AgdaBound{x} \AgdaSymbol{(}\AgdaInductiveConstructor{v} \AgdaSymbol{.}\AgdaBound{x}\AgdaSymbol{)} \<[25]%
\>[25]\AgdaSymbol{(}\AgdaInductiveConstructor{here} \AgdaBound{x≡x}\AgdaSymbol{)} \<[36]%
\>[36]\<%
\\
\>[0]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaSymbol{|} \AgdaInductiveConstructor{yes} \<[11]%
\>[11]\AgdaInductiveConstructor{refl} \AgdaSymbol{=} \AgdaInductiveConstructor{*v}\<%
\\
\>\AgdaFunction{lemmafvfree→} \AgdaBound{x} \AgdaSymbol{(}\AgdaInductiveConstructor{v} \AgdaBound{y}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaInductiveConstructor{there} \AgdaSymbol{())} \<[32]%
\>[32]\<%
\\
\>\AgdaFunction{lemmafvfree→} \AgdaBound{x} \AgdaSymbol{(}\AgdaBound{M} \AgdaInductiveConstructor{·} \AgdaBound{N}\AgdaSymbol{)} \<[24]%
\>[24]\AgdaBound{x∈fvMN} \AgdaKeyword{with} \AgdaFunction{c∈xs++ys→c∈xs∨c∈ys} \<[56]%
\>[56]\AgdaBound{x∈fvMN} \<[63]%
\>[63]\<%
\\
\>\AgdaSymbol{...} \AgdaSymbol{|} \AgdaInductiveConstructor{inj₁} \AgdaBound{x∈fvM} \AgdaSymbol{=} \AgdaInductiveConstructor{*·l} \AgdaSymbol{(}\AgdaFunction{lemmafvfree→} \AgdaBound{x} \AgdaBound{M} \AgdaBound{x∈fvM}\AgdaSymbol{)}\<%
\\
\>\AgdaSymbol{...} \AgdaSymbol{|} \AgdaInductiveConstructor{inj₂} \AgdaBound{x∈fvN} \AgdaSymbol{=} \AgdaInductiveConstructor{*·r} \AgdaSymbol{(}\AgdaFunction{lemmafvfree→} \AgdaBound{x} \AgdaBound{N} \AgdaBound{x∈fvN}\AgdaSymbol{)}\<%
\\
\>\AgdaFunction{lemmafvfree→} \AgdaBound{x} \AgdaSymbol{(}\AgdaInductiveConstructor{ƛ} \AgdaBound{y} \AgdaBound{M}\AgdaSymbol{)} \<[24]%
\>[24]\AgdaBound{x∈fvM-y} \AgdaKeyword{with} \AgdaBound{y} \AgdaFunction{≟} \AgdaBound{x} \AgdaSymbol{|} \AgdaFunction{lemmafilter→} \AgdaBound{x} \AgdaSymbol{(}\AgdaFunction{fv} \AgdaBound{M}\AgdaSymbol{)} \AgdaSymbol{(λ} \AgdaBound{z} \AgdaSymbol{→} \AgdaFunction{not} \AgdaSymbol{(}\AgdaFunction{⌊} \AgdaBound{y} \AgdaFunction{≟} \AgdaBound{z} \AgdaFunction{⌋}\AgdaSymbol{))} \AgdaBound{x∈fvM-y}\<%
\\
\>\AgdaSymbol{...} \AgdaSymbol{|} \AgdaInductiveConstructor{no} \AgdaBound{y≢x} \<[15]%
\>[15]\AgdaSymbol{|} \AgdaSymbol{\_} \AgdaInductiveConstructor{,} \AgdaBound{x∈fvM} \AgdaSymbol{=} \AgdaInductiveConstructor{*ƛ} \AgdaSymbol{(}\AgdaFunction{lemmafvfree→} \AgdaBound{x} \AgdaBound{M} \AgdaBound{x∈fvM}\AgdaSymbol{)} \AgdaBound{y≢x} \<[61]%
\>[61]\<%
\\
\>\AgdaFunction{lemmafvfree→} \AgdaBound{x} \AgdaSymbol{(}\AgdaInductiveConstructor{ƛ} \AgdaSymbol{.}\AgdaBound{x} \AgdaBound{M}\AgdaSymbol{)} \<[25]%
\>[25]\AgdaBound{x∈fvM-y} \<[33]%
\>[33]\<%
\\
\>[0]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaSymbol{|} \AgdaInductiveConstructor{yes} \AgdaInductiveConstructor{refl} \AgdaSymbol{|} \AgdaSymbol{()} \AgdaInductiveConstructor{,} \AgdaSymbol{\_} \<[25]%
\>[25]\<%
\\
\>\AgdaComment{-- }\<%
\\
\>\AgdaFunction{lemmafvfree←} \AgdaSymbol{:} \AgdaSymbol{(}\AgdaBound{x} \AgdaSymbol{:} \AgdaFunction{V}\AgdaSymbol{)(}\AgdaBound{M} \AgdaSymbol{:} \AgdaDatatype{Λ}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaBound{x} \AgdaDatatype{*} \AgdaBound{M} \AgdaSymbol{→} \AgdaBound{x} \AgdaFunction{∈} \AgdaFunction{fv} \AgdaBound{M}\<%
\\
\>\AgdaFunction{lemmafvfree←} \AgdaBound{x} \AgdaSymbol{(}\AgdaInductiveConstructor{v} \AgdaSymbol{.}\AgdaBound{x}\AgdaSymbol{)} \<[25]%
\>[25]\AgdaInductiveConstructor{*v} \<[40]%
\>[40]\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaSymbol{=} \AgdaInductiveConstructor{here} \AgdaInductiveConstructor{refl}\<%
\\
\>\AgdaFunction{lemmafvfree←} \AgdaBound{x} \AgdaSymbol{.(}\AgdaBound{M} \AgdaInductiveConstructor{·} \AgdaBound{N}\AgdaSymbol{)} \<[25]%
\>[25]\AgdaSymbol{(}\AgdaInductiveConstructor{*·l} \AgdaSymbol{\{}\AgdaSymbol{.}\AgdaBound{x}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{M}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{N}\AgdaSymbol{\}} \AgdaBound{xfreeM}\AgdaSymbol{)} \<[55]%
\>[55]\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaSymbol{=} \AgdaFunction{c∈xs∨c∈ys→c∈xs++ys} \AgdaSymbol{(}\AgdaInductiveConstructor{inj₁} \AgdaSymbol{(}\AgdaFunction{lemmafvfree←} \AgdaBound{x} \AgdaBound{M} \AgdaBound{xfreeM}\AgdaSymbol{))}\<%
\\
\>\AgdaFunction{lemmafvfree←} \AgdaBound{x} \AgdaSymbol{.(}\AgdaBound{M} \AgdaInductiveConstructor{·} \AgdaBound{N}\AgdaSymbol{)} \<[25]%
\>[25]\AgdaSymbol{(}\AgdaInductiveConstructor{*·r} \AgdaSymbol{\{}\AgdaSymbol{.}\AgdaBound{x}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{M}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{N}\AgdaSymbol{\}} \AgdaBound{xfreeN}\AgdaSymbol{)} \<[55]%
\>[55]\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaSymbol{=} \AgdaFunction{c∈xs∨c∈ys→c∈xs++ys} \AgdaSymbol{\{}\AgdaBound{x}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaFunction{fv} \AgdaBound{M}\AgdaSymbol{\}} \AgdaSymbol{(}\AgdaInductiveConstructor{inj₂} \AgdaSymbol{(}\AgdaFunction{lemmafvfree←} \AgdaBound{x} \AgdaBound{N} \AgdaBound{xfreeN}\AgdaSymbol{))}\<%
\\
\>\AgdaFunction{lemmafvfree←} \AgdaBound{x} \AgdaSymbol{.(}\AgdaInductiveConstructor{ƛ} \AgdaBound{y} \AgdaBound{M}\AgdaSymbol{)} \<[25]%
\>[25]\AgdaSymbol{(}\AgdaInductiveConstructor{*ƛ} \AgdaSymbol{\{}\AgdaSymbol{.}\AgdaBound{x}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{y}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{M}\AgdaSymbol{\}} \AgdaBound{xfreeM} \AgdaBound{y≢x}\AgdaSymbol{)} \<[55]%
\>[55]\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaSymbol{=} \AgdaFunction{filter-∈} \AgdaSymbol{(λ} \AgdaBound{z} \AgdaSymbol{→} \AgdaFunction{not} \AgdaSymbol{(}\AgdaFunction{⌊} \AgdaBound{y} \AgdaFunction{≟} \AgdaBound{z} \AgdaFunction{⌋}\AgdaSymbol{))} \AgdaSymbol{(}\AgdaFunction{fv} \AgdaBound{M}\AgdaSymbol{)} \AgdaSymbol{\{}\AgdaBound{x}\AgdaSymbol{\}} \AgdaSymbol{(}\AgdaFunction{lemmafvfree←} \AgdaBound{x} \AgdaBound{M} \AgdaBound{xfreeM}\AgdaSymbol{)} \AgdaFunction{px≡true} \<[82]%
\>[82]\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaKeyword{where} \<[8]%
\>[8]\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{px≡true} \AgdaSymbol{:} \AgdaFunction{not} \AgdaFunction{⌊} \AgdaBound{y} \AgdaFunction{≟} \AgdaBound{x} \AgdaFunction{⌋} \AgdaDatatype{≡} \AgdaInductiveConstructor{true}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{px≡true} \AgdaKeyword{with} \AgdaBound{y} \AgdaFunction{≟} \AgdaBound{x}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaSymbol{...} \AgdaSymbol{|} \AgdaInductiveConstructor{yes} \AgdaBound{y≡x} \AgdaSymbol{=} \AgdaFunction{⊥-elim} \AgdaSymbol{(}\AgdaBound{y≢x} \AgdaBound{y≡x}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaSymbol{...} \AgdaSymbol{|} \AgdaInductiveConstructor{no} \<[12]%
\>[12]\AgdaSymbol{\_} \<[16]%
\>[16]\AgdaSymbol{=} \AgdaInductiveConstructor{refl}\<%
\end{code}

\begin{code}%
\>\AgdaFunction{lemma∉fv→\#} \AgdaSymbol{:} \AgdaSymbol{∀} \AgdaSymbol{\{}\AgdaBound{a} \AgdaSymbol{:} \AgdaFunction{V}\AgdaSymbol{\}\{}\AgdaBound{M} \AgdaSymbol{:} \AgdaDatatype{Λ}\AgdaSymbol{\}} \AgdaSymbol{→} \AgdaBound{a} \AgdaFunction{∉} \AgdaFunction{fv} \AgdaBound{M} \AgdaSymbol{→} \AgdaBound{a} \AgdaDatatype{\#} \AgdaBound{M}\<%
\\
\>\AgdaFunction{lemma∉fv→\#} \AgdaSymbol{\{}\AgdaBound{a}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{M}\AgdaSymbol{\}} \AgdaBound{a∉fvM} \AgdaKeyword{with} \AgdaBound{a} \AgdaFunction{\#?} \AgdaBound{M}\<%
\\
\>\AgdaSymbol{...} \AgdaSymbol{|} \AgdaInductiveConstructor{yes} \AgdaBound{a\#M} \AgdaSymbol{=} \AgdaBound{a\#M}\<%
\\
\>\AgdaSymbol{...} \AgdaSymbol{|} \AgdaInductiveConstructor{no} \AgdaBound{¬a\#M} \AgdaSymbol{=} \AgdaFunction{⊥-elim} \AgdaSymbol{(}\AgdaBound{a∉fvM} \AgdaSymbol{(}\AgdaFunction{lemmafvfree←} \AgdaBound{a} \AgdaBound{M} \AgdaSymbol{(}\AgdaFunction{lemma¬\#→free} \AgdaBound{¬a\#M}\AgdaSymbol{)))}\<%
\end{code}

-- \begin{code}%
\>\<%
\\
\>\AgdaComment{-- f : \{α : Type\}(M : Λ)(Γ : Cxt) → Γ ⊢ M ∶ α → \{x : V\} → (x∈xs : x ∈ fv M) → V × Type}\<%
\\
\>\AgdaComment{-- f M Γ Γ⊢M∶α = λ \{x\} x∈vs → (x , Γ ⟨ lemma⊢*∈ Γ⊢M∶α (lemmafvfree→ x M x∈vs) ⟩) }\<%
\\
%
\\
\>\AgdaComment{-- freeCxt  : \{Γ : Cxt\}\{M : Λ\}\{α : Type\} }\<%
\\
\>\AgdaComment{--          → Γ ⊢ M ∶ α}\<%
\\
\>\AgdaComment{--          → Cxt}\<%
\\
\>\AgdaComment{-- freeCxt \{Γ\} \{M\} Γ⊢M∶α }\<%
\\
\>\AgdaComment{--   = map-with-∈ (fv M) (f M Γ Γ⊢M∶α)}\<%
\\
%
\\
\>\AgdaComment{-- import Function.Equality as FE}\<%
\\
%
\\
\>\AgdaComment{-- lemmafreeCxt⊆  : \{Γ : Cxt\}\{M : Λ\}\{α : Type\} }\<%
\\
\>\AgdaComment{--           → (p : Γ ⊢ M ∶ α)}\<%
\\
\>\AgdaComment{--           → freeCxt p ⊆c Γ}\<%
\\
\>\AgdaComment{-- lemmafreeCxt⊆ \{Γ\} \{M\} Γ⊢M∶α \{x\} x∈free⊢ }\<%
\\
\>\AgdaComment{--   with lemma∈→∈[] x∈free⊢ }\<%
\\
\>\AgdaComment{-- ... | α , x,α∈free⊢ , free⊢⟨x∈free⊢⟩≡α }\<%
\\
\>\AgdaComment{--   with FE.Π.\_⟨\$⟩\_ (from (map-with-∈↔ \{f = f M Γ Γ⊢M∶α\})) x,α∈free⊢}\<%
\\
\>\AgdaComment{-- lemmafreeCxt⊆ \{Γ\} \{M\} Γ⊢M∶α \{x\} x∈free⊢ }\<%
\\
\>\AgdaComment{--     | .(Γ ⟨ lemma⊢*∈ Γ⊢M∶α (lemmafvfree→ x M x∈fvM) ⟩) , x,α∈free⊢ , free⊢⟨x∈free⊢⟩≡Γ }\<%
\\
\>\AgdaComment{--     | .x , x∈fvM , refl}\<%
\\
\>\AgdaComment{--   = lemma⊢*∈ Γ⊢M∶α (lemmafvfree→ x M x∈fvM) , free⊢⟨x∈free⊢⟩≡Γ }\<%
\\
%
\\
\>\AgdaComment{-- lemmafreeCxt→*  : \{Γ : Cxt\}\{M : Λ\}\{α : Type\} }\<%
\\
\>\AgdaComment{--            → (p : Γ ⊢ M ∶ α)}\<%
\\
\>\AgdaComment{--            → (x : V) → x ∈c freeCxt p }\<%
\\
\>\AgdaComment{--            → x * M}\<%
\\
\>\AgdaComment{-- lemmafreeCxt→* \{Γ\} \{M\} Γ⊢M∶α x x∈free⊢ }\<%
\\
\>\AgdaComment{--   with lemma∈→∈[] x∈free⊢ }\<%
\\
\>\AgdaComment{-- ... | α , x,α∈free⊢ , free⊢⟨x∈free⊢⟩≡α }\<%
\\
\>\AgdaComment{--   with FE.Π.\_⟨\$⟩\_ (from (map-with-∈↔ \{f = f M Γ Γ⊢M∶α\})) x,α∈free⊢}\<%
\\
\>\AgdaComment{-- lemmafreeCxt→* \{Γ\} \{M\} Γ⊢M∶α x x∈free⊢ }\<%
\\
\>\AgdaComment{--     | .(Γ ⟨ lemma⊢*∈ Γ⊢M∶α (lemmafvfree→ x M x∈fvM) ⟩) , x,α∈free⊢ , free⊢⟨x∈free⊢⟩≡Γ }\<%
\\
\>\AgdaComment{--     | .x , x∈fvM , refl}\<%
\\
\>\AgdaComment{--     = lemmafvfree→ x M x∈fvM}\<%
\\
%
\\
\>\AgdaComment{-- lemmafreeCxt←*  : \{Γ : Cxt\}\{M : Λ\}\{α : Type\}\{x : V\}}\<%
\\
\>\AgdaComment{--            → (p : Γ ⊢ M ∶ α)}\<%
\\
\>\AgdaComment{--            → x * M}\<%
\\
\>\AgdaComment{--            → x ∈c freeCxt p}\<%
\\
\>\AgdaComment{-- lemmafreeCxt←* \{Γ\} \{M\} \{α\} \{x\} Γ⊢M∶α x*M }\<%
\\
\>\AgdaComment{--   with lemmafvfree← x M x*M }\<%
\\
\>\AgdaComment{-- ... | x∈fvM}\<%
\\
\>\AgdaComment{--   = lemma∈[]→∈ (FE.Π.\_⟨\$⟩\_ (to (map-with-∈↔ \{f = f M Γ Γ⊢M∶α\})) (x , x∈fvM , refl)) }\<%
\\
%
\\
\>\AgdaComment{-- lemmaStrengthening⊢free  : \{Γ : Cxt\}\{M : Λ\}\{α : Type\} }\<%
\\
\>\AgdaComment{--                          → (p : Γ ⊢ M ∶ α) → freeCxt p ⊢ M ∶ α}\<%
\\
\>\AgdaComment{-- lemmaStrengthening⊢free (⊢v \{x\} x∈Γ) }\<%
\\
\>\AgdaComment{--   rewrite lemma∈!⟨⟩ (lemma⊢*∈ (⊢v x∈Γ) (lemmafvfree→ x (v x) (here refl))) x∈Γ}\<%
\\
\>\AgdaComment{--   = ⊢v (here refl) }\<%
\\
\>\AgdaComment{-- lemmaStrengthening⊢free (⊢· Γ⊢M∶α⟶β Γ⊢N∶α) }\<%
\\
\>\AgdaComment{--   with lemmaStrengthening⊢free Γ⊢M∶α⟶β | lemmaStrengthening⊢free Γ⊢N∶α}\<%
\\
\>\AgdaComment{-- ... | freeM⊢M∶α⟶β | freeN⊢N∶α }\<%
\\
\>\AgdaComment{--   = ⊢·  (lemmaWeakening⊢ lemmafreeM⊆freeMN freeM⊢M∶α⟶β) }\<%
\\
\>\AgdaComment{--         (lemmaWeakening⊢ lemmafreeN⊆freeMN freeN⊢N∶α) }\<%
\\
\>\AgdaComment{--   where}\<%
\\
\>\AgdaComment{--   lemmafreeM⊆freeMN : freeCxt Γ⊢M∶α⟶β ⊆c freeCxt (⊢· Γ⊢M∶α⟶β Γ⊢N∶α) }\<%
\\
\>\AgdaComment{--   lemmafreeM⊆freeMN \{x\} x∈freeM }\<%
\\
\>\AgdaComment{--     with lemmafreeCxt⊆ Γ⊢M∶α⟶β x∈freeM | lemmafreeCxt⊆ (⊢· Γ⊢M∶α⟶β Γ⊢N∶α) (lemmafreeCxt←* (⊢· Γ⊢M∶α⟶β Γ⊢N∶α) (*·l (lemmafreeCxt→* Γ⊢M∶α⟶β x x∈freeM)))}\<%
\\
\>\AgdaComment{--   ... | x∈Γ , freeM⟨x∈freeM⟩≡Γ⟨x∈Γ⟩ | x∈Γ' , freeMN⟨x∈freeMN⟩≡Γ⟨x∈Γ'⟩ rewrite lemma∈!⟨⟩ x∈Γ x∈Γ'}\<%
\\
\>\AgdaComment{--     =     lemmafreeCxt←* (⊢· Γ⊢M∶α⟶β Γ⊢N∶α) (*·l (lemmafreeCxt→* Γ⊢M∶α⟶β x x∈freeM)) }\<%
\\
\>\AgdaComment{--        ,  trans freeM⟨x∈freeM⟩≡Γ⟨x∈Γ⟩ (sym freeMN⟨x∈freeMN⟩≡Γ⟨x∈Γ'⟩)}\<%
\\
\>\AgdaComment{--   lemmafreeN⊆freeMN : freeCxt Γ⊢N∶α ⊆c freeCxt (⊢· Γ⊢M∶α⟶β Γ⊢N∶α) }\<%
\\
\>\AgdaComment{--   lemmafreeN⊆freeMN \{x\} x∈freeN }\<%
\\
\>\AgdaComment{--     with lemmafreeCxt⊆ Γ⊢N∶α x∈freeN | lemmafreeCxt⊆ (⊢· Γ⊢M∶α⟶β Γ⊢N∶α) (lemmafreeCxt←* (⊢· Γ⊢M∶α⟶β Γ⊢N∶α) (*·r (lemmafreeCxt→* Γ⊢N∶α x x∈freeN)))}\<%
\\
\>\AgdaComment{--   ... | x∈Γ , freeN⟨x∈freeN⟩≡Γ⟨x∈Γ⟩ | x∈Γ' , freeMN⟨x∈freeMN⟩≡Γ⟨x∈Γ'⟩ rewrite lemma∈!⟨⟩ x∈Γ x∈Γ'}\<%
\\
\>\AgdaComment{--     =     lemmafreeCxt←* (⊢· Γ⊢M∶α⟶β Γ⊢N∶α) (*·r (lemmafreeCxt→* Γ⊢N∶α x x∈freeN)) }\<%
\\
\>\AgdaComment{--        ,  trans freeN⟨x∈freeN⟩≡Γ⟨x∈Γ⟩ (sym freeMN⟨x∈freeMN⟩≡Γ⟨x∈Γ'⟩)}\<%
\\
\>\AgdaComment{-- lemmaStrengthening⊢free (⊢ƛ \{y\} \{α\} Γ,y:α⊢M∶β)}\<%
\\
\>\AgdaComment{--   with lemmaStrengthening⊢free Γ,y:α⊢M∶β}\<%
\\
\>\AgdaComment{-- ... | freeM⊢M∶β}\<%
\\
\>\AgdaComment{--   = ⊢ƛ (lemmaWeakening⊢ lemmafreeM⊆freeλyM freeM⊢M∶β)}\<%
\\
\>\AgdaComment{--   where }\<%
\\
\>\AgdaComment{--   lemmafreeM⊆freeλyM : freeCxt Γ,y:α⊢M∶β ⊆c freeCxt (⊢ƛ Γ,y:α⊢M∶β) ‚ y , α}\<%
\\
\>\AgdaComment{--   lemmafreeM⊆freeλyM \{x\} x∈freeM }\<%
\\
\>\AgdaComment{--     with lemmafreeCxt⊆ Γ,y:α⊢M∶β x∈freeM }\<%
\\
\>\AgdaComment{--   ... | x∈Γ,y:α , freeM⟨x∈freeM⟩≡Γ,y:α⟨x∈Γ,y:α⟩ }\<%
\\
\>\AgdaComment{--     with x ≟ y}\<%
\\
\>\AgdaComment{--   ... | no x≢y }\<%
\\
\>\AgdaComment{--     with lemmafreeCxt⊆ (⊢ƛ Γ,y:α⊢M∶β) (lemmafreeCxt←* (⊢ƛ Γ,y:α⊢M∶β) (*ƛ (lemmafreeCxt→* Γ,y:α⊢M∶β x x∈freeM) (λ y≡x → ⊥-elim (x≢y (sym y≡x)))))}\<%
\\
\>\AgdaComment{--   lemmafreeM⊆freeλyM \{x\} x∈freeM }\<%
\\
\>\AgdaComment{--       | here x≡y , freeM⟨x∈freeM⟩≡Γ,y:α⟨x∈Γ,y:α⟩ }\<%
\\
\>\AgdaComment{--       | no x≢y }\<%
\\
\>\AgdaComment{--       | x∈Γ , freeλyM⟨x∈freeƛyM⟩≡Γ⟨x∈Γ⟩}\<%
\\
\>\AgdaComment{--     = ⊥-elim (x≢y x≡y) }\<%
\\
\>\AgdaComment{--   lemmafreeM⊆freeλyM \{x\} x∈freeM }\<%
\\
\>\AgdaComment{--       | there \_ x∈Γ' , freeM⟨x∈freeM⟩≡Γ⟨x∈Γ'⟩ }\<%
\\
\>\AgdaComment{--       | no x≢y }\<%
\\
\>\AgdaComment{--       | x∈Γ , freeλyM⟨x∈freeƛyM⟩≡Γ⟨x∈Γ⟩}\<%
\\
\>\AgdaComment{--       rewrite lemma∈!⟨⟩ x∈Γ x∈Γ'}\<%
\\
\>\AgdaComment{--     =     there x≢y (lemmafreeCxt←* (⊢ƛ Γ,y:α⊢M∶β) (*ƛ (lemmafreeCxt→* Γ,y:α⊢M∶β x x∈freeM) (λ y≡x → ⊥-elim (x≢y (sym y≡x)))))}\<%
\\
\>\AgdaComment{--        ,  trans freeM⟨x∈freeM⟩≡Γ⟨x∈Γ'⟩ (sym freeλyM⟨x∈freeƛyM⟩≡Γ⟨x∈Γ⟩)}\<%
\\
\>\AgdaComment{--   lemmafreeM⊆freeλyM .\{y\} y∈freeM}\<%
\\
\>\AgdaComment{--       | here refl , freeM⟨x∈freeM⟩≡α}\<%
\\
\>\AgdaComment{--       | yes refl =  here refl , freeM⟨x∈freeM⟩≡α}\<%
\\
\>\AgdaComment{--   lemmafreeM⊆freeλyM .\{y\} y∈freeM}\<%
\\
\>\AgdaComment{--       | there y≢y \_ , freeM⟨x∈freeM⟩≡Γ,y:α⟨x∈Γ⟩ }\<%
\\
\>\AgdaComment{--       | yes refl = ⊥-elim (y≢y refl)}\<%
\\
\>\AgdaComment{-- }\<%
\end{code}

Chi encapsulation

\begin{code}%
\>\AgdaFunction{χ} \AgdaSymbol{:} \AgdaFunction{R} \AgdaSymbol{→} \AgdaFunction{V}\<%
\\
\>\AgdaFunction{χ} \AgdaSymbol{(}\AgdaBound{σ} \AgdaInductiveConstructor{,} \AgdaBound{M}\AgdaSymbol{)} \AgdaSymbol{=} \AgdaFunction{χ'} \AgdaSymbol{(}\AgdaFunction{concat} \AgdaSymbol{(}\AgdaFunction{map} \AgdaSymbol{(}\AgdaFunction{fv} \AgdaFunction{∘f} \AgdaBound{σ}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaFunction{fv} \AgdaBound{M}\AgdaSymbol{)))}\<%
\end{code}

\begin{code}%
\>\AgdaFunction{χₜ} \AgdaSymbol{:} \AgdaDatatype{Λ} \AgdaSymbol{→} \AgdaFunction{V}\<%
\\
\>\AgdaFunction{χₜ} \AgdaBound{M} \AgdaSymbol{=} \AgdaFunction{χ'} \AgdaSymbol{(}\AgdaFunction{fv} \AgdaBound{M}\AgdaSymbol{)}\<%
\\
\>\AgdaComment{--}\<%
\\
\>\AgdaFunction{lemmaχₜ\#} \AgdaSymbol{:} \AgdaSymbol{\{}\AgdaBound{M} \AgdaSymbol{:} \AgdaDatatype{Λ}\AgdaSymbol{\}} \AgdaSymbol{→} \AgdaFunction{χₜ} \AgdaBound{M} \AgdaDatatype{\#} \AgdaBound{M}\<%
\\
\>\AgdaFunction{lemmaχₜ\#} \AgdaSymbol{\{}\AgdaBound{M}\AgdaSymbol{\}} \AgdaSymbol{=} \AgdaFunction{lemma∉fv→\#} \AgdaSymbol{(}\AgdaFunction{lemmaχaux∉} \AgdaSymbol{(}\AgdaFunction{fv} \AgdaBound{M}\AgdaSymbol{))}\<%
\end{code}

\begin{code}%
\>\AgdaFunction{χ-lemma2} \AgdaSymbol{:} \AgdaSymbol{(}\AgdaBound{σ} \AgdaSymbol{:} \AgdaFunction{Σ}\AgdaSymbol{)(}\AgdaBound{M} \AgdaSymbol{:} \AgdaDatatype{Λ}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaFunction{χ} \AgdaSymbol{(}\AgdaBound{σ} \AgdaInductiveConstructor{,} \AgdaBound{M}\AgdaSymbol{)} \AgdaFunction{\#⇂} \AgdaSymbol{(}\AgdaBound{σ} \AgdaInductiveConstructor{,} \AgdaBound{M}\AgdaSymbol{)}\<%
\\
\>\AgdaFunction{χ-lemma2} \AgdaBound{σ} \AgdaBound{M} \AgdaBound{y} \AgdaBound{yfreeM} \AgdaKeyword{with} \AgdaFunction{χ} \AgdaSymbol{(}\AgdaBound{σ} \AgdaInductiveConstructor{,} \AgdaBound{M}\AgdaSymbol{)} \AgdaFunction{\#?} \AgdaBound{σ} \AgdaBound{y}\<%
\\
\>\AgdaSymbol{...} \AgdaSymbol{|} \AgdaInductiveConstructor{yes} \AgdaBound{χσM\#σy} \AgdaSymbol{=} \AgdaBound{χσM\#σy}\<%
\\
\>\AgdaSymbol{...} \AgdaSymbol{|} \AgdaInductiveConstructor{no} \AgdaBound{¬χσM\#σy} \AgdaSymbol{=} \AgdaFunction{⊥-elim} \AgdaSymbol{(}\AgdaFunction{χ∉concatmapfv∘σfvM} \AgdaFunction{χ∈concatmapfv∘σfvM}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaKeyword{where}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaComment{-- Using lemma lemmaχaux∉ we know χ not in the list (concat (map (fv ∘ σ) (fv M))) passed}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{χ∉concatmapfv∘σfvM} \AgdaSymbol{:} \AgdaFunction{χ} \AgdaSymbol{(}\AgdaBound{σ} \AgdaInductiveConstructor{,} \AgdaBound{M}\AgdaSymbol{)} \AgdaFunction{∉} \AgdaSymbol{(}\AgdaFunction{concat} \AgdaSymbol{(}\AgdaFunction{map} \AgdaSymbol{(}\AgdaFunction{fv} \AgdaFunction{∘f} \AgdaBound{σ}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaFunction{fv} \AgdaBound{M}\AgdaSymbol{)))}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{χ∉concatmapfv∘σfvM} \AgdaSymbol{=} \AgdaFunction{lemmaχaux∉} \AgdaSymbol{(}\AgdaFunction{concat} \AgdaSymbol{(}\AgdaFunction{map} \AgdaSymbol{(}\AgdaFunction{fv} \AgdaFunction{∘f} \AgdaBound{σ}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaFunction{fv} \AgdaBound{M}\AgdaSymbol{)))}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaComment{-- y * M ⇒ y ∈ fv M}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{y∈fvM} \AgdaSymbol{:} \AgdaBound{y} \AgdaFunction{∈} \AgdaFunction{fv} \AgdaBound{M}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{y∈fvM} \AgdaSymbol{=} \AgdaFunction{lemmafvfree←} \AgdaBound{y} \AgdaBound{M} \AgdaBound{yfreeM}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaComment{-- due to y ∈ fv M we have that fv (σ y) ∈ map (fv ∘ σ) (fv M)}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{fvσy∈mapfv∘σfvM} \AgdaSymbol{:} \AgdaFunction{fv} \AgdaSymbol{(}\AgdaBound{σ} \AgdaBound{y}\AgdaSymbol{)} \AgdaFunction{∈} \AgdaSymbol{(}\AgdaFunction{map} \AgdaSymbol{(}\AgdaFunction{fv} \AgdaFunction{∘f} \AgdaBound{σ}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaFunction{fv} \AgdaBound{M}\AgdaSymbol{))}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{fvσy∈mapfv∘σfvM} \AgdaSymbol{=} \AgdaSymbol{((}\AgdaField{FE.Π.\_⟨\$⟩\_} \AgdaSymbol{(}\AgdaField{to} \AgdaSymbol{(}\AgdaFunction{map-∈↔} \AgdaSymbol{\{}\AgdaArgument{f} \AgdaSymbol{=} \AgdaFunction{fv} \AgdaFunction{∘f} \AgdaBound{σ}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaArgument{y} \AgdaSymbol{=} \AgdaFunction{fv} \AgdaSymbol{(}\AgdaBound{σ} \AgdaBound{y}\AgdaSymbol{)\}} \AgdaSymbol{\{}\AgdaArgument{xs} \AgdaSymbol{=} \AgdaFunction{fv} \AgdaBound{M}\AgdaSymbol{\})))} \AgdaSymbol{(}\AgdaBound{y} \AgdaInductiveConstructor{,} \AgdaFunction{y∈fvM} \AgdaInductiveConstructor{,} \AgdaInductiveConstructor{refl}\AgdaSymbol{))}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaComment{-- we know ¬ χ \# σ y ⇒ χ * (σ y), and then χ ∈ fv (σ y)}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{χfreeσy} \AgdaSymbol{:} \AgdaFunction{χ} \AgdaSymbol{(}\AgdaBound{σ} \AgdaInductiveConstructor{,} \AgdaBound{M}\AgdaSymbol{)} \AgdaFunction{∈} \AgdaSymbol{(}\AgdaFunction{fv} \AgdaSymbol{(}\AgdaBound{σ} \AgdaBound{y}\AgdaSymbol{))}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{χfreeσy} \AgdaSymbol{=} \AgdaFunction{lemmafvfree←} \AgdaSymbol{(}\AgdaFunction{χ} \AgdaSymbol{(}\AgdaBound{σ} \AgdaInductiveConstructor{,} \AgdaBound{M}\AgdaSymbol{))} \AgdaSymbol{(}\AgdaBound{σ} \AgdaBound{y}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaFunction{lemma¬\#→free} \AgdaBound{¬χσM\#σy}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaComment{-- χ ∈ fv (σ y) and fv (σ y) ∈ map (fv ∘ σ) (fv M) ⇒ χ ∈ concat (map (fv ∘f σ) (fv M))}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{χ∈concatmapfv∘σfvM} \AgdaSymbol{:} \AgdaFunction{χ} \AgdaSymbol{(}\AgdaBound{σ} \AgdaInductiveConstructor{,} \AgdaBound{M}\AgdaSymbol{)} \AgdaFunction{∈} \AgdaSymbol{(}\AgdaFunction{concat} \AgdaSymbol{(}\AgdaFunction{map} \AgdaSymbol{(}\AgdaFunction{fv} \AgdaFunction{∘f} \AgdaBound{σ}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaFunction{fv} \AgdaBound{M}\AgdaSymbol{)))}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{χ∈concatmapfv∘σfvM} \AgdaSymbol{=} \AgdaSymbol{(}\AgdaField{FE.Π.\_⟨\$⟩\_} \AgdaSymbol{(}\AgdaField{to} \AgdaSymbol{(}\AgdaFunction{concat-∈↔} \AgdaSymbol{\{}\AgdaArgument{x} \AgdaSymbol{=} \AgdaFunction{χ} \AgdaSymbol{(}\AgdaBound{σ} \AgdaInductiveConstructor{,} \AgdaBound{M}\AgdaSymbol{)\}} \AgdaSymbol{\{}\AgdaArgument{xss} \AgdaSymbol{=} \AgdaFunction{map} \AgdaSymbol{(}\AgdaFunction{fv} \AgdaFunction{∘f} \AgdaBound{σ}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaFunction{fv} \AgdaBound{M}\AgdaSymbol{)\})))} \AgdaSymbol{(}\AgdaFunction{fv} \AgdaSymbol{(}\AgdaBound{σ} \AgdaBound{y}\AgdaSymbol{)} \AgdaInductiveConstructor{,} \<[111]%
\>[111]\AgdaFunction{χfreeσy} \AgdaInductiveConstructor{,} \AgdaFunction{fvσy∈mapfv∘σfvM}\AgdaSymbol{)}\<%
\\
\>\AgdaComment{--}\<%
\\
\>\AgdaFunction{χ-lemma4} \AgdaSymbol{:} \<[12]%
\>[12]\AgdaSymbol{(}\AgdaBound{σ} \AgdaBound{σ'} \AgdaSymbol{:} \AgdaFunction{Σ}\AgdaSymbol{)(}\AgdaBound{M} \AgdaBound{M'} \AgdaSymbol{:} \AgdaDatatype{Λ}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{σ} \AgdaInductiveConstructor{,} \AgdaBound{M}\AgdaSymbol{)} \AgdaFunction{∼*⇂} \AgdaSymbol{(}\AgdaBound{σ'} \AgdaInductiveConstructor{,} \AgdaBound{M'}\AgdaSymbol{)} \AgdaSymbol{→}\<%
\\
\>[2]\AgdaIndent{12}{}\<[12]%
\>[12]\AgdaFunction{χ} \AgdaSymbol{(}\AgdaBound{σ} \AgdaInductiveConstructor{,} \AgdaBound{M}\AgdaSymbol{)} \AgdaDatatype{≡} \AgdaFunction{χ} \<[27]%
\>[27]\AgdaSymbol{(}\AgdaBound{σ'} \AgdaInductiveConstructor{,} \AgdaBound{M'}\AgdaSymbol{)}\<%
\\
\>\AgdaFunction{χ-lemma4} \AgdaBound{σ} \AgdaBound{σ'} \AgdaBound{M} \AgdaBound{M'} \AgdaSymbol{(}\AgdaBound{h1} \AgdaInductiveConstructor{,} \AgdaBound{h2}\AgdaSymbol{)} \<[29]%
\>[29]\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaSymbol{=} \AgdaFunction{lemmaχaux⊆} \AgdaSymbol{((}\AgdaFunction{concat} \AgdaSymbol{(}\AgdaFunction{map} \AgdaSymbol{(}\AgdaFunction{fv} \AgdaFunction{∘f} \AgdaBound{σ}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaFunction{fv} \AgdaBound{M}\AgdaSymbol{))))} \AgdaSymbol{(}\AgdaFunction{concat} \AgdaSymbol{(}\AgdaFunction{map} \AgdaSymbol{(}\AgdaFunction{fv} \AgdaFunction{∘f} \AgdaBound{σ'}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaFunction{fv} \AgdaBound{M'}\AgdaSymbol{)))} \AgdaFunction{lemma⊆} \AgdaFunction{lemma⊇}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaKeyword{where}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{lemma⊆} \AgdaSymbol{:} \AgdaSymbol{((}\AgdaFunction{concat} \AgdaSymbol{(}\AgdaFunction{map} \AgdaSymbol{(}\AgdaFunction{fv} \AgdaFunction{∘f} \AgdaBound{σ}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaFunction{fv} \AgdaBound{M}\AgdaSymbol{))))} \AgdaFunction{⊆} \AgdaSymbol{(}\AgdaFunction{concat} \AgdaSymbol{(}\AgdaFunction{map} \AgdaSymbol{(}\AgdaFunction{fv} \AgdaFunction{∘f} \AgdaBound{σ'}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaFunction{fv} \AgdaBound{M'}\AgdaSymbol{)))} \<[81]%
\>[81]\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{lemma⊆} \AgdaSymbol{\{}\AgdaBound{y}\AgdaSymbol{\}} \AgdaBound{y∈concat} \<[22]%
\>[22]\<%
\\
\>[2]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaKeyword{with} \AgdaSymbol{(}\AgdaField{FE.Π.\_⟨\$⟩\_} \AgdaSymbol{(}\AgdaField{from} \AgdaSymbol{(}\AgdaFunction{concat-∈↔} \AgdaSymbol{\{}\AgdaArgument{x} \AgdaSymbol{=} \AgdaBound{y}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaArgument{xss} \AgdaSymbol{=} \AgdaFunction{map} \AgdaSymbol{(}\AgdaFunction{fv} \AgdaFunction{∘f} \AgdaBound{σ}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaFunction{fv} \AgdaBound{M}\AgdaSymbol{)\})))} \AgdaBound{y∈concat} \<[87]%
\>[87]\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaSymbol{...} \AgdaSymbol{|} \AgdaBound{xs} \AgdaInductiveConstructor{,} \AgdaBound{y∈xs} \AgdaInductiveConstructor{,} \AgdaBound{xs∈map} \<[27]%
\>[27]\<%
\\
\>[2]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaKeyword{with} \AgdaSymbol{(}\AgdaField{FE.Π.\_⟨\$⟩\_} \AgdaSymbol{(}\AgdaField{from} \AgdaSymbol{((}\AgdaFunction{map-∈↔} \AgdaSymbol{\{}\AgdaArgument{y} \AgdaSymbol{=} \AgdaBound{xs}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaArgument{xs} \AgdaSymbol{=} \AgdaFunction{fv} \AgdaBound{M}\AgdaSymbol{\}))))} \AgdaBound{xs∈map}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{lemma⊆} \AgdaSymbol{\{}\AgdaBound{y}\AgdaSymbol{\}} \AgdaBound{y∈concat} \<[22]%
\>[22]\<%
\\
\>[2]\AgdaIndent{6}{}\<[6]%
\>[6]\AgdaSymbol{|} \AgdaSymbol{.(}\AgdaFunction{fv} \AgdaSymbol{(}\AgdaBound{σ} \AgdaBound{x}\AgdaSymbol{))} \AgdaInductiveConstructor{,} \AgdaBound{y∈fvσx} \AgdaInductiveConstructor{,} \AgdaBound{fvσx∈map}\<%
\\
\>[2]\AgdaIndent{6}{}\<[6]%
\>[6]\AgdaSymbol{|} \AgdaBound{x} \AgdaInductiveConstructor{,} \AgdaBound{x∈fvM} \AgdaInductiveConstructor{,} \AgdaInductiveConstructor{refl}\<%
\\
\>[0]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaKeyword{with} \AgdaFunction{lemmafvfree→} \AgdaBound{x} \AgdaBound{M} \AgdaBound{x∈fvM} \AgdaSymbol{|} \AgdaFunction{lemmafvfree→} \AgdaBound{y} \AgdaSymbol{(}\AgdaBound{σ} \AgdaBound{x}\AgdaSymbol{)} \AgdaBound{y∈fvσx}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaSymbol{...} \AgdaSymbol{|} \AgdaBound{xfreeM} \AgdaSymbol{|} \AgdaBound{yfreeσx}\<%
\\
\>[2]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaKeyword{with} \AgdaBound{h1} \AgdaBound{y} \AgdaSymbol{(}\AgdaBound{x} \AgdaInductiveConstructor{,} \AgdaBound{xfreeM} \AgdaInductiveConstructor{,} \AgdaBound{yfreeσx}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaSymbol{...} \AgdaSymbol{|} \AgdaBound{u} \AgdaInductiveConstructor{,} \AgdaBound{ufreeM'} \AgdaInductiveConstructor{,} \AgdaBound{yfreeσ'u} \<[31]%
\>[31]\<%
\\
\>[2]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaKeyword{with} \AgdaFunction{lemmafvfree←} \AgdaBound{u} \AgdaBound{M'} \AgdaBound{ufreeM'} \AgdaSymbol{|} \AgdaFunction{lemmafvfree←} \AgdaBound{y} \AgdaSymbol{(}\AgdaBound{σ'} \AgdaBound{u}\AgdaSymbol{)} \AgdaBound{yfreeσ'u}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaSymbol{...} \AgdaSymbol{|} \AgdaBound{u∈fvM'} \AgdaSymbol{|} \AgdaBound{y∈fvσ'u} \<[25]%
\>[25]\<%
\\
\>[2]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaKeyword{with} \AgdaSymbol{(}\AgdaField{FE.Π.\_⟨\$⟩\_} \AgdaSymbol{(}\AgdaField{to} \AgdaSymbol{((}\AgdaFunction{map-∈↔} \AgdaSymbol{\{}\AgdaArgument{f} \AgdaSymbol{=} \AgdaFunction{fv} \AgdaFunction{∘f} \AgdaBound{σ'}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaArgument{y} \AgdaSymbol{=} \AgdaFunction{fv} \AgdaSymbol{(}\AgdaBound{σ'} \AgdaBound{u}\AgdaSymbol{)\}} \AgdaSymbol{\{}\AgdaArgument{xs} \AgdaSymbol{=} \AgdaFunction{fv} \AgdaBound{M'}\AgdaSymbol{\}))))} \AgdaSymbol{(}\AgdaBound{u} \AgdaInductiveConstructor{,} \AgdaBound{u∈fvM'} \AgdaInductiveConstructor{,} \AgdaInductiveConstructor{refl}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaSymbol{...} \AgdaSymbol{|} \AgdaBound{fvσ'u∈map} \<[18]%
\>[18]\<%
\\
\>[2]\AgdaIndent{5}{}\<[5]%
\>[5]\AgdaSymbol{=} \AgdaSymbol{(}\AgdaField{FE.Π.\_⟨\$⟩\_} \AgdaSymbol{(}\AgdaField{to} \AgdaSymbol{(}\AgdaFunction{concat-∈↔} \AgdaSymbol{\{}\AgdaArgument{x} \AgdaSymbol{=} \AgdaBound{y}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaArgument{xss} \AgdaSymbol{=} \AgdaFunction{map} \AgdaSymbol{(}\AgdaFunction{fv} \AgdaFunction{∘f} \AgdaBound{σ'}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaFunction{fv} \AgdaBound{M'}\AgdaSymbol{)\})))} \AgdaSymbol{(}\AgdaFunction{fv} \AgdaSymbol{(}\AgdaBound{σ'} \AgdaBound{u}\AgdaSymbol{)} \AgdaInductiveConstructor{,} \AgdaBound{y∈fvσ'u} \AgdaInductiveConstructor{,} \AgdaBound{fvσ'u∈map}\AgdaSymbol{)} \<[110]%
\>[110]\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{lemma⊇} \AgdaSymbol{:} \AgdaSymbol{(}\AgdaFunction{concat} \AgdaSymbol{(}\AgdaFunction{map} \AgdaSymbol{(}\AgdaFunction{fv} \AgdaFunction{∘f} \AgdaBound{σ'}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaFunction{fv} \AgdaBound{M'}\AgdaSymbol{)))} \AgdaFunction{⊆} \AgdaSymbol{((}\AgdaFunction{concat} \AgdaSymbol{(}\AgdaFunction{map} \AgdaSymbol{(}\AgdaFunction{fv} \AgdaFunction{∘f} \AgdaBound{σ}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaFunction{fv} \AgdaBound{M}\AgdaSymbol{))))}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{lemma⊇} \AgdaSymbol{\{}\AgdaBound{y}\AgdaSymbol{\}} \AgdaBound{y∈concat}\<%
\\
\>[2]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaKeyword{with} \AgdaSymbol{(}\AgdaField{FE.Π.\_⟨\$⟩\_} \AgdaSymbol{(}\AgdaField{from} \AgdaSymbol{(}\AgdaFunction{concat-∈↔} \AgdaSymbol{\{}\AgdaArgument{x} \AgdaSymbol{=} \AgdaBound{y}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaArgument{xss} \AgdaSymbol{=} \AgdaFunction{map} \AgdaSymbol{(}\AgdaFunction{fv} \AgdaFunction{∘f} \AgdaBound{σ'}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaFunction{fv} \AgdaBound{M'}\AgdaSymbol{)\})))} \AgdaBound{y∈concat} \<[89]%
\>[89]\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaSymbol{...} \AgdaSymbol{|} \AgdaBound{xs} \AgdaInductiveConstructor{,} \AgdaBound{y∈xs} \AgdaInductiveConstructor{,} \AgdaBound{xs∈map} \<[27]%
\>[27]\<%
\\
\>[2]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaKeyword{with} \AgdaSymbol{(}\AgdaField{FE.Π.\_⟨\$⟩\_} \AgdaSymbol{(}\AgdaField{from} \AgdaSymbol{((}\AgdaFunction{map-∈↔} \AgdaSymbol{\{}\AgdaArgument{y} \AgdaSymbol{=} \AgdaBound{xs}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaArgument{xs} \AgdaSymbol{=} \AgdaFunction{fv} \AgdaBound{M'}\AgdaSymbol{\}))))} \AgdaBound{xs∈map}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{lemma⊇} \AgdaSymbol{\{}\AgdaBound{y}\AgdaSymbol{\}} \AgdaBound{y∈concat} \<[22]%
\>[22]\<%
\\
\>[2]\AgdaIndent{6}{}\<[6]%
\>[6]\AgdaSymbol{|} \AgdaSymbol{.(}\AgdaFunction{fv} \AgdaSymbol{(}\AgdaBound{σ'} \AgdaBound{x}\AgdaSymbol{))} \AgdaInductiveConstructor{,} \AgdaBound{y∈fvσ'x} \AgdaInductiveConstructor{,} \AgdaBound{fvσ'x∈map}\<%
\\
\>[2]\AgdaIndent{6}{}\<[6]%
\>[6]\AgdaSymbol{|} \AgdaBound{x} \AgdaInductiveConstructor{,} \AgdaBound{x∈fvM'} \AgdaInductiveConstructor{,} \AgdaInductiveConstructor{refl}\<%
\\
\>[0]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaKeyword{with} \AgdaFunction{lemmafvfree→} \AgdaBound{x} \AgdaBound{M'} \AgdaBound{x∈fvM'} \AgdaSymbol{|} \AgdaFunction{lemmafvfree→} \AgdaBound{y} \AgdaSymbol{(}\AgdaBound{σ'} \AgdaBound{x}\AgdaSymbol{)} \AgdaBound{y∈fvσ'x}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaSymbol{...} \AgdaSymbol{|} \AgdaBound{xfreeM'} \AgdaSymbol{|} \AgdaBound{yfreeσ'x}\<%
\\
\>[2]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaKeyword{with} \AgdaBound{h2} \AgdaBound{y} \AgdaSymbol{(}\AgdaBound{x} \AgdaInductiveConstructor{,} \AgdaBound{xfreeM'} \AgdaInductiveConstructor{,} \AgdaBound{yfreeσ'x}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaSymbol{...} \AgdaSymbol{|} \AgdaBound{u} \AgdaInductiveConstructor{,} \AgdaBound{ufreeM} \AgdaInductiveConstructor{,} \AgdaBound{yfreeσu} \<[29]%
\>[29]\<%
\\
\>[2]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaKeyword{with} \AgdaFunction{lemmafvfree←} \AgdaBound{u} \AgdaBound{M} \AgdaBound{ufreeM} \AgdaSymbol{|} \AgdaFunction{lemmafvfree←} \AgdaBound{y} \AgdaSymbol{(}\AgdaBound{σ} \AgdaBound{u}\AgdaSymbol{)} \AgdaBound{yfreeσu}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaSymbol{...} \AgdaSymbol{|} \AgdaBound{u∈fvM} \AgdaSymbol{|} \AgdaBound{y∈fvσu} \<[23]%
\>[23]\<%
\\
\>[2]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaKeyword{with} \AgdaSymbol{(}\AgdaField{FE.Π.\_⟨\$⟩\_} \AgdaSymbol{(}\AgdaField{to} \AgdaSymbol{((}\AgdaFunction{map-∈↔} \AgdaSymbol{\{}\AgdaArgument{f} \AgdaSymbol{=} \AgdaFunction{fv} \AgdaFunction{∘f} \AgdaBound{σ}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaArgument{y} \AgdaSymbol{=} \AgdaFunction{fv} \AgdaSymbol{(}\AgdaBound{σ} \AgdaBound{u}\AgdaSymbol{)\}} \AgdaSymbol{\{}\AgdaArgument{xs} \AgdaSymbol{=} \AgdaFunction{fv} \AgdaBound{M}\AgdaSymbol{\}))))} \AgdaSymbol{(}\AgdaBound{u} \AgdaInductiveConstructor{,} \AgdaBound{u∈fvM} \AgdaInductiveConstructor{,} \AgdaInductiveConstructor{refl}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaSymbol{...} \AgdaSymbol{|} \AgdaBound{fvσu∈map} \<[17]%
\>[17]\<%
\\
\>[2]\AgdaIndent{5}{}\<[5]%
\>[5]\AgdaSymbol{=} \AgdaSymbol{(}\AgdaField{FE.Π.\_⟨\$⟩\_} \AgdaSymbol{(}\AgdaField{to} \AgdaSymbol{(}\AgdaFunction{concat-∈↔} \AgdaSymbol{\{}\AgdaArgument{x} \AgdaSymbol{=} \AgdaBound{y}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaArgument{xss} \AgdaSymbol{=} \AgdaFunction{map} \AgdaSymbol{(}\AgdaFunction{fv} \AgdaFunction{∘f} \AgdaBound{σ}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaFunction{fv} \AgdaBound{M}\AgdaSymbol{)\})))} \AgdaSymbol{(}\AgdaFunction{fv} \AgdaSymbol{(}\AgdaBound{σ} \AgdaBound{u}\AgdaSymbol{)} \AgdaInductiveConstructor{,} \AgdaBound{y∈fvσu} \AgdaInductiveConstructor{,} \AgdaBound{fvσu∈map}\AgdaSymbol{)} \<[105]%
\>[105]\<%
\\
\>\AgdaComment{--}\<%
\\
\>\AgdaFunction{χ-lemma3} \AgdaSymbol{:} \AgdaSymbol{(}\AgdaBound{σ} \AgdaBound{σ'} \AgdaSymbol{:} \AgdaFunction{Σ}\AgdaSymbol{)(}\AgdaBound{M} \AgdaBound{M'} \AgdaSymbol{:} \AgdaDatatype{Λ}\AgdaSymbol{)} \AgdaSymbol{→} \<[34]%
\>[34]\<%
\\
\>[0]\AgdaIndent{3}{}\<[3]%
\>[3]\AgdaSymbol{(∀} \AgdaBound{x} \AgdaSymbol{→} \AgdaBound{x} \AgdaDatatype{*} \AgdaBound{M} \AgdaSymbol{→} \AgdaBound{σ} \AgdaBound{x} \AgdaFunction{∼*} \AgdaBound{σ'} \AgdaBound{x}\AgdaSymbol{)} \<[33]%
\>[33]\AgdaSymbol{→} \<[35]%
\>[35]\<%
\\
\>[0]\AgdaIndent{3}{}\<[3]%
\>[3]\AgdaBound{M} \AgdaFunction{∼*} \AgdaBound{M'} \AgdaSymbol{→} \<[13]%
\>[13]\<%
\\
\>[0]\AgdaIndent{3}{}\<[3]%
\>[3]\AgdaFunction{χ} \AgdaSymbol{(}\AgdaBound{σ} \AgdaInductiveConstructor{,} \AgdaBound{M}\AgdaSymbol{)} \AgdaDatatype{≡} \AgdaFunction{χ} \<[18]%
\>[18]\AgdaSymbol{(}\AgdaBound{σ'} \AgdaInductiveConstructor{,} \AgdaBound{M'}\AgdaSymbol{)}\<%
\\
\>\AgdaFunction{χ-lemma3} \AgdaBound{σ} \AgdaBound{σ'} \AgdaBound{M} \AgdaBound{M'} \AgdaBound{x*M⇛σx∼σ'x} \AgdaSymbol{(}\AgdaBound{*M⇒M'} \AgdaInductiveConstructor{,} \AgdaBound{*M'⇒M}\AgdaSymbol{)} \AgdaSymbol{=} \AgdaFunction{χ-lemma4} \AgdaBound{σ} \AgdaBound{σ'} \AgdaBound{M} \AgdaBound{M'} \AgdaSymbol{(}\AgdaFunction{h1} \AgdaInductiveConstructor{,} \AgdaFunction{h2}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaKeyword{where} \<[8]%
\>[8]\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{h1} \AgdaSymbol{:} \AgdaSymbol{(}\AgdaBound{y} \AgdaSymbol{:} \AgdaFunction{V}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaFunction{∃} \AgdaSymbol{(λ} \AgdaBound{x} \AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{x} \AgdaDatatype{*} \AgdaBound{M}\AgdaSymbol{)} \<[35]%
\>[35]\AgdaFunction{×} \AgdaSymbol{(}\AgdaBound{y} \AgdaDatatype{*} \AgdaBound{σ} \AgdaBound{x}\AgdaSymbol{))} \<[49]%
\>[49]\AgdaSymbol{→} \AgdaFunction{∃} \AgdaSymbol{(λ} \AgdaBound{u} \AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{u} \AgdaDatatype{*} \AgdaBound{M'}\AgdaSymbol{)} \AgdaFunction{×} \<[72]%
\>[72]\AgdaSymbol{(}\AgdaBound{y} \AgdaDatatype{*} \AgdaBound{σ'} \AgdaBound{u}\AgdaSymbol{))}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{h1} \AgdaBound{y} \AgdaSymbol{(}\AgdaBound{x} \AgdaInductiveConstructor{,} \AgdaBound{x*M} \AgdaInductiveConstructor{,} \AgdaBound{y*σx}\AgdaSymbol{)} \<[27]%
\>[27]\AgdaSymbol{=} \<[30]%
\>[30]\AgdaBound{x} \AgdaInductiveConstructor{,} \AgdaBound{*M⇒M'} \AgdaBound{x} \AgdaBound{x*M} \AgdaInductiveConstructor{,} \AgdaField{proj₁} \AgdaSymbol{(}\AgdaBound{x*M⇛σx∼σ'x} \AgdaBound{x} \AgdaBound{x*M}\AgdaSymbol{)} \AgdaBound{y} \AgdaBound{y*σx}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{h2} \AgdaSymbol{:} \AgdaSymbol{(}\AgdaBound{y} \AgdaSymbol{:} \AgdaFunction{V}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaFunction{∃} \AgdaSymbol{(λ} \AgdaBound{x} \AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{x} \AgdaDatatype{*} \AgdaBound{M'}\AgdaSymbol{)} \AgdaFunction{×} \AgdaSymbol{(}\AgdaBound{y} \AgdaDatatype{*} \AgdaBound{σ'} \AgdaBound{x}\AgdaSymbol{))} \AgdaSymbol{→} \AgdaFunction{∃} \AgdaSymbol{(λ} \AgdaBound{u} \AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{u} \AgdaDatatype{*} \AgdaBound{M}\AgdaSymbol{)} \AgdaFunction{×} \<[71]%
\>[71]\AgdaSymbol{(}\AgdaBound{y} \AgdaDatatype{*} \AgdaBound{σ} \AgdaBound{u}\AgdaSymbol{))} \<[82]%
\>[82]\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{h2} \AgdaBound{y} \AgdaSymbol{(}\AgdaBound{x} \AgdaInductiveConstructor{,} \AgdaBound{x*M'} \AgdaInductiveConstructor{,} \AgdaBound{y*σ'x}\AgdaSymbol{)} \<[27]%
\>[27]\AgdaSymbol{=} \<[30]%
\>[30]\AgdaBound{x} \AgdaInductiveConstructor{,} \AgdaBound{*M'⇒M} \AgdaBound{x} \AgdaBound{x*M'} \AgdaInductiveConstructor{,} \AgdaField{proj₂} \AgdaSymbol{(}\AgdaBound{x*M⇛σx∼σ'x} \AgdaBound{x} \AgdaSymbol{(}\AgdaBound{*M'⇒M} \AgdaBound{x} \AgdaBound{x*M'}\AgdaSymbol{))} \AgdaBound{y} \AgdaBound{y*σ'x}\<%
\end{code}

\begin{code}%
\>\AgdaFunction{\_∙\_} \AgdaSymbol{:} \AgdaDatatype{Λ} \AgdaSymbol{→} \AgdaFunction{Σ} \AgdaSymbol{→} \AgdaDatatype{Λ}\<%
\\
\>\AgdaInductiveConstructor{v} \AgdaBound{x} \<[7]%
\>[7]\AgdaFunction{∙} \AgdaBound{σ} \AgdaSymbol{=} \AgdaBound{σ} \AgdaBound{x}\<%
\\
\>\AgdaBound{M} \AgdaInductiveConstructor{·} \AgdaBound{N} \<[7]%
\>[7]\AgdaFunction{∙} \AgdaBound{σ} \AgdaSymbol{=} \AgdaSymbol{(}\AgdaBound{M} \AgdaFunction{∙} \AgdaBound{σ}\AgdaSymbol{)} \AgdaInductiveConstructor{·} \AgdaSymbol{(}\AgdaBound{N} \AgdaFunction{∙} \AgdaBound{σ}\AgdaSymbol{)}\<%
\\
\>\AgdaInductiveConstructor{ƛ} \AgdaBound{x} \AgdaBound{M} \<[7]%
\>[7]\AgdaFunction{∙} \AgdaBound{σ} \AgdaSymbol{=} \AgdaInductiveConstructor{ƛ} \AgdaFunction{y} \AgdaSymbol{(}\AgdaBound{M} \AgdaFunction{∙} \AgdaSymbol{(}\AgdaBound{σ} \AgdaFunction{≺+} \AgdaSymbol{(}\AgdaBound{x} \AgdaInductiveConstructor{,} \AgdaInductiveConstructor{v} \AgdaFunction{y}\AgdaSymbol{)))}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaKeyword{where} \AgdaFunction{y} \AgdaSymbol{=} \AgdaFunction{χ} \AgdaSymbol{(}\AgdaBound{σ} \AgdaInductiveConstructor{,} \AgdaInductiveConstructor{ƛ} \AgdaBound{x} \AgdaBound{M}\AgdaSymbol{)}\<%
\end{code}

\begin{code}%
\>\AgdaKeyword{infixl} \<[8]%
\>[8]\AgdaNumber{7} \_∘\_\<%
\\
\>\AgdaFunction{\_∘\_} \AgdaSymbol{:} \AgdaFunction{Σ} \AgdaSymbol{→} \AgdaFunction{Σ} \AgdaSymbol{→} \AgdaFunction{Σ}\<%
\\
\>\AgdaSymbol{(}\AgdaBound{σ} \AgdaFunction{∘} \AgdaBound{σ'}\AgdaSymbol{)} \AgdaBound{x} \AgdaSymbol{=} \AgdaSymbol{(}\AgdaBound{σ'} \AgdaBound{x}\AgdaSymbol{)} \AgdaFunction{∙} \AgdaBound{σ}\<%
\\
%
\\
\>\AgdaFunction{lemmaι} \AgdaSymbol{:} \AgdaSymbol{\{}\AgdaBound{σ} \AgdaSymbol{:} \AgdaFunction{Σ}\AgdaSymbol{\}} \AgdaSymbol{→} \AgdaBound{σ} \AgdaFunction{≅σ} \AgdaBound{σ} \AgdaFunction{∘} \AgdaFunction{ι}\<%
\\
\>\AgdaFunction{lemmaι} \AgdaBound{x} \AgdaSymbol{=} \AgdaInductiveConstructor{refl}\<%
\end{code}

\begin{code}%
\>\AgdaFunction{prop7} \AgdaSymbol{:} \AgdaSymbol{\{}\AgdaBound{x} \AgdaSymbol{:} \AgdaFunction{V}\AgdaSymbol{\}\{}\AgdaBound{σ} \AgdaBound{σ'} \AgdaSymbol{:} \AgdaFunction{Σ}\AgdaSymbol{\}\{}\AgdaBound{M} \AgdaSymbol{:} \AgdaDatatype{Λ}\AgdaSymbol{\}} \AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{σ'} \AgdaFunction{∘} \AgdaBound{σ}\AgdaSymbol{)} \AgdaFunction{≺+} \AgdaSymbol{(}\AgdaBound{x} \AgdaInductiveConstructor{,} \AgdaBound{M} \AgdaFunction{∙} \AgdaBound{σ'}\AgdaSymbol{)} \AgdaFunction{≅σ} \AgdaBound{σ'} \AgdaFunction{∘} \AgdaSymbol{(}\AgdaBound{σ} \AgdaFunction{≺+} \AgdaSymbol{(}\AgdaBound{x} \AgdaInductiveConstructor{,} \AgdaBound{M}\AgdaSymbol{))}\<%
\\
\>\AgdaFunction{prop7} \AgdaSymbol{\{}\AgdaBound{x}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{σ}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{σ'}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{M}\AgdaSymbol{\}} \AgdaBound{y} \AgdaKeyword{with} \AgdaBound{x} \AgdaFunction{≟} \AgdaBound{y}\<%
\\
\>\AgdaSymbol{...} \AgdaSymbol{|} \AgdaInductiveConstructor{yes} \AgdaSymbol{\_} \<[13]%
\>[13]\AgdaSymbol{=} \AgdaInductiveConstructor{refl}\<%
\\
\>\AgdaSymbol{...} \AgdaSymbol{|} \AgdaInductiveConstructor{no} \AgdaSymbol{\_} \<[13]%
\>[13]\AgdaSymbol{=} \AgdaInductiveConstructor{refl}\<%
\end{code}

\begin{code}%
\>\AgdaFunction{x≢y→x*x[y/M]} \AgdaSymbol{:} \AgdaSymbol{\{}\AgdaBound{x} \AgdaBound{y} \AgdaSymbol{:} \AgdaFunction{V}\AgdaSymbol{\}\{}\AgdaBound{M} \AgdaSymbol{:} \AgdaDatatype{Λ}\AgdaSymbol{\}} \AgdaSymbol{→} \AgdaBound{x} \AgdaFunction{≢} \AgdaBound{y} \AgdaSymbol{→} \AgdaBound{y} \AgdaDatatype{*} \AgdaInductiveConstructor{v} \AgdaBound{y} \AgdaFunction{∙} \AgdaFunction{ι} \AgdaFunction{≺+} \AgdaSymbol{(}\AgdaBound{x} \AgdaInductiveConstructor{,} \AgdaBound{M}\AgdaSymbol{)}\<%
\\
\>\AgdaFunction{x≢y→x*x[y/M]} \AgdaSymbol{\{}\AgdaBound{x}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{y}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{M}\AgdaSymbol{\}} \AgdaBound{x≢y} \AgdaKeyword{with} \AgdaSymbol{(}\AgdaFunction{ι} \AgdaFunction{≺+} \AgdaSymbol{(}\AgdaBound{x} \AgdaInductiveConstructor{,} \AgdaBound{M}\AgdaSymbol{))} \AgdaBound{y} \AgdaSymbol{|} \AgdaFunction{x≢y→x[y/M]≡x} \AgdaSymbol{\{}\AgdaBound{x}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{y}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{M}\AgdaSymbol{\}} \AgdaBound{x≢y}\<%
\\
\>\AgdaSymbol{...} \AgdaSymbol{|} \AgdaSymbol{.(}\AgdaInductiveConstructor{v} \AgdaBound{y}\AgdaSymbol{)} \AgdaSymbol{|} \AgdaInductiveConstructor{refl} \AgdaSymbol{=} \AgdaInductiveConstructor{*v}\<%
\end{code}

\begin{code}%
\>\AgdaFunction{lemmax∙ι≺+x,N} \AgdaSymbol{:} \AgdaSymbol{(}\AgdaBound{x} \AgdaSymbol{:} \AgdaFunction{V}\AgdaSymbol{)(}\AgdaBound{N} \AgdaSymbol{:} \AgdaDatatype{Λ}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaInductiveConstructor{v} \AgdaBound{x} \AgdaFunction{∙} \AgdaFunction{ι} \AgdaFunction{≺+} \AgdaSymbol{(}\AgdaBound{x} \AgdaInductiveConstructor{,} \AgdaBound{N}\AgdaSymbol{)} \AgdaDatatype{≡} \AgdaBound{N} \<[57]%
\>[57]\<%
\\
\>\AgdaFunction{lemmax∙ι≺+x,N} \AgdaBound{x} \AgdaBound{N} \AgdaKeyword{with} \AgdaBound{x} \AgdaFunction{≟} \AgdaBound{x} \<[29]%
\>[29]\<%
\\
\>\AgdaSymbol{...} \AgdaSymbol{|} \AgdaInductiveConstructor{yes} \<[11]%
\>[11]\AgdaSymbol{\_} \<[16]%
\>[16]\AgdaSymbol{=} \AgdaInductiveConstructor{refl}\<%
\\
\>\AgdaSymbol{...} \AgdaSymbol{|} \AgdaInductiveConstructor{no} \<[11]%
\>[11]\AgdaBound{x≢x} \<[16]%
\>[16]\AgdaSymbol{=} \AgdaFunction{⊥-elim} \AgdaSymbol{(}\AgdaBound{x≢x} \AgdaInductiveConstructor{refl}\AgdaSymbol{)} \<%
\end{code}

\begin{code}%
\>\AgdaFunction{lemma\#→free\#} \AgdaSymbol{:} \AgdaSymbol{\{}\AgdaBound{x} \AgdaSymbol{:} \AgdaFunction{V}\AgdaSymbol{\}\{}\AgdaBound{σ} \AgdaSymbol{:} \AgdaFunction{Σ}\AgdaSymbol{\}\{}\AgdaBound{M} \AgdaSymbol{:} \AgdaDatatype{Λ}\AgdaSymbol{\}} \AgdaSymbol{→} \AgdaBound{x} \AgdaDatatype{\#} \AgdaSymbol{(}\AgdaBound{M} \AgdaFunction{∙} \AgdaBound{σ}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaBound{x} \AgdaFunction{\#⇂} \AgdaSymbol{(}\AgdaBound{σ} \AgdaInductiveConstructor{,} \AgdaBound{M}\AgdaSymbol{)} \<[66]%
\>[66]\<%
\\
\>\AgdaFunction{lemma\#→free\#} \AgdaSymbol{\{}\AgdaBound{x}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{σ}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaInductiveConstructor{v} \AgdaSymbol{.}\AgdaBound{y}\AgdaSymbol{\}} \<[30]%
\>[30]\AgdaBound{x\#σy} \<[45]%
\>[45]\AgdaBound{y} \AgdaInductiveConstructor{*v}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaSymbol{=} \AgdaBound{x\#σy}\<%
\\
\>\AgdaFunction{lemma\#→free\#} \AgdaSymbol{\{}\AgdaBound{x}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{σ}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{M} \AgdaInductiveConstructor{·} \AgdaBound{N}\AgdaSymbol{\}} \AgdaSymbol{(}\AgdaInductiveConstructor{\#·} \AgdaBound{x\#Mσ} \AgdaBound{x\#Nσ}\AgdaSymbol{)} \AgdaBound{y} \AgdaSymbol{(}\AgdaInductiveConstructor{*·l} \AgdaBound{yfreeMσ}\AgdaSymbol{)} \<[62]%
\>[62]\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaSymbol{=} \AgdaFunction{lemma\#→free\#} \AgdaBound{x\#Mσ} \AgdaBound{y} \AgdaBound{yfreeMσ}\<%
\\
\>\AgdaFunction{lemma\#→free\#} \AgdaSymbol{\{}\AgdaBound{x}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{σ}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{M} \AgdaInductiveConstructor{·} \AgdaBound{N}\AgdaSymbol{\}} \AgdaSymbol{(}\AgdaInductiveConstructor{\#·} \AgdaBound{x\#Mσ} \AgdaBound{x\#Nσ}\AgdaSymbol{)} \AgdaBound{y} \AgdaSymbol{(}\AgdaInductiveConstructor{*·r} \AgdaBound{yfreeNσ}\AgdaSymbol{)} \<[62]%
\>[62]\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaSymbol{=} \AgdaFunction{lemma\#→free\#} \AgdaBound{x\#Nσ} \AgdaBound{y} \AgdaBound{yfreeNσ}\<%
\\
\>\AgdaFunction{lemma\#→free\#} \AgdaSymbol{.\{}\AgdaFunction{χ} \AgdaSymbol{(}\AgdaBound{σ} \AgdaInductiveConstructor{,} \AgdaInductiveConstructor{ƛ} \AgdaBound{z} \AgdaBound{M}\AgdaSymbol{)\}} \AgdaSymbol{\{}\AgdaBound{σ}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaInductiveConstructor{ƛ} \AgdaBound{z} \AgdaBound{M}\AgdaSymbol{\}} \AgdaInductiveConstructor{\#ƛ≡} \<[51]%
\>[51]\AgdaBound{y} \AgdaBound{yfreeλzM}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaSymbol{=} \AgdaSymbol{(}\AgdaFunction{χ-lemma2} \AgdaBound{σ} \AgdaSymbol{(}\AgdaInductiveConstructor{ƛ} \AgdaBound{z} \AgdaBound{M}\AgdaSymbol{))} \AgdaBound{y} \AgdaBound{yfreeλzM} \<[39]%
\>[39]\<%
\\
\>\AgdaFunction{lemma\#→free\#} \AgdaSymbol{\{}\AgdaBound{x}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{σ}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaInductiveConstructor{ƛ} \AgdaBound{z} \AgdaBound{M}\AgdaSymbol{\}} \AgdaSymbol{(}\AgdaInductiveConstructor{\#ƛ} \AgdaBound{x\#Mσ<+zw}\AgdaSymbol{)} \<[44]%
\>[44]\AgdaBound{y} \AgdaSymbol{(}\AgdaInductiveConstructor{*ƛ} \AgdaBound{yfreeM} \AgdaBound{z≢y}\AgdaSymbol{)} \<[62]%
\>[62]\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaKeyword{with} \AgdaBound{z} \AgdaFunction{≟} \AgdaBound{y} \AgdaSymbol{|} \AgdaFunction{lemma\#→free\#} \AgdaBound{x\#Mσ<+zw} \AgdaBound{y} \AgdaBound{yfreeM}\<%
\\
\>\AgdaSymbol{...} \AgdaSymbol{|} \AgdaInductiveConstructor{yes} \AgdaBound{z≡y} \AgdaSymbol{|} \AgdaSymbol{\_} \<[19]%
\>[19]\AgdaSymbol{=} \AgdaFunction{⊥-elim} \AgdaSymbol{(}\AgdaBound{z≢y} \AgdaBound{z≡y}\AgdaSymbol{)} \<[38]%
\>[38]\<%
\\
\>\AgdaSymbol{...} \AgdaSymbol{|} \AgdaInductiveConstructor{no} \<[10]%
\>[10]\AgdaSymbol{\_} \<[14]%
\>[14]\AgdaSymbol{|} \AgdaBound{hi} \AgdaSymbol{=} \AgdaBound{hi} \<[24]%
\>[24]\<%
\\
%
\\
\>\AgdaFunction{sym≢} \AgdaSymbol{:} \AgdaSymbol{\{}\AgdaBound{x} \AgdaBound{y} \AgdaSymbol{:} \AgdaFunction{V}\AgdaSymbol{\}} \AgdaSymbol{→} \AgdaBound{x} \AgdaFunction{≢} \AgdaBound{y} \AgdaSymbol{→} \AgdaBound{y} \AgdaFunction{≢} \AgdaBound{x}\<%
\\
\>\AgdaFunction{sym≢} \AgdaSymbol{\{}\AgdaBound{x}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{y}\AgdaSymbol{\}} \AgdaBound{x≢y} \AgdaBound{y≡x} \AgdaSymbol{=} \AgdaBound{x≢y} \AgdaSymbol{(}\AgdaFunction{sym} \AgdaBound{y≡x}\AgdaSymbol{)}\<%
\\
%
\\
\>\AgdaFunction{lemmafree\#→\#} \AgdaSymbol{:} \AgdaSymbol{\{}\AgdaBound{x} \AgdaSymbol{:} \AgdaFunction{V}\AgdaSymbol{\}\{}\AgdaBound{σ} \AgdaSymbol{:} \AgdaFunction{Σ}\AgdaSymbol{\}\{}\AgdaBound{M} \AgdaSymbol{:} \AgdaDatatype{Λ}\AgdaSymbol{\}} \AgdaSymbol{→} \AgdaBound{x} \AgdaFunction{\#⇂} \AgdaSymbol{(}\AgdaBound{σ} \AgdaInductiveConstructor{,} \AgdaBound{M}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaBound{x} \AgdaDatatype{\#} \AgdaSymbol{(}\AgdaBound{M} \AgdaFunction{∙} \AgdaBound{σ}\AgdaSymbol{)} \<[66]%
\>[66]\<%
\\
\>\AgdaFunction{lemmafree\#→\#} \AgdaSymbol{\{}\AgdaBound{x}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{σ}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaInductiveConstructor{v} \AgdaBound{y}\AgdaSymbol{\}} \<[29]%
\>[29]\AgdaBound{f} \AgdaSymbol{=} \AgdaBound{f} \AgdaBound{y} \AgdaInductiveConstructor{*v}\<%
\\
\>\AgdaFunction{lemmafree\#→\#} \AgdaSymbol{\{}\AgdaBound{x}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{σ}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{M} \AgdaInductiveConstructor{·} \AgdaBound{N}\AgdaSymbol{\}} \AgdaBound{f} \<[31]%
\>[31]\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaSymbol{=} \AgdaInductiveConstructor{\#·} \AgdaSymbol{(}\AgdaFunction{lemmafree\#→\#} \AgdaSymbol{(λ} \AgdaBound{y} \AgdaBound{yfreeM} \AgdaSymbol{→} \AgdaBound{f} \AgdaBound{y} \AgdaSymbol{(}\AgdaInductiveConstructor{*·l} \AgdaBound{yfreeM}\AgdaSymbol{)))} \<[54]%
\>[54]\<%
\\
\>[2]\AgdaIndent{7}{}\<[7]%
\>[7]\AgdaSymbol{(}\AgdaFunction{lemmafree\#→\#} \AgdaSymbol{(λ} \AgdaBound{y} \AgdaBound{yfreeN} \AgdaSymbol{→} \AgdaBound{f} \AgdaBound{y} \AgdaSymbol{(}\AgdaInductiveConstructor{*·r} \AgdaBound{yfreeN}\AgdaSymbol{)))}\<%
\\
\>\AgdaFunction{lemmafree\#→\#} \AgdaSymbol{\{}\AgdaBound{x}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{σ}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaInductiveConstructor{ƛ} \AgdaBound{y} \AgdaBound{M}\AgdaSymbol{\}} \AgdaBound{f}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaKeyword{with} \AgdaFunction{χ} \AgdaSymbol{(}\AgdaBound{σ} \AgdaInductiveConstructor{,} \AgdaInductiveConstructor{ƛ} \AgdaBound{y} \AgdaBound{M}\AgdaSymbol{)} \AgdaSymbol{|} \AgdaBound{x} \AgdaFunction{≟} \AgdaFunction{χ} \AgdaSymbol{(}\AgdaBound{σ} \AgdaInductiveConstructor{,} \AgdaInductiveConstructor{ƛ} \AgdaBound{y} \AgdaBound{M}\AgdaSymbol{)} \AgdaSymbol{|} \AgdaFunction{χ-lemma2} \AgdaBound{σ} \AgdaSymbol{(}\AgdaInductiveConstructor{ƛ} \AgdaBound{y} \AgdaBound{M}\AgdaSymbol{)} \<[62]%
\>[62]\<%
\\
\>\AgdaSymbol{...} \AgdaSymbol{|} \AgdaSymbol{.}\AgdaBound{x} \AgdaSymbol{|} \AgdaInductiveConstructor{yes} \AgdaInductiveConstructor{refl} \AgdaSymbol{|} \AgdaBound{x\#σ⇂λyM} \<[31]%
\>[31]\AgdaSymbol{=} \AgdaInductiveConstructor{\#ƛ≡}\<%
\\
\>\AgdaSymbol{...} \AgdaSymbol{|} \AgdaBound{z} \<[9]%
\>[9]\AgdaSymbol{|} \AgdaInductiveConstructor{no} \AgdaBound{x≢z} \<[20]%
\>[20]\AgdaSymbol{|} \AgdaBound{z\#σ⇂λyM} \<[31]%
\>[31]\AgdaSymbol{=} \AgdaInductiveConstructor{\#ƛ} \AgdaSymbol{(}\AgdaFunction{lemmafree\#→\#} \AgdaSymbol{\{}\AgdaBound{x}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaArgument{σ} \AgdaSymbol{=} \AgdaBound{σ} \AgdaFunction{≺+} \AgdaSymbol{(}\AgdaBound{y} \AgdaInductiveConstructor{,} \AgdaInductiveConstructor{v} \AgdaBound{z}\AgdaSymbol{)\}} \AgdaSymbol{\{}\AgdaBound{M}\AgdaSymbol{\}} \AgdaFunction{lemma}\AgdaSymbol{)}\<%
\\
\>[2]\AgdaIndent{3}{}\<[3]%
\>[3]\AgdaKeyword{where} \AgdaFunction{lemma} \AgdaSymbol{:} \AgdaSymbol{(}\AgdaBound{w} \AgdaSymbol{:} \AgdaFunction{V}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaBound{w} \AgdaDatatype{*} \AgdaBound{M} \AgdaSymbol{→} \AgdaBound{x} \AgdaDatatype{\#} \AgdaSymbol{(}\AgdaBound{σ} \AgdaFunction{≺+} \AgdaSymbol{(}\AgdaBound{y} \AgdaInductiveConstructor{,} \AgdaInductiveConstructor{v} \AgdaBound{z}\AgdaSymbol{))} \AgdaBound{w}\<%
\\
\>[3]\AgdaIndent{9}{}\<[9]%
\>[9]\AgdaFunction{lemma} \AgdaBound{w} \AgdaBound{wfreeM} \AgdaKeyword{with} \AgdaBound{y} \AgdaFunction{≟} \AgdaBound{w} \<[35]%
\>[35]\<%
\\
\>[3]\AgdaIndent{9}{}\<[9]%
\>[9]\AgdaSymbol{...} \AgdaSymbol{|} \AgdaInductiveConstructor{yes} \AgdaSymbol{\_} \<[22]%
\>[22]\AgdaSymbol{=} \AgdaInductiveConstructor{\#v} \AgdaSymbol{(}\AgdaFunction{sym≢} \AgdaBound{x≢z}\AgdaSymbol{)}\<%
\\
\>[3]\AgdaIndent{9}{}\<[9]%
\>[9]\AgdaSymbol{...} \AgdaSymbol{|} \AgdaInductiveConstructor{no} \AgdaBound{y≢w} \AgdaSymbol{=} \AgdaBound{f} \AgdaBound{w} \AgdaSymbol{(}\AgdaInductiveConstructor{*ƛ} \AgdaBound{wfreeM} \AgdaBound{y≢w}\AgdaSymbol{)}\<%
\\
%
\\
\>\AgdaFunction{lemmafree\#y→\#} \AgdaSymbol{:} \AgdaSymbol{\{}\AgdaBound{x} \AgdaSymbol{:} \AgdaFunction{V}\AgdaSymbol{\}\{}\AgdaBound{M} \AgdaSymbol{:} \AgdaDatatype{Λ}\AgdaSymbol{\}} \AgdaSymbol{→} \AgdaSymbol{((}\AgdaBound{y} \AgdaSymbol{:} \AgdaFunction{V}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaBound{y} \AgdaDatatype{*} \AgdaBound{M} \AgdaSymbol{→} \AgdaBound{x} \AgdaDatatype{\#} \AgdaInductiveConstructor{v} \AgdaBound{y}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaBound{x} \AgdaDatatype{\#} \AgdaBound{M}\<%
\\
\>\AgdaFunction{lemmafree\#y→\#} \AgdaSymbol{\{}\AgdaBound{x}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaInductiveConstructor{v} \AgdaBound{y}\AgdaSymbol{\}} \<[26]%
\>[26]\AgdaBound{f} \AgdaSymbol{=} \AgdaBound{f} \AgdaBound{y} \AgdaInductiveConstructor{*v}\<%
\\
\>\AgdaFunction{lemmafree\#y→\#} \AgdaSymbol{\{}\AgdaBound{x}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{M} \AgdaInductiveConstructor{·} \AgdaBound{N}\AgdaSymbol{\}} \AgdaBound{f} \<[28]%
\>[28]\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaSymbol{=} \AgdaInductiveConstructor{\#·} \AgdaSymbol{(}\AgdaFunction{lemmafree\#y→\#} \AgdaSymbol{(λ} \AgdaBound{y} \AgdaBound{yfreeM} \AgdaSymbol{→} \AgdaBound{f} \AgdaBound{y} \AgdaSymbol{(}\AgdaInductiveConstructor{*·l} \AgdaBound{yfreeM}\AgdaSymbol{)))} \<[55]%
\>[55]\<%
\\
\>[2]\AgdaIndent{7}{}\<[7]%
\>[7]\AgdaSymbol{(}\AgdaFunction{lemmafree\#y→\#} \AgdaSymbol{(λ} \AgdaBound{y} \AgdaBound{yfreeN} \AgdaSymbol{→} \AgdaBound{f} \AgdaBound{y} \AgdaSymbol{(}\AgdaInductiveConstructor{*·r} \AgdaBound{yfreeN}\AgdaSymbol{)))}\<%
\\
\>\AgdaFunction{lemmafree\#y→\#} \AgdaSymbol{\{}\AgdaBound{x}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaInductiveConstructor{ƛ} \AgdaBound{y} \AgdaBound{M}\AgdaSymbol{\}} \AgdaBound{f} \AgdaKeyword{with} \AgdaBound{x} \AgdaFunction{≟} \AgdaBound{y}\<%
\\
\>\AgdaFunction{lemmafree\#y→\#} \AgdaSymbol{\{}\AgdaBound{x}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaInductiveConstructor{ƛ} \AgdaBound{y} \AgdaBound{M}\AgdaSymbol{\}} \AgdaBound{f} \<[28]%
\>[28]\<%
\\
\>[0]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaSymbol{|} \AgdaInductiveConstructor{no} \<[10]%
\>[10]\AgdaBound{x≢y} \AgdaSymbol{=} \AgdaInductiveConstructor{\#ƛ} \AgdaSymbol{(}\AgdaFunction{lemmafree\#y→\#} \AgdaFunction{lemma}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaKeyword{where}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{lemma} \AgdaSymbol{:} \AgdaSymbol{(}\AgdaBound{u} \AgdaSymbol{:} \AgdaFunction{V}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaBound{u} \AgdaDatatype{*} \AgdaBound{M} \AgdaSymbol{→} \AgdaBound{x} \AgdaDatatype{\#} \AgdaInductiveConstructor{v} \AgdaBound{u}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{lemma} \AgdaBound{u} \AgdaBound{ufreeM} \AgdaKeyword{with} \AgdaBound{y} \AgdaFunction{≟} \AgdaBound{u} \<[28]%
\>[28]\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaSymbol{...} \AgdaSymbol{|} \AgdaInductiveConstructor{yes} \AgdaBound{y≡u} \AgdaSymbol{=} \AgdaInductiveConstructor{\#v} \AgdaSymbol{(λ} \AgdaBound{u≡x} \AgdaSymbol{→} \AgdaBound{x≢y} \AgdaSymbol{(}\AgdaFunction{trans} \AgdaSymbol{(}\AgdaFunction{sym} \AgdaBound{u≡x}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaFunction{sym} \AgdaBound{y≡u}\AgdaSymbol{)))}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaSymbol{...} \AgdaSymbol{|} \AgdaInductiveConstructor{no} \<[12]%
\>[12]\AgdaBound{y≢u} \AgdaSymbol{=} \AgdaBound{f} \AgdaBound{u} \AgdaSymbol{(}\AgdaInductiveConstructor{*ƛ} \AgdaBound{ufreeM} \AgdaBound{y≢u}\AgdaSymbol{)}\<%
\\
\>\AgdaFunction{lemmafree\#y→\#} \AgdaSymbol{\{}\AgdaBound{x}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaInductiveConstructor{ƛ} \AgdaSymbol{.}\AgdaBound{x} \AgdaBound{M}\AgdaSymbol{\}} \AgdaBound{f} \<[29]%
\>[29]\<%
\\
\>[2]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaSymbol{|} \AgdaInductiveConstructor{yes} \AgdaInductiveConstructor{refl} \AgdaSymbol{=} \AgdaInductiveConstructor{\#ƛ≡} \<%
\end{code}

No Capture Lemma

\begin{code}%
\>\AgdaFunction{lemmafreeσ→} \AgdaSymbol{:} \AgdaSymbol{\{}\AgdaBound{x} \AgdaSymbol{:} \AgdaFunction{V}\AgdaSymbol{\}\{}\AgdaBound{M} \AgdaSymbol{:} \AgdaDatatype{Λ}\AgdaSymbol{\}\{}\AgdaBound{σ} \AgdaSymbol{:} \AgdaFunction{Σ}\AgdaSymbol{\}} \AgdaSymbol{→} \AgdaBound{x} \AgdaDatatype{*} \AgdaSymbol{(}\AgdaBound{M} \AgdaFunction{∙} \AgdaBound{σ}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaBound{x} \AgdaFunction{*⇂} \AgdaSymbol{(}\AgdaBound{σ} \AgdaInductiveConstructor{,} \AgdaBound{M}\AgdaSymbol{)} \AgdaComment{--∃ (λ y → (y * M) × (x * σ y))}\<%
\\
\>\AgdaFunction{lemmafreeσ→} \AgdaSymbol{\{}\AgdaBound{x}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaInductiveConstructor{v} \AgdaBound{z}\AgdaSymbol{\}} \<[24]%
\>[24]\AgdaSymbol{\{}\AgdaBound{σ}\AgdaSymbol{\}} \AgdaBound{xfreeσz} \AgdaSymbol{=} \AgdaBound{z} \AgdaInductiveConstructor{,} \AgdaInductiveConstructor{*v} \AgdaInductiveConstructor{,} \AgdaBound{xfreeσz}\<%
\\
\>\AgdaFunction{lemmafreeσ→} \AgdaSymbol{\{}\AgdaBound{x}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{M} \AgdaInductiveConstructor{·} \AgdaBound{N}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{σ}\AgdaSymbol{\}} \AgdaSymbol{(}\AgdaInductiveConstructor{*·l} \AgdaBound{xfreeMσ}\AgdaSymbol{)} \AgdaSymbol{=} \AgdaFunction{y} \AgdaInductiveConstructor{,} \AgdaInductiveConstructor{*·l} \AgdaFunction{yfreeMσ} \AgdaInductiveConstructor{,} \AgdaFunction{xfreeσy}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaKeyword{where} \AgdaFunction{y} \AgdaSymbol{=} \AgdaField{proj₁} \AgdaSymbol{(}\AgdaFunction{lemmafreeσ→} \AgdaSymbol{\{}\AgdaBound{x}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{M}\AgdaSymbol{\}} \AgdaBound{xfreeMσ}\AgdaSymbol{)}\<%
\\
\>[2]\AgdaIndent{8}{}\<[8]%
\>[8]\AgdaFunction{yfreeMσ} \AgdaSymbol{=} \AgdaField{proj₁} \AgdaSymbol{(}\AgdaField{proj₂} \AgdaSymbol{(}\AgdaFunction{lemmafreeσ→} \AgdaSymbol{\{}\AgdaBound{x}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{M}\AgdaSymbol{\}} \AgdaBound{xfreeMσ}\AgdaSymbol{))}\<%
\\
\>[2]\AgdaIndent{8}{}\<[8]%
\>[8]\AgdaFunction{xfreeσy} \AgdaSymbol{=} \AgdaField{proj₂} \AgdaSymbol{(}\AgdaField{proj₂} \AgdaSymbol{(}\AgdaFunction{lemmafreeσ→} \AgdaSymbol{\{}\AgdaBound{x}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{M}\AgdaSymbol{\}} \AgdaBound{xfreeMσ}\AgdaSymbol{))}\<%
\\
\>\AgdaFunction{lemmafreeσ→} \AgdaSymbol{\{}\AgdaBound{x}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{M} \AgdaInductiveConstructor{·} \AgdaBound{N}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{σ}\AgdaSymbol{\}} \AgdaSymbol{(}\AgdaInductiveConstructor{*·r} \AgdaBound{xfreeNσ}\AgdaSymbol{)} \AgdaSymbol{=} \AgdaFunction{y} \AgdaInductiveConstructor{,} \AgdaInductiveConstructor{*·r} \AgdaFunction{yfreeNσ} \AgdaInductiveConstructor{,} \AgdaFunction{xfreeσy}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaKeyword{where} \AgdaFunction{y} \AgdaSymbol{=} \AgdaField{proj₁} \AgdaSymbol{(}\AgdaFunction{lemmafreeσ→} \AgdaSymbol{\{}\AgdaBound{x}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{N}\AgdaSymbol{\}} \AgdaBound{xfreeNσ}\AgdaSymbol{)}\<%
\\
\>[2]\AgdaIndent{8}{}\<[8]%
\>[8]\AgdaFunction{yfreeNσ} \AgdaSymbol{=} \AgdaField{proj₁} \AgdaSymbol{(}\AgdaField{proj₂} \AgdaSymbol{(}\AgdaFunction{lemmafreeσ→} \AgdaSymbol{\{}\AgdaBound{x}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{N}\AgdaSymbol{\}} \AgdaBound{xfreeNσ}\AgdaSymbol{))}\<%
\\
\>[2]\AgdaIndent{8}{}\<[8]%
\>[8]\AgdaFunction{xfreeσy} \AgdaSymbol{=} \AgdaField{proj₂} \AgdaSymbol{(}\AgdaField{proj₂} \AgdaSymbol{(}\AgdaFunction{lemmafreeσ→} \AgdaSymbol{\{}\AgdaBound{x}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{N}\AgdaSymbol{\}} \AgdaBound{xfreeNσ}\AgdaSymbol{))}\<%
\\
\>\AgdaFunction{lemmafreeσ→} \AgdaSymbol{\{}\AgdaBound{x}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaInductiveConstructor{ƛ} \AgdaBound{y} \AgdaBound{M}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{σ}\AgdaSymbol{\}} \AgdaSymbol{(}\AgdaInductiveConstructor{*ƛ} \AgdaBound{xfreeMσ<+yz} \AgdaBound{z≢x}\AgdaSymbol{)} \<[50]%
\>[50]\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaKeyword{with} \<[8]%
\>[8]\AgdaFunction{χ} \AgdaSymbol{(}\AgdaBound{σ} \AgdaInductiveConstructor{,} \AgdaInductiveConstructor{ƛ} \AgdaBound{y} \AgdaBound{M}\AgdaSymbol{)} \AgdaSymbol{|} \AgdaField{proj₁} \AgdaSymbol{(}\AgdaFunction{lemmafreeσ→} \AgdaSymbol{\{}\AgdaBound{x}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{M}\AgdaSymbol{\}} \AgdaBound{xfreeMσ<+yz}\AgdaSymbol{)} \<[64]%
\>[64]\<%
\\
\>[2]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaSymbol{|} \AgdaField{proj₁} \AgdaSymbol{(}\AgdaField{proj₂} \AgdaSymbol{(}\AgdaFunction{lemmafreeσ→} \AgdaSymbol{\{}\AgdaBound{x}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{M}\AgdaSymbol{\}} \AgdaBound{xfreeMσ<+yz}\AgdaSymbol{))} \<[54]%
\>[54]\<%
\\
\>[2]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaSymbol{|} \AgdaField{proj₂} \AgdaSymbol{(}\AgdaField{proj₂} \AgdaSymbol{(}\AgdaFunction{lemmafreeσ→} \AgdaSymbol{\{}\AgdaBound{x}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{M}\AgdaSymbol{\}} \AgdaBound{xfreeMσ<+yz}\AgdaSymbol{))}\<%
\\
\>\AgdaSymbol{...} \AgdaSymbol{|} \AgdaBound{z} \AgdaSymbol{|} \AgdaBound{w} \AgdaSymbol{|} \AgdaBound{wfreeM} \AgdaSymbol{|} \AgdaBound{xfreeσ<+yzw} \<[36]%
\>[36]\AgdaKeyword{with} \AgdaBound{y} \AgdaFunction{≟} \AgdaBound{w}\<%
\\
\>\AgdaSymbol{...} \AgdaSymbol{|} \AgdaInductiveConstructor{no} \<[10]%
\>[10]\AgdaBound{y≢w} \AgdaSymbol{=} \<[17]%
\>[17]\AgdaBound{w} \AgdaInductiveConstructor{,} \AgdaInductiveConstructor{*ƛ} \AgdaBound{wfreeM} \AgdaBound{y≢w} \AgdaInductiveConstructor{,} \AgdaBound{xfreeσ<+yzw} \<[49]%
\>[49]\<%
\\
\>\AgdaSymbol{...} \AgdaSymbol{|} \AgdaInductiveConstructor{yes} \AgdaBound{y≡w} \AgdaKeyword{with} \AgdaBound{xfreeσ<+yzw}\<%
\\
\>\AgdaFunction{lemmafreeσ→} \AgdaSymbol{\{}\AgdaBound{x}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaInductiveConstructor{ƛ} \AgdaBound{y} \AgdaBound{M}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{σ}\AgdaSymbol{\}} \AgdaSymbol{(}\AgdaInductiveConstructor{*ƛ} \AgdaBound{xfreeMσ<+yz} \AgdaBound{z≢x}\AgdaSymbol{)} \<[50]%
\>[50]\<%
\\
\>[2]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaSymbol{|} \AgdaSymbol{.}\AgdaBound{x} \AgdaSymbol{|} \AgdaBound{w} \AgdaSymbol{|} \AgdaBound{wfreeM} \AgdaSymbol{|} \AgdaSymbol{\_}\<%
\\
\>[2]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaSymbol{|} \AgdaInductiveConstructor{yes} \AgdaBound{y≡w}\<%
\\
\>[2]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaSymbol{|} \AgdaInductiveConstructor{*v} \AgdaSymbol{=} \AgdaFunction{⊥-elim} \AgdaSymbol{(}\AgdaBound{z≢x} \AgdaInductiveConstructor{refl}\AgdaSymbol{)}\<%
\\
\>\AgdaComment{--}\<%
\\
\>\AgdaFunction{lemmafreeσ←} \AgdaSymbol{:} \AgdaSymbol{\{}\AgdaBound{x} \AgdaSymbol{:} \AgdaFunction{V}\AgdaSymbol{\}\{}\AgdaBound{M} \AgdaSymbol{:} \AgdaDatatype{Λ}\AgdaSymbol{\}\{}\AgdaBound{σ} \AgdaSymbol{:} \AgdaFunction{Σ}\AgdaSymbol{\}} \AgdaSymbol{→} \AgdaBound{x} \AgdaFunction{*⇂} \AgdaSymbol{(}\AgdaBound{σ} \AgdaInductiveConstructor{,} \AgdaBound{M}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaBound{x} \AgdaDatatype{*} \AgdaSymbol{(}\AgdaBound{M} \AgdaFunction{∙} \AgdaBound{σ}\AgdaSymbol{)} \<[65]%
\>[65]\<%
\\
\>\AgdaFunction{lemmafreeσ←} \AgdaSymbol{\{}\AgdaBound{x}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaInductiveConstructor{v} \AgdaBound{z}\AgdaSymbol{\}} \<[24]%
\>[24]\AgdaSymbol{\{}\AgdaBound{σ}\AgdaSymbol{\}} \AgdaSymbol{(}\AgdaSymbol{.}\AgdaBound{z} \AgdaInductiveConstructor{,} \AgdaInductiveConstructor{*v} \<[43]%
\>[43]\AgdaInductiveConstructor{,} \AgdaBound{xfreeσz}\AgdaSymbol{)} \AgdaSymbol{=} \AgdaBound{xfreeσz}\<%
\\
\>\AgdaFunction{lemmafreeσ←} \AgdaSymbol{\{}\AgdaBound{x}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{M} \AgdaInductiveConstructor{·} \AgdaBound{N}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{σ}\AgdaSymbol{\}} \AgdaSymbol{(}\AgdaBound{y} \<[32]%
\>[32]\AgdaInductiveConstructor{,} \AgdaInductiveConstructor{*·l} \AgdaBound{yfreeM} \<[48]%
\>[48]\AgdaInductiveConstructor{,} \AgdaBound{xfreeσy}\AgdaSymbol{)} \AgdaSymbol{=} \AgdaInductiveConstructor{*·l} \AgdaSymbol{(}\AgdaFunction{lemmafreeσ←} \AgdaSymbol{(}\AgdaBound{y} \AgdaInductiveConstructor{,} \AgdaBound{yfreeM} \AgdaInductiveConstructor{,} \AgdaBound{xfreeσy}\AgdaSymbol{))}\<%
\\
\>\AgdaFunction{lemmafreeσ←} \AgdaSymbol{\{}\AgdaBound{x}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{M} \AgdaInductiveConstructor{·} \AgdaBound{N}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{σ}\AgdaSymbol{\}} \AgdaSymbol{(}\AgdaBound{y} \<[32]%
\>[32]\AgdaInductiveConstructor{,} \AgdaInductiveConstructor{*·r} \AgdaBound{yfreeN} \<[48]%
\>[48]\AgdaInductiveConstructor{,} \AgdaBound{xfreeσy}\AgdaSymbol{)} \AgdaSymbol{=} \AgdaInductiveConstructor{*·r} \AgdaSymbol{(}\AgdaFunction{lemmafreeσ←} \AgdaSymbol{(}\AgdaBound{y} \AgdaInductiveConstructor{,} \AgdaBound{yfreeN} \AgdaInductiveConstructor{,} \AgdaBound{xfreeσy}\AgdaSymbol{))}\<%
\\
\>\AgdaFunction{lemmafreeσ←} \AgdaSymbol{\{}\AgdaBound{x}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaInductiveConstructor{ƛ} \AgdaBound{z} \AgdaBound{M}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{σ}\AgdaSymbol{\}} \AgdaSymbol{(}\AgdaBound{y} \<[32]%
\>[32]\AgdaInductiveConstructor{,} \AgdaInductiveConstructor{*ƛ} \AgdaBound{yfreeM} \AgdaBound{z≢y} \AgdaInductiveConstructor{,} \AgdaBound{xfreeσy}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaKeyword{with} \AgdaFunction{χ} \AgdaSymbol{(}\AgdaBound{σ} \AgdaInductiveConstructor{,} \AgdaInductiveConstructor{ƛ} \AgdaBound{z} \AgdaBound{M}\AgdaSymbol{)} \AgdaSymbol{|} \AgdaSymbol{(}\AgdaFunction{χ-lemma2} \AgdaBound{σ} \AgdaSymbol{(}\AgdaInductiveConstructor{ƛ} \AgdaBound{z} \AgdaBound{M}\AgdaSymbol{))} \AgdaBound{y} \AgdaSymbol{(}\AgdaInductiveConstructor{*ƛ} \AgdaBound{yfreeM} \AgdaBound{z≢y}\AgdaSymbol{)}\<%
\\
\>\AgdaSymbol{...} \AgdaSymbol{|} \AgdaBound{w} \AgdaSymbol{|} \AgdaBound{w\#σy} \AgdaKeyword{with} \AgdaBound{w} \AgdaFunction{≟} \AgdaBound{x}\<%
\\
\>\AgdaSymbol{...} \AgdaSymbol{|} \AgdaInductiveConstructor{no} \<[10]%
\>[10]\AgdaBound{w≢x} \AgdaSymbol{=} \AgdaInductiveConstructor{*ƛ} \AgdaSymbol{(}\AgdaFunction{lemmafreeσ←} \AgdaSymbol{(}\AgdaBound{y} \AgdaInductiveConstructor{,} \AgdaBound{yfreeM} \AgdaInductiveConstructor{,} \AgdaFunction{lemma}\AgdaSymbol{))} \AgdaBound{w≢x}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaKeyword{where} \AgdaFunction{lemma} \AgdaSymbol{:} \<[17]%
\>[17]\AgdaBound{x} \AgdaDatatype{*} \AgdaSymbol{((}\AgdaBound{σ} \AgdaFunction{≺+} \AgdaSymbol{(}\AgdaBound{z} \AgdaInductiveConstructor{,} \AgdaInductiveConstructor{v} \AgdaBound{w}\AgdaSymbol{))} \AgdaBound{y}\AgdaSymbol{)}\<%
\\
\>[2]\AgdaIndent{8}{}\<[8]%
\>[8]\AgdaFunction{lemma} \AgdaKeyword{with} \AgdaBound{z} \AgdaFunction{≟} \AgdaBound{y} \<[25]%
\>[25]\<%
\\
\>[2]\AgdaIndent{8}{}\<[8]%
\>[8]\AgdaSymbol{...} \AgdaSymbol{|} \AgdaInductiveConstructor{yes} \AgdaBound{z≡y} \AgdaSymbol{=} \AgdaFunction{⊥-elim} \AgdaSymbol{(}\AgdaBound{z≢y} \AgdaBound{z≡y}\AgdaSymbol{)}\<%
\\
\>[2]\AgdaIndent{8}{}\<[8]%
\>[8]\AgdaSymbol{...} \AgdaSymbol{|} \AgdaInductiveConstructor{no} \<[18]%
\>[18]\AgdaSymbol{\_} \<[22]%
\>[22]\AgdaSymbol{=} \AgdaBound{xfreeσy}\<%
\\
\>\AgdaFunction{lemmafreeσ←} \AgdaSymbol{\{}\AgdaBound{x}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaInductiveConstructor{ƛ} \AgdaBound{z} \AgdaBound{M}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{σ}\AgdaSymbol{\}} \AgdaSymbol{(}\AgdaBound{y} \<[32]%
\>[32]\AgdaInductiveConstructor{,} \AgdaInductiveConstructor{*ƛ} \AgdaBound{yfreeM} \AgdaBound{z≢y} \AgdaInductiveConstructor{,} \AgdaBound{xfreeσy}\AgdaSymbol{)} \<[59]%
\>[59]\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaSymbol{|} \AgdaSymbol{.}\AgdaBound{x} \AgdaSymbol{|} \AgdaBound{x\#σy} \AgdaSymbol{|} \AgdaInductiveConstructor{yes} \AgdaInductiveConstructor{refl} \AgdaSymbol{=} \AgdaFunction{⊥-elim} \AgdaSymbol{((}\AgdaFunction{lemma-free→¬\#} \AgdaBound{xfreeσy}\AgdaSymbol{)} \AgdaBound{x\#σy}\AgdaSymbol{)}\<%
\end{code}


\begin{code}%
\>\AgdaFunction{lemmaz*Mι≺+x,y→z≢x} \AgdaSymbol{:} \AgdaSymbol{\{}\AgdaBound{x} \AgdaBound{y} \AgdaBound{z} \AgdaSymbol{:} \AgdaFunction{V}\AgdaSymbol{\}\{}\AgdaBound{M} \AgdaSymbol{:} \AgdaDatatype{Λ}\AgdaSymbol{\}} \AgdaSymbol{→} \AgdaBound{y} \AgdaFunction{≢} \AgdaBound{z} \AgdaSymbol{→} \AgdaBound{z} \AgdaDatatype{*} \AgdaBound{M} \AgdaFunction{∙} \AgdaFunction{ι} \AgdaFunction{≺+} \AgdaSymbol{(}\AgdaBound{x} \AgdaInductiveConstructor{,} \AgdaInductiveConstructor{v} \AgdaBound{y}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaBound{z} \AgdaFunction{≢} \AgdaBound{x}\<%
\\
\>\AgdaFunction{lemmaz*Mι≺+x,y→z≢x} \AgdaSymbol{\{}\AgdaBound{x}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{y}\AgdaSymbol{\}} \<[28]%
\>[28]\AgdaSymbol{.\{}\AgdaBound{x}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{M}\AgdaSymbol{\}} \AgdaBound{y≢x} \AgdaBound{x*Mι≺+x,y} \AgdaInductiveConstructor{refl} \<[56]%
\>[56]\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaKeyword{with} \AgdaFunction{lemmafreeσ→} \AgdaSymbol{\{}\AgdaBound{x}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{M}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaFunction{ι} \AgdaFunction{≺+} \AgdaSymbol{(}\AgdaBound{x} \AgdaInductiveConstructor{,} \AgdaInductiveConstructor{v} \AgdaBound{y}\AgdaSymbol{)\}} \AgdaBound{x*Mι≺+x,y} \<[54]%
\>[54]\<%
\\
\>\AgdaSymbol{...} \AgdaSymbol{|} \AgdaBound{w} \AgdaInductiveConstructor{,} \AgdaBound{w*M} \AgdaInductiveConstructor{,} \AgdaBound{x*ι≺+x,yw} \<[26]%
\>[26]\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaKeyword{with} \AgdaBound{x} \AgdaFunction{≟} \AgdaBound{w}\<%
\\
\>\AgdaFunction{lemmaz*Mι≺+x,y→z≢x} \AgdaSymbol{\{}\AgdaBound{x}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{y}\AgdaSymbol{\}} \<[28]%
\>[28]\AgdaSymbol{.\{}\AgdaBound{x}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{M}\AgdaSymbol{\}} \AgdaBound{y≢x} \AgdaBound{x*Mι≺+x,y} \AgdaInductiveConstructor{refl} \<[56]%
\>[56]\<%
\\
\>[2]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaSymbol{|} \AgdaSymbol{.}\AgdaBound{x} \AgdaInductiveConstructor{,} \AgdaBound{x*M} \AgdaInductiveConstructor{,} \AgdaInductiveConstructor{*v}\<%
\\
\>[2]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaSymbol{|} \AgdaInductiveConstructor{no} \<[11]%
\>[11]\AgdaBound{x≢x} \<[17]%
\>[17]\AgdaSymbol{=} \AgdaFunction{⊥-elim} \AgdaSymbol{(}\AgdaBound{x≢x} \AgdaInductiveConstructor{refl}\AgdaSymbol{)}\<%
\\
\>\AgdaFunction{lemmaz*Mι≺+x,y→z≢x} \AgdaSymbol{\{}\AgdaBound{x}\AgdaSymbol{\}} \AgdaSymbol{.\{}\AgdaBound{x}\AgdaSymbol{\}} \AgdaSymbol{.\{}\AgdaBound{x}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{M}\AgdaSymbol{\}} \AgdaBound{x≢x} \AgdaBound{x*Mι≺+x,x} \AgdaInductiveConstructor{refl} \<[56]%
\>[56]\<%
\\
\>[2]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaSymbol{|} \AgdaSymbol{.}\AgdaBound{x} \AgdaInductiveConstructor{,} \AgdaBound{x*M} \AgdaInductiveConstructor{,} \AgdaInductiveConstructor{*v}\<%
\\
\>[2]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaSymbol{|} \AgdaInductiveConstructor{yes} \<[11]%
\>[11]\AgdaInductiveConstructor{refl} \<[17]%
\>[17]\AgdaSymbol{=} \AgdaFunction{⊥-elim} \AgdaSymbol{(}\AgdaBound{x≢x} \AgdaInductiveConstructor{refl}\AgdaSymbol{)}\<%
\\
%
\\
\>\AgdaFunction{lemmaι≺+⇀y} \<[12]%
\>[12]\AgdaSymbol{:} \AgdaSymbol{\{}\AgdaBound{Γ} \AgdaSymbol{:} \AgdaFunction{Cxt}\AgdaSymbol{\}\{}\AgdaBound{α} \AgdaSymbol{:} \AgdaDatatype{Type}\AgdaSymbol{\}\{}\AgdaBound{x} \AgdaBound{y} \AgdaSymbol{:} \AgdaFunction{V}\AgdaSymbol{\}\{}\AgdaBound{M} \AgdaSymbol{:} \AgdaDatatype{Λ}\AgdaSymbol{\}}\<%
\\
\>[4]\AgdaIndent{12}{}\<[12]%
\>[12]\AgdaSymbol{→} \AgdaFunction{ι} \AgdaFunction{≺+} \AgdaSymbol{(}\AgdaBound{y} \AgdaInductiveConstructor{,} \AgdaInductiveConstructor{v} \AgdaBound{x}\AgdaSymbol{)} \AgdaFunction{∶} \AgdaSymbol{(}\AgdaBound{Γ} \AgdaFunction{‚} \AgdaBound{y} \AgdaInductiveConstructor{∶} \AgdaBound{α}\AgdaSymbol{)} \AgdaFunction{⇀} \AgdaSymbol{(}\AgdaBound{Γ} \AgdaFunction{‚} \AgdaBound{x} \AgdaInductiveConstructor{∶} \AgdaBound{α}\AgdaSymbol{)} \AgdaFunction{⇂} \AgdaBound{M} \AgdaFunction{∙} \AgdaFunction{ι} \AgdaFunction{≺+} \AgdaSymbol{(}\AgdaBound{x} \AgdaInductiveConstructor{,} \AgdaInductiveConstructor{v} \AgdaBound{y}\AgdaSymbol{)}\<%
\\
\>\AgdaFunction{lemmaι≺+⇀y} \<[12]%
\>[12]\AgdaSymbol{\{}\AgdaArgument{x} \AgdaSymbol{=} \AgdaBound{x}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{y}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{M}\AgdaSymbol{\}} \<[29]%
\>[29]\AgdaSymbol{.\{}\AgdaBound{y}\AgdaSymbol{\}} \<[35]%
\>[35]\AgdaBound{z*M∙ι≺+x,y} \AgdaSymbol{(}\AgdaInductiveConstructor{here} \AgdaInductiveConstructor{refl}\AgdaSymbol{)} \<[58]%
\>[58]\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaKeyword{with} \AgdaBound{y} \AgdaFunction{≟} \AgdaBound{y}\<%
\\
\>\AgdaSymbol{...} \AgdaSymbol{|} \AgdaInductiveConstructor{yes} \<[11]%
\>[11]\AgdaSymbol{\_} \<[16]%
\>[16]\AgdaSymbol{=} \AgdaInductiveConstructor{⊢v} \AgdaSymbol{(}\AgdaInductiveConstructor{here} \AgdaInductiveConstructor{refl}\AgdaSymbol{)}\<%
\\
\>\AgdaSymbol{...} \AgdaSymbol{|} \AgdaInductiveConstructor{no} \<[11]%
\>[11]\AgdaBound{y≢y} \<[16]%
\>[16]\AgdaSymbol{=} \AgdaFunction{⊥-elim} \AgdaSymbol{(}\AgdaBound{y≢y} \AgdaInductiveConstructor{refl}\AgdaSymbol{)}\<%
\\
\>\AgdaFunction{lemmaι≺+⇀y} \<[12]%
\>[12]\AgdaSymbol{\{}\AgdaArgument{x} \AgdaSymbol{=} \AgdaBound{x}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{y}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{M}\AgdaSymbol{\}} \<[29]%
\>[29]\AgdaSymbol{\{}\AgdaBound{z}\AgdaSymbol{\}} \<[35]%
\>[35]\AgdaBound{z*M∙ι≺+x,y} \AgdaSymbol{(}\AgdaInductiveConstructor{there} \AgdaBound{z≢y} \AgdaBound{z∈Γ}\AgdaSymbol{)} \<[62]%
\>[62]\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaKeyword{with} \AgdaBound{y} \AgdaFunction{≟} \AgdaBound{z}\<%
\\
\>\AgdaSymbol{...} \AgdaSymbol{|} \AgdaInductiveConstructor{yes} \<[11]%
\>[11]\AgdaBound{y≡z} \<[16]%
\>[16]\AgdaSymbol{=} \AgdaFunction{⊥-elim} \AgdaSymbol{(}\AgdaBound{z≢y} \AgdaSymbol{(}\AgdaFunction{sym} \AgdaBound{y≡z}\AgdaSymbol{))}\<%
\\
\>\AgdaSymbol{...} \AgdaSymbol{|} \AgdaInductiveConstructor{no} \<[11]%
\>[11]\AgdaBound{y≢z} \<[16]%
\>[16]\AgdaSymbol{=} \AgdaFunction{lemmaWeakening⊢\#} \AgdaSymbol{(}\AgdaInductiveConstructor{\#v} \AgdaSymbol{(}\AgdaFunction{lemmaz*Mι≺+x,y→z≢x} \AgdaSymbol{\{}\AgdaBound{x}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{y}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{z}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{M}\AgdaSymbol{\}} \AgdaBound{y≢z} \AgdaBound{z*M∙ι≺+x,y}\AgdaSymbol{))} \AgdaSymbol{(}\AgdaFunction{lemmaι⇀} \<[102]%
\>[102]\AgdaBound{z∈Γ}\AgdaSymbol{)} \<%
\end{code}


\begin{code}%
\>\AgdaFunction{lemma-subst-σ≡} \AgdaSymbol{:} \AgdaSymbol{\{}\AgdaBound{M} \AgdaSymbol{:} \AgdaDatatype{Λ}\AgdaSymbol{\}\{}\AgdaBound{σ} \AgdaBound{σ'} \AgdaSymbol{:} \AgdaFunction{Σ}\AgdaSymbol{\}} \AgdaSymbol{→} \<[37]%
\>[37]\<%
\\
\>[2]\AgdaIndent{3}{}\<[3]%
\>[3]\AgdaSymbol{(}\AgdaBound{σ} \AgdaInductiveConstructor{,} \AgdaBound{M}\AgdaSymbol{)} \AgdaFunction{≅⇂} \AgdaSymbol{(}\AgdaBound{σ'} \AgdaInductiveConstructor{,} \AgdaBound{M}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{M} \AgdaFunction{∙} \AgdaBound{σ}\AgdaSymbol{)} \AgdaDatatype{≡} \AgdaSymbol{(}\AgdaBound{M} \AgdaFunction{∙} \AgdaBound{σ'}\AgdaSymbol{)} \<[45]%
\>[45]\<%
\\
\>\AgdaFunction{lemma-subst-σ≡} \AgdaSymbol{\{}\AgdaInductiveConstructor{v} \AgdaBound{x}\AgdaSymbol{\}} \<[23]%
\>[23]\AgdaSymbol{\{}\AgdaBound{σ}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{σ'}\AgdaSymbol{\}} \AgdaSymbol{(\_} \AgdaInductiveConstructor{,} \AgdaBound{f}\AgdaSymbol{)} \<[40]%
\>[40]\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaSymbol{=} \AgdaBound{f} \AgdaBound{x} \AgdaInductiveConstructor{*v}\<%
\\
\>\AgdaFunction{lemma-subst-σ≡} \AgdaSymbol{\{}\AgdaBound{M} \AgdaInductiveConstructor{·} \AgdaBound{N}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{σ}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{σ'}\AgdaSymbol{\}} \AgdaSymbol{(\_} \AgdaInductiveConstructor{,} \AgdaBound{f}\AgdaSymbol{)} \<[40]%
\>[40]\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaSymbol{=} \AgdaFunction{cong₂} \AgdaInductiveConstructor{\_·\_}\<%
\\
\>[2]\AgdaIndent{10}{}\<[10]%
\>[10]\AgdaSymbol{(}\AgdaFunction{lemma-subst-σ≡} \AgdaSymbol{\{}\AgdaBound{M}\AgdaSymbol{\}} \AgdaSymbol{(((λ} \AgdaBound{\_} \AgdaBound{x} \AgdaSymbol{→} \AgdaBound{x}\AgdaSymbol{)} \AgdaInductiveConstructor{,} \AgdaSymbol{(λ} \AgdaBound{\_} \AgdaBound{x} \AgdaSymbol{→} \AgdaBound{x}\AgdaSymbol{))} \AgdaInductiveConstructor{,} \AgdaSymbol{(λ} \AgdaBound{x} \AgdaBound{xfreeM} \AgdaSymbol{→} \AgdaBound{f} \AgdaBound{x} \AgdaSymbol{(}\AgdaInductiveConstructor{*·l} \AgdaBound{xfreeM}\AgdaSymbol{))))} \<[95]%
\>[95]\<%
\\
\>[2]\AgdaIndent{10}{}\<[10]%
\>[10]\AgdaSymbol{(}\AgdaFunction{lemma-subst-σ≡} \AgdaSymbol{\{}\AgdaBound{N}\AgdaSymbol{\}} \AgdaSymbol{(((λ} \AgdaBound{\_} \AgdaBound{x} \AgdaSymbol{→} \AgdaBound{x}\AgdaSymbol{)} \AgdaInductiveConstructor{,} \AgdaSymbol{(λ} \AgdaBound{\_} \AgdaBound{x} \AgdaSymbol{→} \AgdaBound{x}\AgdaSymbol{))} \AgdaInductiveConstructor{,} \AgdaSymbol{(λ} \AgdaBound{x} \AgdaBound{xfreeN} \AgdaSymbol{→} \AgdaBound{f} \AgdaBound{x} \AgdaSymbol{(}\AgdaInductiveConstructor{*·r} \AgdaBound{xfreeN}\AgdaSymbol{))))}\<%
\\
\>\AgdaFunction{lemma-subst-σ≡} \AgdaSymbol{\{}\AgdaInductiveConstructor{ƛ} \AgdaBound{x} \AgdaBound{M}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{σ}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{σ'}\AgdaSymbol{\}} \AgdaSymbol{(\_} \AgdaInductiveConstructor{,} \AgdaBound{f}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaKeyword{with} \AgdaFunction{χ} \AgdaSymbol{(}\AgdaBound{σ} \AgdaInductiveConstructor{,} \AgdaInductiveConstructor{ƛ} \AgdaBound{x} \AgdaBound{M}\AgdaSymbol{)} \AgdaSymbol{|} \AgdaFunction{χ} \AgdaSymbol{(}\AgdaBound{σ'} \AgdaInductiveConstructor{,} \AgdaInductiveConstructor{ƛ} \AgdaBound{x} \AgdaBound{M}\AgdaSymbol{)} \AgdaSymbol{|} \<[40]%
\>[40]\<%
\\
\>[2]\AgdaIndent{7}{}\<[7]%
\>[7]\AgdaFunction{χ-lemma3} \AgdaBound{σ} \AgdaBound{σ'} \AgdaSymbol{(}\AgdaInductiveConstructor{ƛ} \AgdaBound{x} \AgdaBound{M}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaInductiveConstructor{ƛ} \AgdaBound{x} \AgdaBound{M}\AgdaSymbol{)} \AgdaSymbol{(λ} \AgdaBound{x} \AgdaBound{x*M} \AgdaSymbol{→} \AgdaSymbol{(}\AgdaFunction{lemma-1} \AgdaBound{x} \AgdaBound{x*M}\AgdaSymbol{)} \AgdaInductiveConstructor{,} \AgdaSymbol{(}\AgdaFunction{lemma-2} \AgdaBound{x} \AgdaBound{x*M}\AgdaSymbol{))} \AgdaSymbol{((λ} \AgdaBound{\_} \AgdaSymbol{→} \AgdaFunction{id}\AgdaSymbol{)} \AgdaInductiveConstructor{,} \AgdaSymbol{(λ} \AgdaBound{\_} \AgdaSymbol{→} \AgdaFunction{id}\AgdaSymbol{))} \<[109]%
\>[109]\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaKeyword{where} \<[8]%
\>[8]\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{lemma-1} \AgdaSymbol{:} \AgdaSymbol{(}\AgdaBound{w} \AgdaSymbol{:} \AgdaFunction{V}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaBound{w} \AgdaDatatype{*} \AgdaInductiveConstructor{ƛ} \AgdaBound{x} \AgdaBound{M} \AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{z} \AgdaSymbol{:} \AgdaFunction{V}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaBound{z} \AgdaDatatype{*} \AgdaBound{σ} \AgdaBound{w} \AgdaSymbol{→} \AgdaBound{z} \AgdaDatatype{*} \AgdaBound{σ'} \AgdaBound{w}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{lemma-1} \AgdaBound{w} \AgdaBound{wfreeλxM} \AgdaBound{z} \AgdaBound{zfreeσw} \AgdaKeyword{rewrite} \AgdaBound{f} \AgdaBound{w} \AgdaBound{wfreeλxM} \AgdaSymbol{=} \AgdaBound{zfreeσw}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{lemma-2} \AgdaSymbol{:} \AgdaSymbol{(}\AgdaBound{w} \AgdaSymbol{:} \AgdaFunction{V}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaBound{w} \AgdaDatatype{*} \AgdaInductiveConstructor{ƛ} \AgdaBound{x} \AgdaBound{M} \AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{z} \AgdaSymbol{:} \AgdaFunction{V}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaBound{z} \AgdaDatatype{*} \AgdaBound{σ'} \AgdaBound{w} \AgdaSymbol{→} \AgdaBound{z} \AgdaDatatype{*} \AgdaBound{σ} \AgdaBound{w}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{lemma-2} \AgdaBound{w} \AgdaBound{wfreeλxM} \AgdaBound{z} \AgdaBound{zfreeσ'w} \AgdaKeyword{rewrite} \AgdaBound{f} \AgdaBound{w} \AgdaBound{wfreeλxM} \AgdaSymbol{=} \AgdaBound{zfreeσ'w}\<%
\\
\>\AgdaSymbol{...} \AgdaSymbol{|} \AgdaBound{y} \AgdaSymbol{|} \AgdaSymbol{.}\AgdaBound{y} \AgdaSymbol{|} \AgdaInductiveConstructor{refl} \<[20]%
\>[20]\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaSymbol{=} \AgdaFunction{cong} \AgdaSymbol{(λ} \AgdaBound{M} \AgdaSymbol{→} \AgdaInductiveConstructor{ƛ} \AgdaBound{y} \AgdaBound{M}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaFunction{lemma-subst-σ≡} \AgdaSymbol{\{}\AgdaBound{M}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{σ} \AgdaFunction{≺+} \AgdaSymbol{(}\AgdaBound{x} \AgdaInductiveConstructor{,} \AgdaInductiveConstructor{v} \AgdaBound{y}\AgdaSymbol{)\}} \AgdaSymbol{\{}\AgdaBound{σ'} \AgdaFunction{≺+} \AgdaSymbol{(}\AgdaBound{x} \AgdaInductiveConstructor{,} \AgdaInductiveConstructor{v} \AgdaBound{y}\AgdaSymbol{)\}} \AgdaSymbol{(((λ} \AgdaBound{\_} \AgdaBound{x} \AgdaSymbol{→} \AgdaBound{x}\AgdaSymbol{)} \AgdaInductiveConstructor{,} \AgdaSymbol{(λ} \AgdaBound{\_} \AgdaBound{x} \AgdaSymbol{→} \AgdaBound{x}\AgdaSymbol{))} \AgdaInductiveConstructor{,} \AgdaFunction{lemma}\AgdaSymbol{))} \<[117]%
\>[117]\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaKeyword{where} \<[8]%
\>[8]\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{lemma} \AgdaSymbol{:} \AgdaSymbol{((}\AgdaBound{z} \AgdaSymbol{:} \AgdaFunction{V}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaBound{z} \AgdaDatatype{*} \AgdaBound{M} \AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{σ} \AgdaFunction{≺+} \AgdaSymbol{(}\AgdaBound{x} \AgdaInductiveConstructor{,} \AgdaInductiveConstructor{v} \AgdaBound{y}\AgdaSymbol{))} \AgdaBound{z} \AgdaDatatype{≡} \AgdaSymbol{(}\AgdaBound{σ'} \AgdaFunction{≺+} \AgdaSymbol{(}\AgdaBound{x} \AgdaInductiveConstructor{,} \AgdaInductiveConstructor{v} \AgdaBound{y}\AgdaSymbol{))} \AgdaBound{z}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{lemma} \AgdaBound{z} \AgdaBound{zfreeM} \AgdaKeyword{with} \AgdaBound{x} \AgdaFunction{≟} \AgdaBound{z} \<[28]%
\>[28]\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaSymbol{...} \AgdaSymbol{|} \AgdaInductiveConstructor{yes} \AgdaSymbol{\_} \<[16]%
\>[16]\AgdaSymbol{=} \AgdaInductiveConstructor{refl}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaSymbol{...} \AgdaSymbol{|} \AgdaInductiveConstructor{no} \<[12]%
\>[12]\AgdaBound{x≢z} \AgdaSymbol{=} \AgdaBound{f} \<[21]%
\>[21]\AgdaBound{z} \AgdaSymbol{(}\AgdaInductiveConstructor{*ƛ} \AgdaBound{zfreeM} \AgdaBound{x≢z}\AgdaSymbol{)} \<%
\end{code}

\begin{code}%
\>\AgdaFunction{lemma-length} \AgdaSymbol{:} \AgdaSymbol{\{}\AgdaBound{M} \AgdaSymbol{:} \AgdaDatatype{Λ}\AgdaSymbol{\}\{}\AgdaBound{σ} \AgdaSymbol{:} \AgdaFunction{Σ}\AgdaSymbol{\}} \AgdaSymbol{→} \AgdaSymbol{((}\AgdaBound{w} \AgdaSymbol{:} \AgdaFunction{V}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaFunction{length} \AgdaSymbol{(}\AgdaBound{σ} \AgdaBound{w}\AgdaSymbol{)} \AgdaDatatype{≡} \AgdaNumber{1}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaFunction{length} \AgdaBound{M} \AgdaDatatype{≡} \AgdaFunction{length} \AgdaSymbol{(}\AgdaBound{M} \AgdaFunction{∙} \AgdaBound{σ}\AgdaSymbol{)}\<%
\\
\>\AgdaFunction{lemma-length} \AgdaSymbol{\{}\AgdaInductiveConstructor{v} \AgdaBound{x}\AgdaSymbol{\}} \<[21]%
\>[21]\AgdaSymbol{\{}\AgdaBound{σ}\AgdaSymbol{\}} \AgdaBound{p} \AgdaKeyword{rewrite} \AgdaBound{p} \AgdaBound{x} \<[40]%
\>[40]\AgdaSymbol{=} \AgdaInductiveConstructor{refl}\<%
\\
\>\AgdaFunction{lemma-length} \AgdaSymbol{\{}\AgdaBound{M} \AgdaInductiveConstructor{·} \AgdaBound{N}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{σ}\AgdaSymbol{\}} \AgdaBound{p}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaSymbol{=} \AgdaFunction{cong₂} \AgdaPrimitive{\_+\_} \AgdaSymbol{(}\AgdaFunction{lemma-length} \AgdaSymbol{\{}\AgdaBound{M}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{σ}\AgdaSymbol{\}} \AgdaBound{p}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaFunction{lemma-length} \AgdaSymbol{\{}\AgdaBound{N}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{σ}\AgdaSymbol{\}} \AgdaBound{p}\AgdaSymbol{)}\<%
\\
\>\AgdaFunction{lemma-length} \AgdaSymbol{\{}\AgdaInductiveConstructor{ƛ} \AgdaBound{z} \AgdaBound{M}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{σ}\AgdaSymbol{\}} \AgdaBound{p} \AgdaKeyword{with} \AgdaFunction{χ} \AgdaSymbol{(}\AgdaBound{σ} \AgdaInductiveConstructor{,} \AgdaInductiveConstructor{ƛ} \AgdaBound{z} \AgdaBound{M}\AgdaSymbol{)} \<[46]%
\>[46]\<%
\\
\>\AgdaSymbol{...} \AgdaSymbol{|} \AgdaBound{w} \AgdaSymbol{=} \AgdaFunction{cong} \AgdaSymbol{(λ} \AgdaBound{x} \AgdaSymbol{→} \AgdaInductiveConstructor{suc} \AgdaBound{x}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaFunction{lemma-length} \AgdaSymbol{\{}\AgdaBound{M}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{σ} \AgdaFunction{≺+} \AgdaSymbol{(}\AgdaBound{z} \AgdaInductiveConstructor{,} \AgdaInductiveConstructor{v} \AgdaBound{w}\AgdaSymbol{)\}} \AgdaFunction{lemma}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaKeyword{where}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{lemma} \AgdaSymbol{:} \AgdaSymbol{(}\AgdaBound{u} \AgdaSymbol{:} \AgdaFunction{V}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaFunction{length} \AgdaSymbol{((}\AgdaBound{σ} \AgdaFunction{≺+} \AgdaSymbol{(}\AgdaBound{z} \AgdaInductiveConstructor{,} \AgdaInductiveConstructor{v} \AgdaBound{w}\AgdaSymbol{))} \AgdaBound{u}\AgdaSymbol{)} \AgdaDatatype{≡} \AgdaNumber{1}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{lemma} \AgdaBound{u} \AgdaKeyword{with} \AgdaBound{z} \AgdaFunction{≟} \AgdaBound{u} \<[21]%
\>[21]\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaSymbol{...} \AgdaSymbol{|} \AgdaInductiveConstructor{yes} \AgdaSymbol{\_} \AgdaSymbol{=} \AgdaInductiveConstructor{refl}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaSymbol{...} \AgdaSymbol{|} \AgdaInductiveConstructor{no} \<[12]%
\>[12]\AgdaSymbol{\_} \AgdaSymbol{=} \AgdaBound{p} \AgdaBound{u}\<%
\\
%
\\
\>\AgdaFunction{lemma-length-corolary} \AgdaSymbol{:} \AgdaSymbol{\{}\AgdaBound{x} \AgdaBound{y} \AgdaSymbol{:} \AgdaFunction{V}\AgdaSymbol{\}\{}\AgdaBound{M} \AgdaSymbol{:} \AgdaDatatype{Λ}\AgdaSymbol{\}} \AgdaSymbol{→} \AgdaFunction{length} \AgdaBound{M} \AgdaDatatype{≡} \AgdaFunction{length} \AgdaSymbol{(}\AgdaBound{M} \AgdaFunction{∙} \AgdaSymbol{(}\AgdaFunction{ι} \AgdaFunction{≺+} \AgdaSymbol{(}\AgdaBound{x} \AgdaInductiveConstructor{,} \AgdaInductiveConstructor{v} \AgdaBound{y}\AgdaSymbol{)))}\<%
\\
\>\AgdaFunction{lemma-length-corolary} \AgdaSymbol{\{}\AgdaBound{x}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{y}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{M}\AgdaSymbol{\}} \AgdaSymbol{=} \AgdaFunction{lemma-length} \AgdaSymbol{\{}\AgdaBound{M}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaFunction{ι} \AgdaFunction{≺+} \AgdaSymbol{(}\AgdaBound{x} \AgdaInductiveConstructor{,} \AgdaInductiveConstructor{v} \AgdaBound{y}\AgdaSymbol{)\}} \AgdaFunction{lemma}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaKeyword{where} \<[8]%
\>[8]\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{lemma} \AgdaSymbol{:} \AgdaSymbol{(}\AgdaBound{w} \AgdaSymbol{:} \AgdaFunction{V}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaFunction{length} \AgdaSymbol{((}\AgdaFunction{ι} \AgdaFunction{≺+} \AgdaSymbol{(}\AgdaBound{x} \AgdaInductiveConstructor{,} \AgdaInductiveConstructor{v} \AgdaBound{y}\AgdaSymbol{))} \AgdaBound{w}\AgdaSymbol{)} \AgdaDatatype{≡} \AgdaNumber{1}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{lemma} \AgdaBound{w} \AgdaKeyword{with} \AgdaBound{x} \AgdaFunction{≟} \AgdaBound{w} \<[21]%
\>[21]\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaSymbol{...} \AgdaSymbol{|} \AgdaInductiveConstructor{yes} \AgdaSymbol{\_} \AgdaSymbol{=} \AgdaInductiveConstructor{refl}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaSymbol{...} \AgdaSymbol{|} \AgdaInductiveConstructor{no} \<[12]%
\>[12]\AgdaSymbol{\_} \AgdaSymbol{=} \AgdaInductiveConstructor{refl}\<%
\end{code}


\begin{code}%
\>\AgdaFunction{lemmaaux⇀} \AgdaSymbol{:} \AgdaSymbol{\{}\AgdaBound{x} \AgdaBound{y} \AgdaSymbol{:} \AgdaFunction{V}\AgdaSymbol{\}\{}\AgdaBound{M} \AgdaSymbol{:} \AgdaDatatype{Λ}\AgdaSymbol{\}\{}\AgdaBound{σ} \AgdaSymbol{:} \AgdaFunction{Σ}\AgdaSymbol{\}\{}\AgdaBound{Γ} \AgdaBound{Δ} \AgdaSymbol{:} \AgdaFunction{Cxt}\AgdaSymbol{\}\{}\AgdaBound{α} \AgdaSymbol{:} \AgdaDatatype{Type}\AgdaSymbol{\}}\<%
\\
\>[2]\AgdaIndent{12}{}\<[12]%
\>[12]\AgdaSymbol{→} \AgdaBound{x} \AgdaFunction{\#⇂} \AgdaSymbol{(}\AgdaBound{σ} \AgdaInductiveConstructor{,} \AgdaInductiveConstructor{ƛ} \AgdaBound{y} \AgdaBound{M}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{σ} \AgdaFunction{∶} \AgdaBound{Γ} \AgdaFunction{⇀} \AgdaBound{Δ} \AgdaFunction{⇂} \AgdaInductiveConstructor{ƛ} \AgdaBound{y} \AgdaBound{M}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{σ} \AgdaFunction{≺+} \AgdaSymbol{(}\AgdaBound{y} \AgdaInductiveConstructor{,} \AgdaInductiveConstructor{v} \AgdaBound{x}\AgdaSymbol{))} \AgdaFunction{∶} \AgdaBound{Γ} \AgdaFunction{‚} \AgdaBound{y} \AgdaInductiveConstructor{,} \AgdaBound{α} \AgdaFunction{⇀} \AgdaSymbol{(}\AgdaBound{Δ} \AgdaFunction{‚} \AgdaBound{x} \AgdaInductiveConstructor{,} \AgdaBound{α}\AgdaSymbol{)} \AgdaFunction{⇂} \AgdaBound{M}\<%
\\
\>\AgdaFunction{lemmaaux⇀} \AgdaSymbol{\{}\AgdaArgument{y} \AgdaSymbol{=} \AgdaBound{y}\AgdaSymbol{\}} \AgdaBound{x\#⇂σƛyM} \AgdaBound{σ∶Γ⇀Δ⇂ƛyM} \AgdaSymbol{\{}\AgdaBound{z}\AgdaSymbol{\}} \AgdaBound{z*M} \AgdaBound{z∈Γ,x} \AgdaKeyword{with} \AgdaBound{y} \AgdaFunction{≟} \AgdaBound{z}\<%
\\
\>\AgdaFunction{lemmaaux⇀} \AgdaSymbol{\{}\AgdaArgument{y} \AgdaSymbol{=} \AgdaBound{y}\AgdaSymbol{\}} \AgdaBound{x\#⇂σƛyM} \AgdaBound{σ∶Γ⇀Δ⇂ƛyM} \AgdaSymbol{\{}\AgdaBound{z}\AgdaSymbol{\}} \AgdaBound{z*M} \AgdaSymbol{(}\AgdaInductiveConstructor{there} \AgdaSymbol{\_} \AgdaBound{z∈Γ}\AgdaSymbol{)} \<[58]%
\>[58]\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaSymbol{|} \AgdaInductiveConstructor{no} \<[8]%
\>[8]\AgdaBound{y≢z} \<[12]%
\>[12]\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaSymbol{=} \AgdaFunction{lemmaWeakening⊢\#} \AgdaSymbol{(}\AgdaBound{x\#⇂σƛyM} \AgdaBound{z} \AgdaSymbol{(}\AgdaInductiveConstructor{*ƛ} \AgdaBound{z*M} \AgdaBound{y≢z}\AgdaSymbol{))} \AgdaSymbol{(}\AgdaBound{σ∶Γ⇀Δ⇂ƛyM} \AgdaSymbol{(}\AgdaInductiveConstructor{*ƛ} \AgdaBound{z*M} \AgdaBound{y≢z}\AgdaSymbol{)} \AgdaBound{z∈Γ}\AgdaSymbol{)} \AgdaComment{-- (Γ'* z z∈Γ')}\<%
\\
\>\AgdaFunction{lemmaaux⇀} \AgdaSymbol{\_} \AgdaSymbol{\_} \AgdaSymbol{\{}\AgdaBound{z}\AgdaSymbol{\}} \AgdaBound{z*M} \AgdaSymbol{(}\AgdaInductiveConstructor{here} \AgdaBound{z≡y}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaSymbol{|} \AgdaInductiveConstructor{no} \<[8]%
\>[8]\AgdaBound{y≢z} \<[14]%
\>[14]\AgdaSymbol{=} \AgdaFunction{⊥-elim} \AgdaSymbol{(}\AgdaBound{y≢z} \AgdaSymbol{(}\AgdaFunction{sym} \AgdaBound{z≡y}\AgdaSymbol{))}\<%
\\
\>\AgdaFunction{lemmaaux⇀} \AgdaSymbol{\{}\AgdaArgument{y} \AgdaSymbol{=} \AgdaBound{y}\AgdaSymbol{\}} \AgdaSymbol{\_} \AgdaSymbol{\_} \AgdaSymbol{.\{}\AgdaBound{y}\AgdaSymbol{\}} \AgdaBound{z*M} \AgdaSymbol{(}\AgdaInductiveConstructor{here} \AgdaSymbol{\_)} \<[40]%
\>[40]\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaSymbol{|} \AgdaInductiveConstructor{yes} \AgdaInductiveConstructor{refl} \<[14]%
\>[14]\AgdaSymbol{=} \AgdaInductiveConstructor{⊢v} \AgdaSymbol{(}\AgdaInductiveConstructor{here} \AgdaInductiveConstructor{refl}\AgdaSymbol{)}\<%
\\
\>\AgdaFunction{lemmaaux⇀} \AgdaSymbol{\{}\AgdaArgument{y} \AgdaSymbol{=} \AgdaBound{y}\AgdaSymbol{\}} \AgdaSymbol{\_} \AgdaSymbol{\_} \AgdaSymbol{.\{}\AgdaBound{y}\AgdaSymbol{\}} \AgdaBound{z*M} \AgdaSymbol{(}\AgdaInductiveConstructor{there} \AgdaBound{y≢y} \AgdaSymbol{\_)}\<%
\\
\>[2]\AgdaIndent{3}{}\<[3]%
\>[3]\AgdaSymbol{|} \AgdaInductiveConstructor{yes} \AgdaInductiveConstructor{refl} \<[15]%
\>[15]\AgdaSymbol{=} \AgdaFunction{⊥-elim} \AgdaSymbol{(}\AgdaBound{y≢y} \AgdaInductiveConstructor{refl}\AgdaSymbol{)}\<%
\end{code}


%<*typesusbstterm>
\begin{code}%
\>\AgdaFunction{lemma⊢σM} \<[10]%
\>[10]\AgdaSymbol{:} \<[13]%
\>[13]\AgdaSymbol{\{}\AgdaBound{σ} \AgdaSymbol{:} \AgdaFunction{Σ}\AgdaSymbol{\}\{}\AgdaBound{Γ} \AgdaBound{Δ} \AgdaSymbol{:} \AgdaFunction{Cxt}\AgdaSymbol{\}\{}\AgdaBound{M} \AgdaSymbol{:} \AgdaDatatype{Λ}\AgdaSymbol{\}\{}\AgdaBound{α} \AgdaSymbol{:} \AgdaDatatype{Type}\AgdaSymbol{\}}\<%
\\
\>[3]\AgdaIndent{10}{}\<[10]%
\>[10]\AgdaSymbol{→} \<[13]%
\>[13]\AgdaBound{Γ} \AgdaDatatype{⊢} \AgdaBound{M} \AgdaDatatype{∶} \AgdaBound{α} \AgdaSymbol{→} \AgdaBound{σ} \AgdaFunction{∶} \AgdaBound{Γ} \AgdaFunction{⇀} \AgdaBound{Δ} \AgdaFunction{⇂} \AgdaBound{M} \AgdaSymbol{→} \AgdaBound{Δ} \AgdaDatatype{⊢} \AgdaBound{M} \AgdaFunction{∙} \AgdaBound{σ} \AgdaDatatype{∶} \AgdaBound{α}\<%
\end{code}
%</typesusbstterm>

\begin{code}%
\>\AgdaFunction{lemma⊢σM} \<[10]%
\>[10]\AgdaSymbol{(}\AgdaInductiveConstructor{⊢v} \AgdaBound{p∈}\AgdaSymbol{)} \<[31]%
\>[31]\AgdaBound{σ∶Γ⇀Δ⇂M}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaSymbol{=} \AgdaBound{σ∶Γ⇀Δ⇂M} \AgdaInductiveConstructor{*v} \AgdaBound{p∈}\<%
\\
\>\AgdaFunction{lemma⊢σM} \<[10]%
\>[10]\AgdaSymbol{(}\AgdaInductiveConstructor{⊢·} \AgdaBound{Γ⊢M∶α⟶β} \AgdaBound{Γ⊢N∶β}\AgdaSymbol{)} \<[31]%
\>[31]\AgdaBound{σ∶Γ⇀Δ⇂M}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaSymbol{=} \AgdaInductiveConstructor{⊢·} \<[8]%
\>[8]\AgdaSymbol{(}\AgdaFunction{lemma⊢σM} \AgdaBound{Γ⊢M∶α⟶β} \<[29]%
\>[29]\AgdaSymbol{(λ} \AgdaSymbol{\{}\AgdaBound{z}\AgdaSymbol{\}} \AgdaBound{z*M} \AgdaBound{z∈Γ} \AgdaSymbol{→} \AgdaBound{σ∶Γ⇀Δ⇂M} \AgdaSymbol{(}\AgdaInductiveConstructor{*·l} \AgdaBound{z*M}\AgdaSymbol{)} \AgdaBound{z∈Γ}\AgdaSymbol{))} \<[70]%
\>[70]\<%
\\
\>[2]\AgdaIndent{8}{}\<[8]%
\>[8]\AgdaSymbol{(}\AgdaFunction{lemma⊢σM} \AgdaBound{Γ⊢N∶β} \<[29]%
\>[29]\AgdaSymbol{(λ} \AgdaSymbol{\{}\AgdaBound{z}\AgdaSymbol{\}} \AgdaBound{z*M} \AgdaBound{z∈Γ} \AgdaSymbol{→} \AgdaBound{σ∶Γ⇀Δ⇂M} \AgdaSymbol{(}\AgdaInductiveConstructor{*·r} \AgdaBound{z*M}\AgdaSymbol{)} \AgdaBound{z∈Γ}\AgdaSymbol{))}\<%
\\
\>\AgdaFunction{lemma⊢σM} \<[10]%
\>[10]\AgdaSymbol{\{}\AgdaBound{σ}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{Γ}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{Δ}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaArgument{M} \AgdaSymbol{=} \AgdaInductiveConstructor{ƛ} \AgdaBound{y} \AgdaBound{M}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaArgument{α} \AgdaSymbol{=} \AgdaBound{α} \AgdaInductiveConstructor{⟶} \AgdaBound{β}\AgdaSymbol{\}} \<[46]%
\>[46]\<%
\\
\>[8]\AgdaIndent{10}{}\<[10]%
\>[10]\AgdaSymbol{(}\AgdaInductiveConstructor{⊢ƛ} \AgdaBound{Γ,y:α⊢M∶β}\AgdaSymbol{)} \<[31]%
\>[31]\AgdaBound{σ∶Γ⇀Δ⇂ƛyM}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaSymbol{=} \AgdaInductiveConstructor{⊢ƛ} \<[8]%
\>[8]\AgdaSymbol{(}\AgdaFunction{lemma⊢σM} \<[19]%
\>[19]\AgdaSymbol{\{}\AgdaBound{σ} \AgdaFunction{≺+} \AgdaSymbol{(}\AgdaBound{y} \AgdaInductiveConstructor{,} \AgdaInductiveConstructor{v} \AgdaFunction{x}\AgdaSymbol{)\}} \AgdaSymbol{\{}\AgdaBound{Γ} \AgdaFunction{‚} \AgdaBound{y} \AgdaInductiveConstructor{∶} \AgdaBound{α}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{Δ} \AgdaFunction{‚} \AgdaFunction{x} \AgdaInductiveConstructor{∶} \AgdaBound{α}\AgdaSymbol{\}}\<%
\\
\>[2]\AgdaIndent{19}{}\<[19]%
\>[19]\AgdaBound{Γ,y:α⊢M∶β} \<[30]%
\>[30]\AgdaSymbol{(}\AgdaFunction{lemmaaux⇀} \AgdaFunction{x\#⇂σƛyM} \AgdaBound{σ∶Γ⇀Δ⇂ƛyM}\AgdaSymbol{))}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaKeyword{where} \<[8]%
\>[8]\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{x} \AgdaSymbol{=} \AgdaFunction{χ} \AgdaSymbol{(}\AgdaBound{σ} \AgdaInductiveConstructor{,} \AgdaInductiveConstructor{ƛ} \AgdaBound{y} \AgdaBound{M}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{x\#⇂σƛyM} \AgdaSymbol{=} \AgdaFunction{χ-lemma2} \AgdaBound{σ} \AgdaSymbol{(}\AgdaInductiveConstructor{ƛ} \AgdaBound{y} \AgdaBound{M}\AgdaSymbol{)}\<%
\end{code}
